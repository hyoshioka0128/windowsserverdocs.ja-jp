---
title: NIC チーミングの設定
description: このトピックでは、チーミングおよび負荷分散モードなど、NIC チームのプロパティの概要について説明します。 また、スタンバイアダプターの設定とプライマリチームインターフェイスのプロパティについても詳しく説明します。 NIC チームに少なくとも2つのネットワークアダプターがある場合は、フォールトトレランスのためにスタンバイアダプターを指定する必要はありません。
manager: dougkim
ms.prod: windows-server
ms.technology: networking-nict
ms.topic: article
ms.assetid: a4caaa86-5799-4580-8775-03ee213784a3
ms.author: lizross
author: eross-msft
ms.date: 09/13/2018
ms.openlocfilehash: 8ae461f8e9236451e9a6b442cafecee4981ed8ce
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2020
ms.locfileid: "80853715"
---
# <a name="nic-teaming-settings"></a>NIC チーミングの設定
このトピックでは、チーミングおよび負荷分散モードなど、NIC チームのプロパティの概要について説明します。 また、スタンバイアダプターの設定とプライマリチームインターフェイスのプロパティについても詳しく説明します。 NIC チームに少なくとも2つのネットワークアダプターがある場合は、フォールトトレランスのためにスタンバイアダプターを指定する必要はありません。


  
![NIC チームのプロパティ](../../media/Create-a-New-NIC-Team-on-a-Host-Computer-or-VM/nict_06_properties.jpg)  

## <a name="teaming-modes"></a>チーミングモード 
チーミングモードのオプションは、**スイッチ**に依存せず、**スイッチに依存**します。 スイッチ依存モードには、**静的なチーミング**と**リンク集計制御プロトコル (LACP)** が含まれます。 

>[!TIP]
>最適な NIC チームのパフォーマンスを得るには、動的配布の負荷分散モードを使用することをお勧めします。  
  
### <a name="switch-independent"></a>スイッチに非依存
  
[!INCLUDE [switch-independent-shortdesc-include](../../includes/switch-independent-shortdesc-include.md)] 
  
動的分散でスイッチ非依存モードを使用すると、動的負荷分散アルゴリズムによって変更された TCP ポートアドレスハッシュに基づいて、ネットワークトラフィックの負荷が分散されます。 動的負荷分散アルゴリズムは、フローを再配布してチームメンバーの帯域幅使用率を最適化し、個々のフロー転送がアクティブなチームメンバー間を移動できるようにします。 このアルゴリズムでは、トラフィックの再配布によってパケットの順序が逆順で配信される可能性がわずかであることが考慮されます。そのため、その可能性を最小限に抑えるための手順を実行します。  
  
### <a name="switch-dependent"></a>スイッチ依存  

[!INCLUDE [switch-dependent-shortdesc-include](../../includes/switch-dependent-shortdesc-include.md)]  
  
> [!IMPORTANT]  
> スイッチに依存するチーミングを行うには、すべてのチームメンバーが同じ物理スイッチに接続されているか、複数のシャーシ間でスイッチ ID を共有するマルチシャーシスイッチに接続されている必要があります。


- **静的チーミング。** 静的チーミングを使用するには、スイッチとホストの両方を手動で構成して、チームを形成するリンクを識別する必要があります。 これは静的に構成されたソリューションであるため、スイッチとホストが誤って接続されているケーブルや、チームの実行に失敗する可能性のあるその他のエラーを識別するための追加のプロトコルはありません。 通常、このモードは、サーバークラスのスイッチでサポートされます。

- **リンク集計制御プロトコル (LACP)。** 静的チーミングとは異なり、LACP チーミングモードでは、ホストとスイッチの間に接続されているリンクを動的に識別します。 この動的接続により、チームの自動作成が可能になりますが、実際には、ピアエンティティからの LACP パケットの送信または受信によって、チームの展開と削減が単純に行われます。 すべてのサーバークラススイッチで LACP がサポートされます。また、スイッチポートで LACP を管理するには、ネットワークオペレーターが必要とします。 チーミングモードを構成すると、NIC チーミングは常に、短時間タイマーで LACP のアクティブモードで動作します。  タイマーを変更したり、LACP モードを変更したりするためのオプションは現在使用できません。


動的配布でスイッチ依存モードを使用すると、動的負荷分散アルゴリズムによって変更された TransportPorts アドレスハッシュに基づいて、ネットワークトラフィックの負荷が分散されます。  動的負荷分散アルゴリズムは、チームメンバーの帯域幅使用率を最適化するためにフローを再分配します。 個々のフロー転送では、アクティブなチームメンバー間を動的分散の一部として移動できます。 このアルゴリズムでは、トラフィックの再配布によってパケットの順序が逆順で配信される可能性がわずかであることが考慮されます。そのため、その可能性を最小限に抑えるための手順を実行します。  
  
スイッチに依存するすべての構成と同様に、スイッチは、チームメンバー間で受信トラフィックを分散する方法を決定します。  このスイッチは、チームメンバー間でトラフィックを分散するための適切なジョブを実行することが想定されていますが、その方法を決定するために完全に独立しています。  


## <a name="load-balancing-modes"></a>負荷分散モード  
負荷分散分散モードのオプションは、**アドレスハッシュ**、 **hyper-v ポート**、および**動的**です。  
  
### <a name="address-hash"></a>アドレスハッシュ
  
[!INCLUDE [address-hash-shortdesc-include](../../includes/address-hash-shortdesc-include.md)]
  
Windows PowerShell を使用して、次のハッシュ関数コンポーネントの値を指定します。  
  
-   発信元および宛先の TCP ポートと、発信元と宛先の IP アドレス。 これは、負荷分散モードとして **[アドレスハッシュ]** を選択した場合の既定値です。  
  
-   送信元と送信先の IP アドレスのみ。  
  
-   送信元と送信先の MAC アドレスのみ。  
  
TCP ポートハッシュを使用すると、トラフィックストリームが最も細かく分散されるため、NIC チームメンバー間で個別に移動できるストリームが小さくなります。 ただし、tcp ポートハッシュは、tcp または UDP ベースではないトラフィックや、IPsec で保護されたトラフィックなどによって、TCP ポートと UDP ポートがスタックから隠されている場合は使用できません。 このような場合、ハッシュは自動的に IP アドレスハッシュを使用します。トラフィックが IP トラフィックでない場合は、MAC アドレスハッシュが使用されます。  
  
### <a name="hyper-v-port"></a>Hyper-v ポート
  
[!INCLUDE [hyper-v-port-shortdesc-include](../../includes/hyper-v-port-shortdesc-include.md)]  
  
隣接するスイッチは、1つのポートで特定の MAC アドレスを常に認識するため、スイッチは、宛先 MAC (VM MAC) アドレスに基づいて複数のリンクに受信負荷 (スイッチからホストへのトラフィック) を分散します。 これは特に便利です仮想マシン キュー (VMQs) を使用している場合、キューは、トラフィックが到着する期待される場所で特定の NIC で配置できるためです。  
  
ただし、ホストにいくつかの Vm がある場合は、このモードはありませんな負荷分散を実現するために必要なレベルです。 このモードは、単一のインターフェイスで利用できる帯域幅を 1 つの VM (つまり、1 つのスイッチ ポートからのトラフィック) を常にも制限されます。 NIC チーミングでは、ソース MAC アドレスを使用する代わりに、Hyper-v 仮想スイッチポートが識別子として使用されます。これは、一部のインスタンスでは、1つのスイッチポートで複数の MAC アドレスを使用して VM を構成する可能性があるためです。  
  
### <a name="dynamic"></a>Dynamic
  
[!INCLUDE [dynamic-shortdesc-include](../../includes/dynamic-shortdesc-include.md)]
  
このモードでの送信の負荷が flowlets の概念に基づいて動的に分散します。 人間の音声認識に単語や文の末尾にある自然な改行がある場合と同様 TCP フロー (TCP 通信ストリーム) が自然に発生した中断もあります。 このような 2 つの区切りの間の TCP フローの一部を flowlet と呼びます。  
  
動的モードアルゴリズムで flowlet 境界が検出されたことが検出されると (TCP フローで十分な長さの中断が発生した場合など)、必要に応じて、アルゴリズムによって自動的に別のチームメンバーにフローがバランスされます。  状況によっては、flowlets を含まないフローを定期的に再調整することもあります。 このため、TCP フローとチーム メンバー間のアフィニティは動的な分散アルゴリズムは、チーム メンバーの作業負荷のバランスを取る動作いつでも変更できます。  
  
チームがスイッチに依存しないように構成されているか、スイッチに依存するいずれかのモードで構成されている場合は、最適なパフォーマンスを得るために動的分散モードを使用することをお勧めします。  
  
この規則には例外があります。これは、NIC チームのチームメンバーが2つだけで、スイッチ独立モードで構成されていて、アクティブ/スタンバイモードが有効になっていて、1つの NIC がアクティブで、もう一方がスタンバイ用に構成されている場合です。 この NIC チーム構成では、アドレスハッシュ分散は動的分散よりも若干優れたパフォーマンスを提供します。  


## <a name="standby-adapter-setting"></a>スタンバイアダプターの設定  
スタンバイアダプターのオプションは、 **[なし] (すべてのアダプターがアクティブ)** か、または、スタンバイアダプターとして機能する NIC チーム内の特定のネットワークアダプターを選択します。 NIC をスタンバイアダプターとして構成すると、その他のすべての選択されていないチームメンバーがアクティブになり、アクティブな NIC に障害が発生するまでネットワークトラフィックはアダプターに送信されず、処理されません。 アクティブな NIC に障害が発生すると、スタンバイ NIC がアクティブになり、ネットワークトラフィックが処理されます。 すべてのチームメンバーがサービスに復元されると、スタンバイチームメンバーがスタンバイ状態に戻ります。  

2つの NIC を持つチームがあり、1つの NIC をスタンバイアダプターとして構成することを選択した場合、2つのアクティブな Nic に存在する帯域幅の集約の利点は失われます。  フォールトトレランスを実現するためにスタンバイアダプターを指定する必要はありません。フォールトトレランスは、NIC チーム内に少なくとも2つのネットワークアダプターがある場合は常に存在します。
 
  
## <a name="primary-team-interface-property"></a>プライマリチームインターフェイスのプロパティ  
[プライマリチームインターフェイス] ダイアログボックスにアクセスするには、次の図で強調表示されているリンクをクリックする必要があります。  
  
![プライマリチームインターフェイスのプロパティ](../../media/Create-a-New-NIC-Team-on-a-Host-Computer-or-VM/nict_10_primaryteaminterface.jpg)  
  
強調表示されたリンクをクリックすると、次の **[新しいチームインターフェイス]** ダイアログボックスが表示されます。  
  
![[新しいチーム インターフェイス] ダイアログ ボックス](../../media/Create-a-New-NIC-Team-on-a-Host-Computer-or-VM/nict_newteaminterface.jpg)  
  
Vlan を使用している場合は、このダイアログボックスを使用して VLAN 番号を指定できます。  
  
Vlan を使用しているかどうかにかかわらず、NIC チームの tNIC 名を指定できます。  
  


---