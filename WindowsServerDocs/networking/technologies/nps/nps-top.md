---
title: ネットワーク ポリシー サーバー (NPS)
description: このトピックでは、Windows Server 2016 および Windows Server 2019 のネットワークポリシーサーバーの概要について説明し、NPS に関する追加のガイダンスへのリンクを示します。
manager: dougkim
ms.prod: windows-server
ms.technology: networking
ms.topic: article
ms.assetid: 9c7a67e0-0953-479c-8736-ccb356230bde
ms.author: pashort
author: shortpatti
ms.date: 06/20/2018
ms.openlocfilehash: 5685d4dae742245c131ff2fee3114e905e94e9bc
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71396005"
---
# <a name="network-policy-server-nps"></a>ネットワーク ポリシー サーバー (NPS)

>適用対象:Windows Server (半期チャネル)、Windows Server 2016、Windows Server 2019

このトピックでは、Windows Server 2016 および Windows Server 2019 のネットワークポリシーサーバーの概要について説明します。 ネットワークポリシーとアクセスサービス (NPAS) 機能を Windows Server 2016 およびサーバー2019にインストールすると、NPS がインストールされます。

> [!NOTE]
> このトピックに加えて、次の NPS のドキュメントも参照してください。
> - [ネットワークポリシーサーバーのベストプラクティス](nps-best-practices.md)
> - [ネットワークポリシーサーバーを使用したはじめに](nps-getstart-top.md)
> - [ネットワークポリシーサーバーを計画する](nps-plan-top.md)
> - [ネットワークポリシーサーバーの展開](nps-deploy.md)
> - [ネットワークポリシーサーバーの管理](nps-manage-top.md)
> - Windows Server 2016 および Windows 10 用[Windows PowerShell のネットワークポリシーサーバー (NPS) コマンドレット](https://technet.microsoft.com/library/jj872739.aspx)
> - Windows Server 2012 R2 および Windows 8.1 用[Windows PowerShell のネットワークポリシーサーバー (NPS) コマンドレット](https://technet.microsoft.com/library/jj872739.aspx)
> - Windows Server 2012 および windows 8 用[Windows PowerShell の NPS コマンドレット](https://technet.microsoft.com/library/jj872739.aspx)

ネットワーク ポリシー サーバー (NPS) を使用すると、接続要求の認証と承認を行うための組織全体のネットワーク アクセス ポリシーを作成して適用できます。

また、接続要求を負荷分散して認証のために適切なドメインに転送できるように、接続要求をリモート NPS または他の RADIUS サーバーに転送するように NPS をリモート認証ダイヤルインユーザーサービス (RADIUS) プロキシとして構成することもできます。および承認。

NPS では、次の機能を使用して、ネットワークアクセスの認証、承認、およびアカウンティングを一元的に構成および管理できます。

- **RADIUS サーバー**。 NPS は、ワイヤレス、認証スイッチ、リモートアクセスダイヤルアップ接続、および仮想プライベートネットワーク (VPN) 接続に対して、一元化された認証、承認、およびアカウンティングを実行します。 NPS を RADIUS サーバーとして使用する場合、ワイヤレス アクセス ポイントや VPN サーバーなどのネットワーク アクセス サーバーを NPS の RADIUS クライアントして構成します。 また、NPS が接続要求を承認するために使用するネットワーク ポリシーを構成して、NPS がアカウンティング情報をローカル ハード ディスク上のログ ファイルまたは Microsoft SQL Server データベースに記録するように RADIUS アカウンティングを構成できます。 詳細については、「 [RADIUS サーバー](#radius-server)」を参照してください。
- **RADIUS プロキシ**。 NPS を RADIUS プロキシとして使用する場合は、他の RADIUS サーバーに転送する接続要求と、接続要求を転送する RADIUS サーバーを NPS に指示する接続要求ポリシーを構成します。 アカウンティング データを転送して、リモート RADIUS サーバー グループの 1 つ以上のコンピューターに記録されるように構成することもできます。 NPS を RADIUS プロキシサーバーとして構成するには、次のトピックを参照してください。 詳細については、「 [RADIUS プロキシ](#radius-proxy)」を参照してください。
    - [接続要求ポリシーの構成](nps-crp-configure.md)
- **RADIUS アカウンティング**。 ローカルログファイル、または Microsoft SQL Server のローカルまたはリモートインスタンスにイベントを記録するように NPS を構成できます。 詳細については、「 [NPS logging](#nps-logging)」を参照してください。

> [!IMPORTANT]
> ネットワークアクセス保護 \(NAP @ no__t-1、正常性登録機関 \(HRA @ no__t、およびホスト資格情報承認プロトコル \(HCAP @ no__t は Windows Server 2012 R2 で非推奨とされており、Windows Server 2016 では使用できません。 Windows Server 2016 より前のオペレーティングシステムを使用して NAP を展開している場合は、NAP 展開を Windows Server 2016 に移行することはできません。

これらの機能の任意の組み合わせを使用して NPS を構成できます。 たとえば、ある NPS を VPN 接続用の RADIUS サーバーとして構成し、別のドメインでの認証と承認のためにリモート RADIUS サーバーグループのメンバーに接続要求を転送する RADIUS プロキシとして構成することができます。

## <a name="windows-server-editions-and-nps"></a>Windows Server のエディションと NPS

NPS は、インストールする Windows Server のエディションによって異なる機能を提供します。

### <a name="windows-server-2016-or-windows-server-2019-standarddatacenter-edition"></a>Windows Server 2016 または Windows Server 2019 Standard/Datacenter Edition

Windows Server 2016 Standard または Datacenter の NPS では、無制限の数の RADIUS クライアントとリモート RADIUS サーバーグループを構成できます。 さらに、IP アドレスの範囲を指定して RADIUS クライアントを構成することができます。

> [!NOTE]
> WIndows ネットワークポリシーとアクセスサービス機能は、Server Core インストールオプションを使用してインストールされたシステムでは使用できません。

次のセクションでは、RADIUS サーバーとプロキシとしての NPS の詳細について説明します。

## <a name="radius-server-and-proxy"></a>RADIUS サーバーとプロキシ

NPS は、RADIUS サーバー、RADIUS プロキシ、またはその両方として使用できます。

### <a name="radius-server"></a>RADIUS サーバー

NPS は、インターネット技術標準化委員会によって指定された RADIUS 標準を Microsoft が実装したものであり、Rfc 2865 および2866の \(IETF @ no__t-1 です。 RADIUS サーバーとして、NPS は、ワイヤレス、認証スイッチ、ダイヤルアップ、仮想プライベートネットワーク @no__t 0VPN @ no__t リモートアクセス、およびなど、さまざまな種類のネットワークアクセスに対して、一元化された接続の認証、承認、およびアカウンティングを実行します。ルーターからルーターへの接続。

> [!NOTE]
> NPS を RADIUS サーバーとして展開する方法の詳細については、「[ネットワークポリシーサーバーの展開](nps-deploy.md)」を参照してください。

NPS は、ワイヤレス、スイッチ、リモートアクセス、または VPN 機器の異種セットを使用できるようにします。 NPS は、Windows Server 2016 で利用可能なリモートアクセスサービスと共に使用できます。

NPS は、Active Directory Domain Services @no__t 0AD DS @ no__t ドメインまたはローカルのセキュリティアカウントマネージャー (SAM) のユーザーアカウントデータベースを使用して、接続試行のためにユーザーの資格情報を認証します。 NPS を実行しているサーバーが AD DS ドメインのメンバーである場合、NPS はそのユーザーアカウントデータベースとしてディレクトリサービスを使用し、シングルサインオンソリューションの一部になります。 ネットワークアクセス制御 @no__t、ネットワークへのアクセスを認証および承認するために使用される資格情報のセットは、@ no__t-1 と、AD DS ドメインにログオンします。

> [!NOTE]
> NPS は、ユーザーアカウントのダイヤルインプロパティとネットワークポリシーを使用して、接続を承認します。

インターネットサービスプロバイダー @no__t 0ISPs @ no__t、およびネットワークアクセスを維持する組織は、使用されるネットワークアクセス機器の種類に関係なく、すべての種類のネットワークアクセスを単一の管理ポイントから管理するという課題が増えています。 RADIUS 標準では、同種環境と異種環境の両方でこの機能がサポートされています。 RADIUS は、(RADIUS クライアントとして使用される) ネットワークアクセス機器が RADIUS サーバーに認証要求およびアカウンティング要求を送信できるようにするクライアント/サーバープロトコルです。

RADIUS サーバーは、ユーザーアカウント情報にアクセスし、ネットワークアクセス認証の資格情報を確認できます。 ユーザーの資格情報が認証され、接続の試行が承認されると、RADIUS サーバーは、指定された条件に基づいてユーザーアクセスを承認し、ネットワークアクセス接続をアカウンティングログに記録します。 RADIUS を使用すると、ネットワークアクセスユーザーの認証、承認、およびアカウンティングデータを、各アクセスサーバーではなく、集中管理された場所に収集して保持することができます。

#### <a name="using-nps-as-a-radius-server"></a>NPS を RADIUS サーバーとして使用する

NPS は、次の場合に RADIUS サーバーとして使用できます。

- アクセスクライアントのユーザーアカウントデータベースとして、AD DS ドメインまたはローカルの SAM ユーザーアカウントデータベースを使用している。 
- 複数のダイヤルアップサーバー、VPN サーバー、またはデマンドダイヤルルーターでリモートアクセスを使用しており、ネットワークポリシーと接続のログ記録とアカウンティングの両方の構成を集中管理する必要がある。 
- サービスプロバイダーへのダイヤルアップ、VPN、またはワイヤレスアクセスをアウトソーシングしています。 アクセスサーバーは、RADIUS を使用して、組織のメンバーによって行われる接続を認証および承認します。
- 異種のアクセスサーバーのセットに対する認証、承認、およびアカウンティングを一元化する必要がある。

次の図は、さまざまなアクセスクライアントの RADIUS サーバーとしての NPS を示しています。 

![RADIUS サーバーとしての NPS](../../media/Nps-Server/Nps-Server.jpg)

### <a name="radius-proxy"></a>RADIUS プロキシ

NPS は RADIUS プロキシとして、認証メッセージとアカウンティングメッセージを NPS および他の RADIUS サーバーに転送します。 NPS を RADIUS プロキシとして使用すると、radius @no__t クライアント間で RADIUS メッセージをルーティングすることができます。これは、ネットワークアクセスサーバー @ no__t とも呼ばれ、接続試行のユーザー認証、承認、およびアカウンティングを実行する RADIUS サーバーとも呼ばれます。 

NPS は RADIUS プロキシとして使用されている場合、RADIUS アクセスとアカウンティングメッセージのフローに使用される中央の切り替えまたはルーティングポイントです。 NPS は、転送されるメッセージに関する情報をアカウンティングログに記録します。

#### <a name="using-nps-as-a-radius-proxy"></a>NPS を RADIUS プロキシとして使用する

NPS は、次の場合に RADIUS プロキシとして使用できます。

- 外部からのダイヤルアップ、VPN、またはワイヤレスネットワークアクセスサービスを複数の顧客に提供するサービスプロバイダーです。 Nas は、NPS RADIUS プロキシに接続要求を送信します。 NPS RADIUS プロキシは、接続要求のユーザー名の領域部分に基づいて、顧客が管理する RADIUS サーバーに接続要求を転送し、接続の試行を認証および承認することができます。
- NPS がメンバーとなっているドメインのメンバーではないユーザーアカウント、または NPS がメンバーとなっているドメインと双方向の信頼関係がある別のドメインのいずれにも属していないユーザーアカウントに対して、認証と承認を行う必要があります。 これには、信頼されていないドメイン、一方向の信頼されたドメイン、およびその他のフォレストのアカウントが含まれます。 接続要求を NPS RADIUS サーバーに送信するようにアクセスサーバーを構成する代わりに、接続要求を NPS RADIUS プロキシに送信するようにアクセスサーバーを構成することができます。 NPS RADIUS プロキシは、ユーザー名の領域名部分を使用し、正しいドメインまたはフォレスト内の NPS に要求を転送します。 あるドメインまたはフォレスト内のユーザーアカウントに対する接続試行は、別のドメインまたはフォレスト内の Nas に対して認証できます。
- Windows アカウントデータベースではないデータベースを使用して認証と承認を実行する場合。 この場合、指定された領域名と一致する接続要求が RADIUS サーバーに転送されます。このサーバーは、ユーザーアカウントと承認データの別のデータベースにアクセスできます。 他のユーザーデータベースの例としては、Novell ディレクトリサービス (NDS) データベースや構造化照会言語 (SQL) データベースなどがあります。
- 多数の接続要求を処理する場合。 この場合、RADIUS クライアントが接続要求とアカウンティング要求を複数の RADIUS サーバー間で分散するように構成するのではなく、接続およびアカウンティング要求を NPS RADIUS プロキシに送信するように RADIUS クライアントを構成することができます。 NPS RADIUS プロキシは、接続およびアカウンティング要求の負荷を複数の RADIUS サーバー間で動的に分散し、1秒あたりの多数の RADIUS クライアントと認証の処理を増やします。
- 外部サービスプロバイダーの RADIUS 認証と承認を提供し、イントラネットファイアウォールの構成を最小限に抑える必要がある。 イントラネットファイアウォールは、境界ネットワーク (イントラネットとインターネットの間のネットワーク) とイントラネットの間にあります。 境界ネットワークに NPS を配置することで、境界ネットワークとイントラネットの間のファイアウォールで、NPS と複数のドメインコントローラー間のトラフィックのフローを許可する必要があります。 Nps を NPS プロキシに置き換えることにより、ファイアウォールでは、NPS プロキシとイントラネット内の1つまたは複数の NPSs 間での RADIUS トラフィックのフローのみを許可する必要があります。

次の図は、radius クライアントと RADIUS サーバーの間の RADIUS プロキシとしての NPS を示しています。

![RADIUS プロキシとしての NPS](../../media/Nps-Proxy/Nps-Proxy.jpg)

NPS を使用すると、組織はリモートアクセスインフラストラクチャをサービスプロバイダーに委託しながら、ユーザー認証、承認、およびアカウンティングの制御を維持することもできます。

NPS の構成は、次のシナリオで作成できます。

- 無線アクセス
- 組織のダイヤルアップまたは仮想プライベートネットワーク (VPN) リモートアクセス
- 外部委託ダイヤルアップまたはワイヤレスアクセス
- インターネット アクセス
- ビジネスパートナー向けのエクストラネットリソースへの認証されたアクセス

## <a name="radius-server-and-radius-proxy-configuration-examples"></a>RADIUS サーバーと RADIUS プロキシの構成例

次の構成例では、NPS を RADIUS サーバーおよび RADIUS プロキシとして構成する方法について説明します。

**RADIUS サーバーとしての NPS**。 この例では、NPS が RADIUS サーバーとして構成されており、既定の接続要求ポリシーのみが構成されたポリシーであり、すべての接続要求がローカルの NPS によって処理されます。 NPS は、アカウントが NPS のドメインおよび信頼される側のドメインにあるユーザーを認証および承認できます。

**RADIUS プロキシとしての NPS**。 この例では、NPS は、信頼されていない2つのドメインのリモート RADIUS サーバーグループに接続要求を転送する RADIUS プロキシとして構成されています。 既定の接続要求ポリシーが削除され、2つの信頼されていないドメインのそれぞれに要求を転送する2つの新しい接続要求ポリシーが作成されます。 この例では、NPS はローカルサーバー上の接続要求を処理しません。 

**Radius サーバーと radius プロキシの両方としての NPS**。 接続要求がローカルで処理されることを指定する既定の接続要求ポリシーに加えて、接続要求を NPS または信頼されていないドメイン内の他の RADIUS サーバーに転送する新しい接続要求ポリシーが作成されます。 この2番目のポリシーには、プロキシポリシーという名前が付けられています。 この例では、ポリシーの順序付きリストにプロキシポリシーが最初に表示されます。 接続要求がプロキシポリシーに一致する場合、接続要求は、リモート RADIUS サーバーグループの RADIUS サーバーに転送されます。 接続要求がプロキシポリシーと一致しないが、既定の接続要求ポリシーに一致する場合、NPS はローカルサーバー上で接続要求を処理します。 接続要求がどちらのポリシーとも一致しない場合は、破棄されます。

**リモートアカウンティングサーバーを使用する RADIUS サーバーとしての NPS**。 この例では、ローカル NPS がアカウンティングを実行するように構成されておらず、既定の接続要求ポリシーが変更されて、RADIUS アカウンティングメッセージが NPS またはリモート RADIUS サーバーグループ内の他の RADIUS サーバーに転送されるようになっています。 アカウンティングメッセージは転送されますが、認証と承認のメッセージは転送されず、ローカルの NPS はローカルドメインとすべての信頼されたドメインに対してこれらの機能を実行します。

**リモート RADIUS から Windows ユーザーへのマッピングを使用する NPS**。 この例では、NPS は、認証要求をリモート RADIUS サーバーに転送することにより、RADIUS サーバーと RADIUS プロキシの両方として機能し、承認のためにローカルの Windows ユーザーアカウントを使用します。 この構成は、接続要求ポリシーの条件として、リモート RADIUS から Windows ユーザーマッピング属性を構成することによって実装されます。 さらに、リモート RADIUS サーバーによって認証が実行されるリモートユーザーアカウントと同じ名前のユーザーアカウントを RADIUS サーバーにローカルで作成する必要があります。 @no__t \)

## <a name="configuration"></a>構成

NPS を RADIUS サーバーとして構成するには、NPS コンソールまたはサーバーマネージャーで、標準構成または詳細構成のいずれかを使用できます。 NPS を RADIUS プロキシとして構成するには、詳細構成を使用する必要があります。

### <a name="standard-configuration"></a>標準構成

標準的な構成では、次のシナリオで NPS を構成するためのウィザードが用意されています。

- ダイヤルアップ接続または VPN 接続用の RADIUS サーバー
- 802.1X ワイヤレス接続またはワイヤード (有線) 接続用の RADIUS サーバー

ウィザードを使用して NPS を構成するには、NPS コンソールを開き、上記のいずれかのシナリオを選択してから、ウィザードを開くリンクをクリックします。

### <a name="advanced-configuration"></a>詳細構成

詳細構成を使用する場合は、NPS を RADIUS サーバーまたは RADIUS プロキシとして手動で構成します。 

詳細構成を使用して NPS を構成するには、NPS コンソールを開き、 **[詳細構成]** の横にある矢印をクリックして、このセクションを展開します。

次の高度な構成項目が用意されています。

#### <a name="configure-radius-server"></a>RADIUS サーバーの構成

NPS を RADIUS サーバーとして構成するには、RADIUS クライアント、ネットワークポリシー、および RADIUS アカウンティングを構成する必要があります。

これらの構成を行う手順については、次のトピックを参照してください。

- [RADIUS クライアントを構成する](nps-radius-clients-configure.md)
- [ネットワーク ポリシーを構成する](nps-np-configure.md)
- [ネットワークポリシーサーバーアカウンティングを構成する](nps-accounting-configure.md)

#### <a name="configure-radius-proxy"></a>RADIUS プロキシの構成

NPS を RADIUS プロキシとして構成するには、RADIUS クライアント、リモート RADIUS サーバーグループ、および接続要求ポリシーを構成する必要があります。

これらの構成を行う手順については、次のトピックを参照してください。

- [RADIUS クライアントを構成する](nps-radius-clients-configure.md)
- [リモート RADIUS サーバーグループを構成する](nps-crp-rrsg-configure.md)
- [接続要求ポリシーの構成](nps-crp-configure.md)

## <a name="nps-logging"></a>NPS ログ

NPS のログ記録は、RADIUS アカウンティングとも呼ばれます。 Nps が RADIUS サーバー、プロキシ、またはこれらの構成の任意の組み合わせとして使用されているかどうかについて、要件に合わせて NPS のログを構成します。

NPS のログ記録を構成するには、イベントビューアーでログに記録して表示するイベントを構成してから、ログに記録する他の情報を決定する必要があります。 さらに、ローカルコンピューターに格納されているテキストログファイル、またはローカルコンピューターまたはリモートコンピューター上の SQL Server データベースに、ユーザー認証とアカウンティング情報を記録するかどうかを決定する必要があります。

詳細については、「[ネットワークポリシーサーバーアカウンティングの構成](nps-accounting-configure.md)」を参照してください。
