---
ms.assetid: 72a90d00-56ee-48a9-9fae-64cbad29556c
title: Windows Server 2016 の正確な時刻
description: Windows Server 2016 での同期精度が大幅に向上し、以前のバージョンの Windows との NTP の完全な互換性が維持されています。
author: shortpatti
ms.author: dacuo
ms.date: 05/08/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: 2e8e9e86f81596c85219c37c07d8fd2e95cc3a49
ms.sourcegitcommit: 10331ff4f74bac50e208ba8ec8a63d10cfa768cc
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/15/2020
ms.locfileid: "75953076"
---
# <a name="accurate-time-for-windows-server-2016"></a>Windows Server 2016 の正確な時刻

>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、Windows 10 以降

Windows タイムサービスは、クライアントとサーバーの時刻の同期プロバイダーにプラグインモデルを使用するコンポーネントです。  Windows には、2つの組み込みクライアントプロバイダーがあり、利用可能なサードパーティのプラグインがあります。 1つのプロバイダーは、 [ntp (RFC 1305)](https://tools.ietf.org/html/rfc1305)または[ms-chap](https://msdn.microsoft.com/library/cc246877.aspx)を使用して、ローカルシステム時刻を ntp または ms ntp に準拠した参照サーバーに同期します。 もう1つのプロバイダーは Hyper-v 用で、仮想マシン (VM) を Hyper-v ホストに同期します。  複数のプロバイダーが存在する場合、Windows は最初に階層レベルを使用して最適なプロバイダーを選択し、次にルート遅延、ルート分散、および finally 時間オフセットを選択します。

> [!NOTE]
> Windows Time サービスの概要については、こちらの[概要ビデオ](https://aka.ms/WS2016TimeVideo)をご覧ください。

このトピックでは、次のことについて説明します。次のトピックは、正確な時刻を有効にすることに関連しています。 

- 改善策
- 測定
- 推奨する運用方法

> [!IMPORTANT]
> Windows 2016 の正確な時刻に関する記事で言及されている補遺は、[こちら](https://windocs.blob.core.windows.net/windocs/WindowsTimeSyncAccuracy_Addendum.pdf)からダウンロードできます。  このドキュメントでは、テストと測定の手法の詳細について説明します。

> [!NOTE] 
> Windows タイムプロバイダプラグインモデルは[TechNet に記載](https://msdn.microsoft.com/library/windows/desktop/ms725475%28v=vs.85%29.aspx)されています。

## <a name="domain-hierarchy"></a>ドメイン階層
ドメインとスタンドアロンの構成は、動作が異なります。

- ドメインメンバーは、認証を使用して時間参照のセキュリティと信頼性を確保する、セキュリティで保護された NTP プロトコルを使用します。  ドメインメンバーは、ドメイン階層とスコアリングシステムによって決定されるマスタークロックと同期します。  ドメインには、時間の階層構造があります。これは、各 DC がより正確な時間階層を持つ親 DC を指します。  階層は、ルートフォレスト内の PDC または DC、またはドメインの適切なタイムサーバーを示す GTIMESERV ドメインフラグを持つ DC に解決されます。  下の「GTIMESERV を使用してローカルの Reliable Time サービスを指定する」を参照してください。

- スタンドアロンコンピューターは、既定で time.windows.com を使用するように構成されています。  この名前は、DNS サーバーによって解決されます。このサーバーは、Microsoft が所有しているリソースを指している必要があります。  リモートで特定されたすべての時刻参照と同様に、ネットワークが停止すると、同期が妨げられる可能性があります。  ネットワークトラフィックの負荷と非対称ネットワークパスによって、時刻の同期の精度が低下する場合があります。  1ミリ秒の精度を確保するために、リモートタイムソースに依存することはできません。

Hyper-v ゲストには、ホスト時間と NTP から選択できる Windows タイムプロバイダーが少なくとも2つあるため、ゲストとして実行しているときに、ドメインまたはスタンドアロンで動作が異なる場合があります。

> [!NOTE] 
> ドメイン階層とスコアリングシステムの詳細については、「 [Windows タイムサービスとは](https://blogs.msdn.microsoft.com/w32time/2007/07/07/what-is-windows-time-service/)」を参照してください。 をご覧ください。

> [!NOTE]
> 階層は、NTP プロバイダーと Hyper-v プロバイダーの両方で使用される概念であり、その値は階層内のクロックの位置を示します。  階層1は最高レベルのクロック用に予約されており、階層0はハードウェア用に予約されており、正確であると見なされ、それに関連する遅延はほとんどありません。  階層2では、階層1のサーバー、階層3から階層2などについて説明します。  多くの場合、低い階層はより正確なクロックを示していますが、不一致を検出することもできます。  また、W32time は、階層15以下からの時間のみを受け入れます。  クライアントの階層を表示するには、 *w32tm/query/status*を使用します。

## <a name="critical-factors-for-accurate-time"></a>正確な時刻の重要な要因
正確な時間については、常に次の3つの重要な要因があります。

1. **Solid Source clock** -ドメイン内のソースクロックが安定し、正確である必要があります。 これは通常、GPS デバイスをインストールするか、階層1のソースを指し、#3 を考慮することを意味します。 この例えは、水に2本のボートがあり、一方の高度をもう一方の方と比較しようとしている場合に、ソースボートが非常に安定し、移動していない場合に最適です。 同じことが時間に対して行われます。ソースクロックが安定していない場合、同期されたクロックのチェーン全体が影響を受け、各ステージで拡大されます。 また、接続の中断によって時間の同期が妨げられるため、アクセス可能である必要があります。 最後に、セキュリティで保護されている必要があります。 時刻参照が適切に管理されていない場合、または悪意のある可能性がある場合は、ドメインを時間ベースの攻撃にさらすことができます。
2. **安定したクライアントクロック**-安定したクライアントクロックによって、オシレーターの自然なずれが可能であることが保証されます。  NTP では、複数の NTP サーバーからの複数のサンプルを使用して、ローカルコンピューターのクロックを条件と統制することができます。  時刻が変化することはありませんが、正確な時間に迅速にアプローチし、NTP 要求間で正確な状態を維持するために、ローカルクロックの速度を低下させたり、高速にしたりすることはできません。  ただし、クライアントコンピューターのクロックのオシレーターが安定していない場合は、調整間の変動が多くなる可能性があります。また、Windows では、クロックが正しく機能しないという条件に対してアルゴリズムが使用されます。  場合によっては、正確な時間にファームウェアの更新が必要になることがあります。
3. **対称 ntp 通信**-ntp 通信の接続が対称であることが重要です。  NTP では、計算を使用して、ネットワークの修正プログラムが対称であると想定する時間を調整します。  NTP パケットによってサーバーに送信されるパスの長さが異なる場合、精度は影響を受けます。  たとえば、ネットワークトポロジの変更によってパスが変更されたり、インターフェイスの速度が異なるデバイスを経由してパケットがルーティングされたりすることがあります。

バッテリ駆動型デバイス (モバイルとポータブルの両方) については、さまざまな戦略を検討する必要があります。  この推奨事項に従って、正確な時間を保持するには、クロックを1秒に1回、クロック更新頻度に相関させる必要があります。 これらの設定は、予想よりも多くのバッテリ電力を消費し、そのようなデバイスで Windows で使用できる省電力モードに干渉する可能性があります。 バッテリ駆動型デバイスには、すべてのアプリケーションの実行を停止する特定の電源モードもあります。これにより、クロックを W32time's し、正確な時間を維持することができます。 また、モバイルデバイスの時計は、開始するには正確ではない場合があります。  環境環境の状態は、クロックの精度に影響します。モバイルデバイスは、あるアンビエント条件から次の状態に移行することができます。これにより、時間を正確に保つことができます。  そのため、高精度の設定でバッテリ駆動型ポータブルデバイスをセットアップすることはお勧めしません。 

## <a name="why-is-time-important"></a>時間が重要なのはなぜですか。  
正確な時間が必要になる可能性があるさまざまな理由があります。  Windows の一般的なケースは Kerberos であり、クライアントとサーバーの間には5分の精度が必要です。  ただし、次のような時間の精度によって影響を受ける可能性があるその他多くの領域があります。


- 政府の規制:
    - 米国での FINRA の 50 ms の精度
    - EU の 1 ms ESMA (MiFID II)。
- 暗号化アルゴリズム
- クラスター/SQL/Exchange やドキュメント Db などの分散システム
- Bitcoin トランザクション用のブロックチェーンフレームワーク
- 分散ログと脅威分析 
- AD レプリケーション
- PCI (支払いカード業界)、現在1秒の精度



[!INCLUDE [windows-server-2016-improvements](windows-server-2016-improvements.md)]
