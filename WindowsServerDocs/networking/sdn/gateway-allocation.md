---
title: ゲートウェイ帯域幅の割り当て
description: ''
manager: dougkim
ms.prod: windows-server
ms.technology: networking-hv-switch
ms.topic: get-started-article
ms.assetid: ''
ms.author: pashort
author: shortpatti
ms.date: 08/22/2018
ms.openlocfilehash: fc59fc9d7dc22b9c5567bae314b4312d76fcff19
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71406131"
---
# <a name="gateway-bandwidth-allocation"></a>ゲートウェイ帯域幅の割り当て

>適用対象: Windows Server

Windows Server 2016 では、IPsec、GRE、L3 の個々のトンネル帯域幅は、ゲートウェイの合計容量の比率でした。 そのため、ゲートウェイ VM の使用を想定している標準の TCP 帯域幅に基づいて、ゲートウェイの容量を提供します。

また、ゲートウェイの最大 IPsec トンネル帯域幅は、お客様が提供する\*ゲートウェイの容量3/20 に制限されていました。 たとえば、ゲートウェイの容量を 100 Mbps に設定した場合、IPsec トンネルの容量は 150 Mbps になります。 GRE トンネルと L3 トンネルの同等の比率は、それぞれ1/5 と1/2 です。

これはほとんどのデプロイでは機能していましたが、固定比率モデルは高スループット環境には適していませんでした。 データ転送率が高い (たとえば、40 Gbps を超える) 場合でも、SDN ゲートウェイトンネルの最大スループットは内部的な要因によって上限になります。

Windows Server 2019 では、トンネルの種類として、最大スループットは固定されています。

-   IPsec = 5 Gbps

-   GRE = 15 Gbps

-   L3 = 5 Gbps

そのため、ゲートウェイホスト/VM がスループットが大幅に高い Nic をサポートしている場合でも、使用可能な最大トンネルスループットは固定されています。 これによって処理されるもう1つの問題は、プロビジョニングが過剰に行われるゲートウェイです。これは、ゲートウェイの容量に非常に高い数を指定した場合に発生します。

## <a name="gateway-capacity-calculation"></a>ゲートウェイの容量計算

ゲートウェイのスループット容量をゲートウェイ VM で使用できるスループットに設定するのが理想的です。 たとえば、1つのゲートウェイ VM があり、基になるホストの NIC スループットが 25 Gbps の場合、ゲートウェイのスループットも 25 Gbps に設定できます。

ゲートウェイを IPsec 接続にのみ使用する場合、使用可能な最大容量は 5 Gbps です。 そのため、たとえば、ゲートウェイで IPsec 接続をプロビジョニングする場合は、5 Gbps として集約された帯域幅 (受信 + 送信) にのみプロビジョニングできます。

IPsec と GRE 接続の両方にゲートウェイを使用している場合は、最大 5 Gbps の IPsec スループットまたは最大 15 Gbps の GRE スループットをプロビジョニングできます。 したがって、たとえば、2 Gbps の IPsec スループットをプロビジョニングする場合、ゲートウェイにプロビジョニングする IPsec スループットが 3 Gbps 残っています。または、1 Gbps の GRE スループットが残っています。

これをさらに数学的な用語で記述するには、次のようにします。

- ゲートウェイの合計容量 = 25 Gbps

- 使用可能な IPsec 容量の合計 = 5 Gbps (固定)

- 使用可能な GRE 容量の合計 = 15 Gbps (固定)

- このゲートウェイの IPsec スループット比率 = 25/5 = 5 Gbps

- このゲートウェイの GRE スループット比率 = 25/15 = 5/3 Gbps

たとえば、2 Gbps の IPsec スループットを顧客に割り当てる場合は、次のようになります。

ゲートウェイで使用可能な残りの容量 = ゲートウェイの合計容量– IPsec スループット比 * IPsec スループット割り当て (使用済み容量)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;25-5 * 2 = 15 Gbps

ゲートウェイに割り当てることができる残りの IPsec スループット 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-2 = 3 Gbps

ゲートウェイで割り当てることができる残りの GRE スループット = ゲートウェイ/GRE スループット比の残りの容量 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15 * 3/5 = 9 Gbps

スループットの比率は、ゲートウェイの合計容量によって異なります。 1つ注意すべき点は、合計容量をゲートウェイ VM で使用可能な TCP 帯域幅に設定することです。 ゲートウェイでホストされている複数の Vm がある場合は、それに応じてゲートウェイの合計容量を調整する必要があります。

また、ゲートウェイの容量が使用可能なトンネル容量の合計よりも少ない場合は、使用可能なトンネル容量の合計がゲートウェイの容量に設定されます。 たとえば、ゲートウェイの容量を 4 Gbps に設定した場合、IPsec、L3、および GRE で使用可能な合計容量は 4 Gbps に設定され、各トンネルのスループット比率は 1 Gbps になります。

## <a name="windows-server-2016-behavior"></a>Windows Server 2016 の動作

Windows Server 2016 のゲートウェイの容量計算アルゴリズムは変更されません。 Windows Server 2016 では、最大 IPsec トンネル帯域幅は、ゲートウェイの\*ゲートウェイの容量3/20 に制限されていました。 GRE トンネルと L3 トンネルの同等の比率はそれぞれ1/5 と1/2 でした。

Windows Server 2016 から Windows Server 2019 にアップグレードする場合は、次のようにします。

1.  **GRE トンネルと L3 トンネル:** Windows Server 2019 の割り当てロジックは、ネットワークコントローラーノードが Windows Server 2019 に更新された後に有効になります。

2.  **IPSec トンネル:** ゲートウェイプール内のすべてのゲートウェイが Windows Server 2019 にアップグレードされるまで、Windows Server 2016 ゲートウェイの割り当てロジックは引き続き機能します。 ゲートウェイプール内のすべてのゲートウェイについて、Azure ゲートウェイサービスを **[自動]** に設定する必要があります。

>[!NOTE]
>Windows Server 2019 にアップグレードすると、ゲートウェイが過剰にプロビジョニングされる可能性があります (割り当てロジックが Windows Server 2016 から Windows Server 2019 に変更されるため)。 この場合、ゲートウェイ上の既存の接続は引き続き存在します。 ゲートウェイの REST リソースは、ゲートウェイが過剰にプロビジョニングされていることを示す警告をスローします。 この場合は、別のゲートウェイに接続を移動する必要があります。

---