---
title: ソフトウェア インベントリ ログのトラブルシューティング
description: ソフトウェアインベントリログの展開に関する一般的な問題を解決する方法について説明します。
ms.topic: article
author: brentfor
ms.author: coreyp
manager: lizapo
ms.date: 10/16/2017
ms.openlocfilehash: c2c00f9b3981f35e30b794d778ecc32ad712ae54
ms.sourcegitcommit: 53d526bfeddb89d28af44210a23ba417f6ce0ecf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/06/2020
ms.locfileid: "87895645"
---
# <a name="troubleshoot-software-inventory-logging"></a>ソフトウェア インベントリ ログのトラブルシューティング

>適用対象: Windows Server (半期チャネル)、Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、Windows Server 2008 R2

## <a name="understanding-sil"></a>SIL について

SIL のトラブルシューティングを開始する前に、そのコンポーネントとその動作について十分に理解しておく必要があります。 次のビデオでは、SIL アグリゲーターと SIL アグリゲーターの概要と、それらを使用してインベントリデータを転送および報告する方法について説明しています。

1. [ソフトウェアインベントリログ (SIL) の概要 (10:57)](https://channel9.msdn.com/Blogs/Regular-IT-Guy/An-Introduction-to-Software-Inventory-Logging-SIL)

2. [ソフトウェアインベントリログ: SIL アグリゲーターの設定 (14:34)](https://channel9.msdn.com/Blogs/windowsserver/Software-Inventory-Logging-Setting-up-SIL-Aggregator)

3. [ソフトウェアインベントリログ: SIL 転送の有効化 (7:20)](https://channel9.msdn.com/Blogs/windowsserver/Software-Inventory-Logging-Enabling-SIL-Forwarding)

## <a name="how-sil-data-flow-works"></a>SIL データフローのしくみ

SIL フレームワークには、2つの主要なコンポーネントと2つの通信チャネルがあります。 SIL 配置を成功させるには、両方のチャネルでのデータフローと、両方のコンポーネント間のデータフローが必要です (これは仮想化またはクラウド環境を前提としています。純粋な物理環境では、いずれかの通信チャネルのみが必要です)。 適切にデプロイするには、SIL のコンポーネントとデータフローを理解する必要があります。 上の概要ビデオを視聴すると、コンポーネントと、両方のチャネルのデータフローを示すアーキテクチャ図が表示されます。 オレンジ色の矢印は、WinRM に対するリモートクエリを示し、緑の破線の矢印は各 WS 終了ノードの SIL から SIL アグリゲーターへの HTTPS ポストを示しています。

![SIL フレームワークの図](../media/software-inventory-logging/image1.png)

SIL で問題が発生した場合は、チャネル上のデータフローとコンポーネント間の中断に関連している可能性があります。 データフローに関連する最も一般的な問題を次に示します。次のセクションでは、3つの問題のそれぞれを解決するためのトラブルシューティングの手順について説明します。

-   **データフローの問題 1** -**レポートの公開コマンドレットを使用している場合 (または一般にデータが欠落している場合)、レポートにデータがありません**。

-   **データフローの問題 2** -レポートの**不明なホストにあるサーバーが多すぎ**ます。

-   **データフローの問題 3** –レポートで**不明な OS として表示されている物理ホストの下の vm が多すぎる**、または sil を実行している Windows サーバーで**公開データ**を使用しているときに発生したエラー。

## <a name="troubleshooting-data-flow-issues"></a>データフローに関する問題のトラブルシューティング

開始する前に、SIL アグリゲーターが**開始単位のアグリゲーター**コマンドレットで開始された時間を把握しておく必要があります。

>[!IMPORTANT]
>SQL データキューブがローカルシステムの午前3時に処理されるまで、レポートにデータは表示されません。 キューブがデータを処理するまでは、トラブルシューティングの手順に進まないでください。

キューブが最後に処理された日時よりも新しい場合、またはキューブが処理される前 (新規インストールの場合) にデータをトラブルシューティングするには、次の手順に従って SQL データキューブをリアルタイムで処理します。

1. SQL Server の管理者としてログインし、コマンドプロンプトで**SSMS**を実行します。
2. データベース エンジンに接続します。
3. [ **SQL Server エージェント**] を展開し、[**ジョブ**] を展開します。
4. **SILStagingRefresh**を右クリックし、[**ステップでジョブを開始**] を選択します。
5. [**開始**] をクリックして、更新の進行状況バーが完了するまで待ちます。
6. 管理者として PowerShell を開き、**発行レポート-openreport**コマンドレットを実行します。

レポートにデータが残っていない場合は、3つのデータフローの問題のトラブルシューティングに進みます。

### <a name="data-flow-issue-1"></a>データフローの問題1

#### <a name="no-data-in-the-report-when-using-the-publish-silreport-cmdlet-or-data-is-generally-missing"></a>レポートの公開コマンドレットを使用しているときは、レポートにデータがありません (または、一般にデータが不足しています)

データが欠落している場合は、SQL データキューブがまだ処理されていないことが原因である可能性があります。 データが最近処理されていて、不足しているデータがキューブ処理の前にアグリゲーターに到着したと思われる場合は、逆の順序でデータのパスに従います。 トラブルシューティングのために、一意のホストと一意の VM を選択します。 逆方向のデータパスは、 **SILA Report** &lt; **SILA database** &lt; **ローカルディレクトリ**の &lt; **リモート物理ホスト**または**sil エージェント/タスクを実行している WS VM**を持つデータベースを持つレポートを作成することになります。

#### <a name="check-to-see-if-data-is-in-the-database"></a>データがデータベースに存在するかどうかを確認します

データを確認するには、 **Powershell**または**SSMS**の2つの方法があります。

>[!Important]
>挿入されたデータをデータベースに分割した後にキューブが少なくとも1回処理された場合は、このデータをレポートに反映する必要があります。 データベース内にデータが存在しない場合は、物理ホストのポーリングに失敗しているか、HTTPS 経由で、またはその両方が受信されていません。

 #### <a name="powershell"></a>PowerShell

1. 管理者として PowerShell を開き、 **add-silvmhost**コマンドレットを実行してから、[**取得**] をクリックします。

    >[!NOTE]
    >取得した**アグリゲーター**の出力は、Excel レポートの [ **Windows Server の詳細] タブ**で常に模倣されます。 別の結果は想定しません。

2. **Add-silvmhost を**実行します。
   - ホストが表示されていない場合は、 **add-silvmhost**コマンドレットを使用してホストを追加します。
   - ホストが [**不明**] と表示されている場合は、[問題 2] にアクセスします。
   d-ホストが一覧表示されていても、[**最近のポーリング**] 列に**Datetime**がない場合は、下の「**問題 2** 」に進んでください。

**関連するその他のコマンド**

**取得-パーティションアグリゲーター-コンピューター名 &lt; をプッシュ &gt; している既知のサーバーの fqdn**。これにより、キューブが処理される前であっても、コンピューター (VM) に関する情報がデータベースから生成されます。 したがって、このコマンドレットを使用すると、データベース内のデータをチェックして、午前3時 (または、このセクションの冒頭で説明するように、キューブをリアルタイムで更新していない場合) に、データを HTTPS、前、または使用せずにプッシュすることができます。

** &lt; Add-silvmhost コマンドレット &gt; を使用する場合、最近のポーリング列の下に値がある、ポーリングされた物理ホストの vmhostname fqdn**。これにより、キューブが処理される前であっても、物理ホストについての情報がデータベースから生成されます。

#### <a name="ssms"></a>SSMS

n**ポーリング対象のホストからデータを確認する:**

1. **SSMS**を開き、**データベースエンジン**に接続します。
2. [**データベース**] を展開し、**から softwareinventorylogging**データベースを展開します。次に、[**テーブル**] を展開し、 **hostinfo**テーブルを右クリックして、[上位1000行] を選択します。

    テーブルに1つ以上のホストのデータがある場合は、そのホストまたはホストのポーリングが少なくとも1回成功しています。

   **HTTPS 経由でデータをプッシュした Vm またはスタンドアロンサーバーからのデータを確認します。**

3. **SSMS**を開き、**データベースエンジン**に接続します。
   a2. [**データベース**] を展開し、**から softwareinventorylogging**データベースを展開します。次に、[**テーブル**] を展開し、 **vminfo**テーブルを右クリックして、上位の1000行を選択します。

    >[!NOTE]
    >一意の VM の各行は、HTTPS 経由で正常にプッシュされ、SIL アグリゲーターによって処理された1つの処理済みの**bmil**ファイルを表します。 Bmil ファイルは SIL によって使用される独自のファイルであり、sil インスタンスごとに1つ作成されます。これは、仮想環境で SIL と占有 a が使用される場合にのみ必要であることに注意してください。 それ以外の場合は、HTTPS トラフィックだけが必要/予想されます)。

   データベース内のすべてのデータは、キューブの処理後に SIL レポートに反映される必要があります。

### <a name="data-flow-issue-2"></a>データフローの問題2
#### <a name="too-many-servers-under-unknown-host"></a>不明なホストのサーバーが多すぎます

これは、SIL アグリゲーターが仮想マシンをホストしている物理ホストを正常にポーリングしない場合に、仮想環境で発生する可能性があります。

1. 管理者として**PowerShell**を開き、 **add-silvmhost**コマンドレットを実行します。

    -   ホストが [**不明**] と表示されている場合、 **add-silvmhost**コマンドレットは正常に機能しませんでした。通常は、これらのホストにアクセスするために正しくない資格情報が追加された (したがって、不明) ことが原因です。 ただし、資格情報が検証された場合は、 **add-silvmhost**コマンドレットで**hosttype**と**hypervisortype**の自動検出がプラットフォームを認識できなかったことを意味する可能性があります。 このような状況では、高度なトラブルシューティング手順を使用できますが、ここでは説明しません (EventViewer SIL アグリゲーターチャネルを確認してください)。

    -   ホストが一覧表示され、 **hosttype**および**hypervisortype**が**不明**な値と共に一覧表示されます。つまり、 Windows と HyperV、または Ubuntu と Xen などですが、[**最近のポーリング**] 列には**datetime**がないため、ポーリングが正常に実行されませんでした。

        -   ポーリングが発生するようにホストを追加した後、1時間待つ必要があります (この間隔が既定に設定されている場合は、**取得**することで確認できます)。

        -   ホストが追加されてから1時間経過した場合は、ポーリングタスクが実行されていることを確認します。**タスクスケジューラ**で、[ **Microsoft** Windows] の [**ソフトウェアインベントリログアグリゲーター** ] を選択し、 &gt; **Windows**タスクの履歴を確認します。

    -   ホストが一覧表示されていても、 **RecentPoll**、 **hosttype**、または**hypervisortype**に値がない場合は、これがほとんど無視される可能性があります。 これは、HyperV 環境でのみ発生します。 このデータは、実際には Windows Server VM から取得され、HTTPS 上で実行されている物理ホストを識別します。 これは、レポートを作成している特定の VM を識別する場合に役立ちますが、データベースのマイニングには、**取得**機能を使用する必要があります。

ホストが正しくポーリングされると、[**最近のポーリング**] の下に**datetime**がある場合は、これらの物理ホストのデータを格納することができます。 このデータを取得する手順については、上記の「問題1」セクションを参照してください。

### <a name="data-flow-issue-3"></a>データフローの問題3
#### <a name="too-many-physical-hosts-with-vms-listed-as-unknown-os"></a>不明な OS として一覧表示された Vm を含む物理ホストが多すぎます

1. これらのホストのいずれかにあることがわかっている Windows Server 終了ノード (VM) を1つ選択し、管理者としてログインします。
2. PowerShell を管理者として開きます。
3. **取得機能のログ**コマンドレットを使用して、の**ログ記録**が実行されていることを確認します。
   - を実行している場合は、**公開データ**を使用して sil データを手動でプッシュしてみてください。

   - エラーが発生した場合は、次のようになります。
     - **Targeturi**のエントリに**https://** があることを確認します。
     - すべての前提条件が満たされていることを確認する
     - Windows Server に必要なすべての更新プログラムがインストールされていることを確認します (「SIL の前提条件」を参照してください)。 (WS 2012 R2 でのみ) 確認する簡単な方法は、次のコマンドレットを使用してこれらを検索することです: **get-silwindowsupdate \* 3060、 \* 3000**
     - アグリゲーターでの認証に使用される証明書が、ローカルサーバー上の正しいストアにインストールされていることを確認**します。**
     - SIL アグリゲーターで、アグリゲーターでの認証に使用される証明書の拇印が、**セット化アグリゲーター** **– addcertificatethumbprint**コマンドレットを使用して一覧に追加されていることを確認します。
     - エンタープライズ証明書を使用する場合、SIL が有効になっているサーバーが、証明書を作成したドメインに参加していること、あるいはルート証明機関で検証できることを確認します。 アグリゲーターへのデータの転送/プッシュを試みるローカル マシン上で証明書が信頼されていない場合、この操作は失敗しエラーが返されます。

     上記のすべてが確認され、確認された場合、問題は引き続き発生します。

     - SIL アグリゲーターのインストールに使用された証明書が正常であり、SIL アグリゲーターサーバー自体の名前と一致していることを確認します。 また、SIL アグリゲーターをインストールするためにエンタープライズ証明書が使用される場合、証明書が作成したドメインにアグリゲーターを参加させる必要がある場合があります (この手順は、他のコンピューターが正常に同じ SIL アグリゲーターに転送している場合は、必要ありません)。

     -  最後に、転送/プッシュを試行するサーバー上のキャッシュされた SIL ファイルの次の場所を確認できます。 **\Windows\System32\Logfiles\SIL**です。 1時間以上が経過していて、1時間以上実行され**ている場合**、またはこのディレクトリにファイルが存在しない場合、アグリゲーターへのログ**記録は正常**に実行されています。

エラーが発生せず、コンソールに出力がない場合、HTTPS 経由で Windows Server 終了ノードから SIL アグリゲーターへのデータプッシュ/発行は成功しました。 データ転送のパスに従うには、SIL アグリゲーターに管理者としてログインし、到着したデータファイルを確認します。 **Program Files (x86)** &gt; **Microsoft sil アグリゲーター**にアクセスして &gt; 、ディレクトリを表示します。 リアルタイムで受信したデータファイルを監視することができます。

>[!NOTE]
>複数のデータファイルが、公開された**データ**コマンドレットを使用して転送されている可能性があります。 終了ノードの SIL は、最大30日間、失敗したプッシュをキャッシュします。 次に成功したプッシュでは、すべてのデータファイルが処理のためにアグリゲーターに送られます。 これにより、新しく設定された SIL アグリゲーターは、独自のセットアップの前に、最後のノードからのデータを表示できます。

>[!NOTE]
>トラフィックの少ない状況でのみ関連するディレクトリ内のデータファイルを処理するときに、次の規則が適用されます。 高トラフィックでは、常にリアルタイムで処理がトリガーされます。 既定の動作では、100ファイルがディレクトリに到着した後、または15分後に処理が開始されます。 小規模な環境でエンドツーエンドのトラブルシューティングを行う場合、多くの場合、15分間待機する必要があります。

これらのファイルが処理されると、データベース内のデータが表示されます。
