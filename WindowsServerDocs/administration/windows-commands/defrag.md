---
title: defrag
description: デフラグコマンドの参照記事。ローカルボリューム上の断片化されたファイルを特定して統合し、システムのパフォーマンスを向上させます。
ms.prod: windows-server
ms.technology: manage-windows-commands
ms.topic: article
ms.assetid: aaf1d1ac-996a-4282-9b4d-1e8245ff162c
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: c952ff78147d3b4c6097aaf9dd87e55ecc7911ad
ms.sourcegitcommit: 2afed2461574a3f53f84fc9ec28d86df3b335685
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/02/2020
ms.locfileid: "85928791"
---
# <a name="defrag"></a>defrag

> 適用対象: Windows 10、Windows Server (半期チャネル)、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

システムパフォーマンスを向上させるために、ローカルボリューム上の断片化されたファイルを検索して統合します。

このコマンドを実行するには、ローカルの**Administrators**グループのメンバーシップ、またはそれと同等のメンバーシップが最低限必要です。

## <a name="syntax"></a>構文

```
defrag <volumes> | /c | /e <volumes>    [/h] [/m [n]| [/u] [v]]
defrag <volumes> | /c | /e <volumes> /a [/h] [/m [n]| [/u] [v]]
defrag <volumes> | /c | /e <volumes> /x [/h] [/m [n]| [/u] [v]]
defrag <volume> [<parameters>]
```

### <a name="parameters"></a>パラメーター

| パラメーター | 説明 |
| --------- | ----------- |
| `<volume>` | 最適化または分析するボリュームのドライブ文字またはマウントポイントパスを指定します。 |
| /a | 指定されたボリュームで分析を実行します。 |
| /c | すべてのボリュームに対して操作を実行します。 |
| /d | 従来のデフラグを実行します (これが既定値です)。 ただし、階層化ボリュームでは、従来のデフラグは容量レベルでのみ実行されます。 |
| /e | 指定されたものを除くすべてのボリュームに対して操作を実行します。 |
| /g | 指定されたボリューム上の記憶域階層を最適化します。 |
| /h | 通常の優先度 (既定値は low) で操作を実行します。 |
| /i [n] | 階層の最適化は、各ボリュームで n 秒間実行されます。 |
| /k | 指定されたボリュームでスラブ統合を実行します。 |
| /l | 指定されたボリュームで retrim を実行します。 |
| /m [n] | バックグラウンドで、各ボリュームに対して操作を並行して実行します。 最大 n 個のスレッドで、ストレージ層を並行して最適化します。 |
| /o | メディアの種類ごとに適切な最適化を実行します。 |
| /t | 指定されたボリュームで既に実行中の操作を追跡します。 |
| /U | 操作の進行状況を画面に出力します。 |
| /v | 断片化の統計情報を含む詳細出力を印刷します。 |
| /x | 指定されたボリュームで空き領域の統合を実行します。 |
| /? | このヘルプ情報を表示します。 |

#### <a name="remarks"></a>注釈

- 次のような特定のファイルシステムのボリュームまたはドライブを最適化することはできません。

  - ファイルシステムによってロックされているボリューム。

  - ファイルシステムがダーティとマークされていることを示すボリューム。破損している可能性があることを示します。<br>このボリュームまたはドライブを最適化するには、を実行する必要があり `chkdsk` ます。 コマンドを使用して、ボリュームがダーティかどうかを確認でき `fsutil dirty` ます。

  - ネットワークドライブ。

  - CD-ROM。

  - **NTFS**、 **ReFS**、 **Fat** 、 **Fat32**以外のファイルシステムボリューム。

- SSD に存在するバーチャルハードディスク (VHD) 上のソリッドステートドライブ (SSD) またはボリュームの最適化をスケジュールすることはできません。

- この手順を実行するには、ローカル コンピューターの Administrators グループのメンバーであるか、適切な権限が委任されている必要があります。 コンピューターがドメインに追加されると、Domain Admins グループのメンバーは、この手順を実行できる場合があります。 セキュリティのベストプラクティスとして、この手順を実行するには、**実行と**しての使用を検討してください。

- ボリュームには、**デフラグ**を完全かつ適切に最適化するために、少なくとも15% の空き領域が必要です。 **デフラグ**では、ファイルフラグメントの並べ替え領域としてこの領域が使用されます。 ボリュームの空き領域が15% 未満の場合、**デフラグ**では部分的な最適化のみが行われます。 ボリュームの空き領域を増やすには、不要なファイルを削除するか、別のディスクに移動します。

- **デフラグ**では、ボリュームの分析と最適化が実行されている間、点滅しているカーソルが表示されます。 **デフラグ**でボリュームの分析と最適化が完了すると、分析レポート、最適化レポート、またはその両方のレポートが表示され、コマンドプロンプトが終了します。

- 既定では、 **/a**パラメーターまたは **/v**パラメーターを指定しない場合、**デフラグ**は分析レポートと最適化レポートの両方の概要を表示します。

- FileName.txtを入力してレポートをテキストファイルに送信でき **>** <em>FileName.txt</em>ます。ここで*FileName.txt*は指定したファイル名です。 例: `defrag volume /v > FileName.txt`

- 最適化プロセスを中断するには、コマンドラインで**ctrl + C**キーを押します。

- **デフラグ**コマンドとディスクデフラグツールを同時に実行することはできません。 ディスクデフラグツールを使用してボリュームを最適化しているときに、コマンドラインで**デフラグ**コマンドを実行した場合、 **defrag**コマンドは失敗します。 逆に、**デフラグ**コマンドを実行してディスクデフラグツールを開くと、ディスクデフラグツールの最適化オプションは使用できません。

## <a name="examples"></a>例

進行状況と詳細出力を提供しながらドライブ C のボリュームを最適化するには、次のように入力します。

```
defrag c: /u /v
```

バックグラウンドでドライブ C と D のボリュームを並行して最適化するには、次のように入力します。

```
defrag c: d: /m
```

ドライブ C にマウントされたボリュームの断片化分析を実行し、進行状況を提供するには、次のように入力します。

```
defrag c: mountpoint /a /u
```

通常の優先順位ですべてのボリュームを最適化し、詳細な出力を提供するには、次のように入力します。

```
defrag /c /h /v
```

## <a name="scheduled-task"></a>スケジュールされたタスク

最適化プロセスでは、通常は毎週実行されるメンテナンスタスクとして、スケジュールされたタスクを実行します。 管理者は、[**ドライブの最適化**] アプリを使用して、タスクの実行頻度を変更できます。

- **デフラグ**では、スケジュールされたタスクから実行すると、ssd に関する以下のポリシーガイドラインを使用します。

  - **従来の最適化プロセス**。 には**従来の最適化**が含まれています。たとえば、ファイルを移動して、適度に連続して**retrim**にすることができます。 これは1か月に1回実行されます。 ただし、従来の**最適化**と**retrim**の両方をスキップした場合、**分析**は実行されません。

  - 通常のスケジュールされた実行の間に、SSD で**従来の最適化**を手動で実行すると、次回のスケジュールされたタスクの実行で**分析**と**retrim**が実行されますが、その ssd では**従来の最適化**がスキップされます。

  - **分析**をスキップした場合、[**ドライブの最適化**] アプリに**最終実行**時刻が更新されません。 そのため、最後の**実行**時刻は1か月以内になることがあります。

  - スケジュールされたタスクによってすべてのボリュームが最適化されていないことがわかります。 一般的な原因は次のとおりです。

    - このプロセスでは、コンピューターをスリープ解除して実行することはありません。

    - コンピューターが電源に接続されていません。 コンピューターがバッテリ電源で動作している場合、このプロセスは実行されません。

    - コンピューターがバックアップを開始しました (アイドル状態から再開されました)。

## <a name="additional-references"></a>その他の参照情報

- [コマンド ライン構文の記号](command-line-syntax-key.md)

- [chkdsk](chkdsk.md)

- [fsutil](fsutil.md)

- [fsutil dirty](fsutil-dirty.md)

- [最適化-ボリューム Powershell](https://docs.microsoft.com/powershell/module/storage/optimize-volume?view=win10-ps)
