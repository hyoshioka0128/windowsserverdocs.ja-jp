---
title: defrag
description: システムパフォーマンスを向上させるために、ローカルボリューム上の断片化したファイルを特定して統合する、defrag のリファレンストピックです。
ms.prod: windows-server
ms.technology: manage-windows-commands
ms.topic: article
ms.assetid: aaf1d1ac-996a-4282-9b4d-1e8245ff162c
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: 47a19ec697da29b1eff152de8fc5930516d5b806
ms.sourcegitcommit: ab64dc83fca28039416c26226815502d0193500c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/01/2020
ms.locfileid: "82716765"
---
# <a name="defrag"></a>defrag

> 適用対象: Windows 10、Windows Server (半期チャネル)、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

システムパフォーマンスを向上させるために、ローカルボリューム上の断片化されたファイルを検索して統合します。

このコマンドを実行するには、ローカルの**Administrators**グループのメンバーシップ、またはそれと同等のメンバーシップが最低限必要です。

## <a name="syntax"></a>構文
```
defrag <volumes> | /C | /E <volumes>    [/H] [/M [n]| [/U] [/V]]
defrag <volumes> | /C | /E <volumes> /A [/H] [/M [n]| [/U] [/V]]
defrag <volumes> | /C | /E <volumes> /X [/H] [/M [n]| [/U] [/V]]
defrag <volume> [/<Parameter>]*
```
### <a name="parameters"></a>パラメーター

|パラメーター|[説明]|
|-------|--------|
|`<volume>`|最適化または分析するボリュームのドライブ文字またはマウントポイントパスを指定します。|
|A|指定されたボリュームで分析を実行します。|
|C|すべてのボリュームに対して操作を実行します。|
|D|従来のデフラグを実行します (これが既定値です)。 ただし、階層化ボリュームでは、従来のデフラグは容量レベルでのみ実行されます。|
|E|指定されたものを除くすべてのボリュームに対して操作を実行します。|
|G|指定されたボリューム上の記憶域階層を最適化します。|
|H|通常の優先度 (既定値は low) で操作を実行します。|
|I n|階層の最適化は、各ボリュームで n 秒間実行されます。|
|K|指定されたボリュームでスラブ統合を実行します。|
|L|指定されたボリュームで retrim を実行します。|
|M [n]|バックグラウンドで、各ボリュームに対して操作を並行して実行します。 最大 n 個のスレッドで、ストレージ層を並行して最適化します。|
|O|メディアの種類ごとに適切な最適化を実行します。|
|T|指定されたボリュームで既に実行中の操作を追跡します。|
|U|操作の進行状況を画面に出力します。|
|V|断片化の統計情報を含む詳細出力を印刷します。|
|X|指定されたボリュームで空き領域の統合を実行します。|
|?|このヘルプ情報を表示します。|

## <a name="remarks"></a>Remarks
- 特定の種類のファイルシステムのボリュームまたはドライブを最適化することはできません。
  -   ファイルシステムによってロックされているボリュームを最適化することはできません。
  -   ファイルシステムがダーティとマークしているボリュームを最適化することはできません。これは破損の可能性を示します。 断片化を解消するには、ダーティボリュームで**chkdsk**を実行する必要があります。 ボリュームがダーティかどうかを確認するには、 **fsutil** dirty query コマンドを使用します。 **Chkdsk**と**fsutil** dirty の詳細については、「[その他の参照](defrag.md#BKMK_additionalRef)情報」を参照してください。
  -   ネットワークドライブを最適化することはできません。
  -   CdROMs を最適化することはできません。
  -   **NTFS**、 **ReFS**、 **Fat** 、 **Fat32**以外のファイルシステムボリュームを最適化することはできません。
- Windows Server 2008 R2、Windows Server 2008、および Windows Vista では、ボリュームの最適化をスケジュールすることができます。 ただし、SSD に存在するバーチャルハードディスク (VHD) 上のソリッドステートドライブ (SSD) またはボリュームの最適化をスケジュールすることはできません。
- この手順を実行するには、ローカル コンピューターの Administrators グループのメンバーであるか、適切な権限が委任されている必要があります。 コンピューターがドメインに追加されると、Domain Admins グループのメンバーは、この手順を実行できる場合があります。 セキュリティのベストプラクティスとして、この手順を実行するには、**実行と**しての使用を検討してください。
- ボリュームには、**デフラグ**を完全かつ適切に最適化するために、少なくとも15% の空き領域が必要です。 **デフラグ**では、ファイルフラグメントの並べ替え領域としてこの領域が使用されます。 ボリュームの空き領域が15% 未満の場合、**デフラグ**では部分的な最適化のみが行われます。 ボリュームの空き領域を増やすには、不要なファイルを削除するか、別のディスクに移動します。
- **デフラグ**では、ボリュームの分析と最適化が実行されている間、点滅しているカーソルが表示されます。 **デフラグ**でボリュームの分析と最適化が完了すると、分析レポート、最適化レポート、またはその両方のレポートが表示され、コマンドプロンプトが終了します。
- 既定では、 **/a**パラメーターまたは **/v**パラメーターを指定しない場合、**デフラグ**は分析レポートと最適化レポートの両方の概要を表示します。
- **>** <em>Filename .txt</em>と入力すると、レポートをテキストファイルに送信できます。ここで、 *filename*は指定したファイル名です。 例: `defrag volume /v > FileName.txt`
- 最適化プロセスを中断するには、コマンドラインで**ctrl + C**キーを押します。
- **デフラグ**コマンドとディスクデフラグツールを同時に実行することはできません。 ディスクデフラグツールを使用してボリュームを最適化しているときに、コマンドラインで**デフラグ**コマンドを実行した場合、 **defrag**コマンドは失敗します。 逆に、**デフラグ**コマンドを実行してディスクデフラグツールを開くと、ディスクデフラグツールの最適化オプションは使用できません。

## <a name="examples"></a>例
進行状況と詳細出力を提供しながらドライブ C のボリュームを最適化するには、次のように入力します。
```
defrag C: /U /V
```
バックグラウンドでドライブ C と D のボリュームを並行して最適化するには、次のように入力します。
```
defrag C: D: /M
```
ドライブ C にマウントされたボリュームの断片化分析を実行し、進行状況を提供するには、次のように入力します。
```
defrag C: mountpoint /A /U
```
通常の優先順位ですべてのボリュームを最適化し、詳細な出力を提供するには、次のように入力します。
```
defrag /C /H /V
```

## <a name="scheduled-task"></a><a name=BKMK_scheduledTask></a>スケジュールされたタスク
デフラグのスケジュールされたタスクは、メンテナンスタスクとして実行され、通常は毎週実行されるようにスケジュールされます。 管理者は、[**ドライブの最適化**アプリケーションを使用して頻度を変更できます。
- スケジュールされたタスクから実行すると、 **defrag**は ssd のポリシーを下回っています。
   - **従来のデフラグ**(つまり、ファイルを移動して適度に連続するようにする) と**retrim**は、毎月1回だけ実行されます。
   - 従来の**defrag**と**retrim**の両方がスキップされた場合、**分析**は実行されません。
      - ユーザーが SSD で**従来のデフラグ**を手動で実行した場合、スケジュールされた最後のタスクが実行されてから3週間後に、次回のスケジュールされたタスクの実行で**分析**と**retrim**が実行されますが、その SSD では**従来のデフラグ**はスキップされます。
   - **分析**がスキップされた場合、[**ドライブの最適化**] の最後の**実行**時間は更新されません。  そのため、Ssd の場合、**ドライブの最適化**では、**最後の実行**時刻を1か月前にすることができます。
- このタスクでは、次の処理が行われるため、すべてのボリュームを最適化することはできません。
   - デフラグを実行するためにコンピューターをスリープ解除しない
   - コンピューターが AC 電源を搭載している場合にのみ起動し、コンピューターがバッテリ電源に切り替わった場合に停止します
   - コンピューターがアイドル状態でない場合に停止します

## <a name="additional-references"></a><a name=BKMK_additionalRef></a>その他の参照情報
-   [chkdsk](chkdsk.md)
-   [fsutil](fsutil.md)
-   [fsutil ダーティ](fsutil-dirty.md)
-   - [コマンド ライン構文の記号](command-line-syntax-key.md)
