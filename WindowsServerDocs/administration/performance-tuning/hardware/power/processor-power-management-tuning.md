---
title: Windows Server のバランスの取れた電源プランのプロセッサ電源管理 (PPM) のチューニング
description: Windows Server のバランスの取れた電源プランのプロセッサ電源管理 (PPM) のチューニング
ms.topic: conceptual
ms.author: qizha;tristanb
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 9b45ad16981667eff626278daadbe8b39f5cc5c8
ms.sourcegitcommit: 53d526bfeddb89d28af44210a23ba417f6ce0ecf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/06/2020
ms.locfileid: "87896717"
---
# <a name="processor-power-management-ppm-tuning-for-the-windows-server-balanced-power-plan"></a>Windows Server のバランスの取れた電源プランのプロセッサ電源管理 (PPM) のチューニング

Windows server 2008 以降、Windows Server では、**バランス**、**高パフォーマンス**、**省電力**の3つの電源プランが提供されています。 **バランス**の取れた電源プランは、典型的なサーバーワークロードに最適なエネルギー効率を与えることを目的とした既定の選択肢です。 このトピックでは、Windows の過去のいくつかのリリースについて、**バランス**スキームの既定の設定を決定するために使用されたワークロードについて説明します。

これらのワークロードよりも大幅に異なるワークロード特性、パフォーマンス、および電力要件を持つサーバーシステムを実行する場合は、既定の電源設定を調整することを検討してください (つまり、カスタム電源プランを作成します)。 便利なチューニング情報のソースの1つは、[サーバーハードウェアの電源に関する考慮事項](../power.md)です。 または、**高パフォーマンス**の電源プランを環境に適した選択肢にすることもできます。これは、何らかのレベルの応答性を向上させるために exchange で大きなエネルギーヒットが生じる可能性があることを示している場合があります。

> [!IMPORTANT]
> カスタム設定を作成する特別なニーズがなく、結果がワークロードの特性によって異なることを理解している場合を除き、Windows Server に含まれている電源ポリシーを活用する必要があります。

## <a name="windows-processor-power-tuning-methodology"></a>Windows プロセッサの電力チューニング方法

### <a name="tested-workloads"></a>テストされたワークロード

ワークロードは、"通常の" Windows Server のワークロードのベストエフォートセットに対応するために選択されます。 当然ながら、このセットは、実際のサーバー環境全体を代表するためのものではありません。

各電源ポリシーの調整は、次の5つのワークロードによって行われます。

- **IIS Web サーバーワークロード**

    IIS Web サーバーを実行しているプラットフォームのエネルギー効率を最適化するために、Web 基礎と呼ばれる Microsoft 内部ベンチマークが使用されます。 セットアップには、web サーバーと、web アクセストラフィックをシミュレートする複数のクライアントが含まれています。 動的、静的ホット (メモリ内)、および静的コールド (ディスクアクセスが必要) の web ページの分布は、実稼働サーバーの統計的な調査に基づいています。 サーバーの CPU コアを完全使用率 (テスト対象の範囲の一端) にプッシュするには、セットアップに十分な速度のネットワークリソースとディスクリソースが必要です。

- **SQL Server データベースワークロード**

    [TPC-E](http://www.tpc.org/tpce/default.asp)ベンチマークは、データベースパフォーマンス分析のための一般的なベンチマークです。 これは、PPM チューニング最適化の OLTP ワークロードを生成するために使用されます。 このワークロードには非常に多くのディスク i/o があるため、記憶域システムとメモリサイズのパフォーマンス要件が高くなります。

- **ファイルサーバーのワークロード**

    [FSCT](http://www.snia.org/sites/default/files2/sdc_archives/2009_presentations/tuesday/BartoszNyczkowski-JianYan_FileServerCapacityTool.pdf)と呼ばれる Microsoft が開発したベンチマークは、SMB ファイルサーバーのワークロードを生成するために使用されます。 サーバー上に大きなファイルセットを作成し、多くのクライアントシステム (実際または仮想化) を使用して、ファイルのオープン、クローズ、読み取り、書き込み操作を生成します。 操作ミックスは、実稼働サーバーの統計スタディに基づいています。 CPU、ディスク、およびネットワークリソースがストレスになります。

- **SPECpower – JAVA ワークロード**

    [Specpower \_ ssj2008](http://spec.org/power_ssj2008/)は、電力とパフォーマンスの特性を共同で評価する業界標準の仕様ベンチマークです。 CPU 負荷レベルが異なるサーバー側の Java ワークロードです。 多くのディスクリソースやネットワークリソースは必要ありませんが、メモリ帯域幅の特定の要件があります。 ほとんどすべての CPU アクティビティは、ユーザーモードで実行されます。カーネルモードのアクティビティは、電源管理の決定を除けば、ベンチマークのパワーとパフォーマンスの特性にあまり影響しません。

- **アプリケーションサーバーのワークロード**

    [SAP SD](http://global.sap.com/campaigns/benchmark/index.epx)ベンチマークは、アプリケーションサーバーのワークロードを生成するために使用されます。 2層のセットアップが使用されます。これは、データベースとアプリケーションサーバーが同じサーバーホスト上にあります。 このワークロードでは、パフォーマンスメトリックとして応答時間も利用されます。これは、テストされた他のワークロードとは異なります。 したがって、このパラメーターは、PPM パラメーターの応答性に対する影響を確認するために使用されます。 それにもかかわらず、待機時間の影響を受けるすべての運用ワークロードを代表することは意図されていません。

SPECpower を除くすべてのベンチマークは、当初はパフォーマンス分析向けに設計されているため、ピーク時の負荷レベルで実行するように作成されました。 ただし、中間の負荷レベルは、実際の運用サーバーではより一般的であり、**バランス**の取れたプランの最適化にはより興味深いものです。 さまざまな調整方法 (たとえば、アクティブなユーザー/クライアントの数を減らすなど) を使用して、さまざまな負荷レベルでベンチマークを100% から10% に (10% のステップで) 意図的に実行しました。

### <a name="hardware-configurations"></a>ハードウェア構成

Windows の各リリースでは、最新の実稼働サーバーが電源プランの分析および最適化プロセスで使用されます。 場合によっては、リリーススケジュールが次の Windows リリースと一致する実稼働前システムでテストが実行されています。

ほとんどのサーバーは 1 ~ 4 個のプロセッサソケットで販売されていますが、スケールアップサーバーでは、主な懸念事項としてエネルギー効率が低い可能性が低いため、電源プランの最適化テストは主に2ソケットおよび4ソケットシステムで実行されます。 各テストの RAM、ディスク、およびネットワークリソースの量を選択して、各システムが完全な容量までのすべての処理を実行できるようにします。一方、構成を適切な状態に保つなど、実際のサーバー環境に適したコスト制限を考慮してください。

> [!IMPORTANT]
> システムはピーク時の負荷で実行できますが、通常、ピーク時の負荷レベルで実行されるサーバーは高パフォーマンスの電源プランを使用することをお勧めします。これは、エネルギー効率が高い優先度でない限り、**高パフォーマンス**の電源プランを使用することをお勧めします。

### <a name="metrics"></a>メトリック

テストされたすべてのベンチマークは、パフォーマンスメトリックとしてスループットを使用します。 応答時間は、これらのワークロードの SLA 要件と見なされます (ただし、プライマリメトリックである SAP は除きます)。 たとえば、ベンチマークの実行は、平均または最大の応答時間が特定の値未満の場合、"有効" と見なされます。

そのため、PPM チューニング分析では、パフォーマンスメトリックとしてスループットも使用されます。  最大の負荷レベル (100% の CPU 使用率) では、スループットが電源管理の最適化によって数パーセントを下回ることはありません。 ただし、主な考慮事項は、中レベルと低負荷レベルで電力効率を最大化することです (下記を参照)。

![電力効率の式](../../media/serverperf-ppm-formula.jpg)

CPU コアを低周波数で実行すると、エネルギー消費量が削減されます。 ただし、頻度が低いと、通常はスループットが低下し、応答時間が長くなります。 **バランス**の取れた電源プランでは、応答性と電力効率が意図的にトレードオフになっています。 SAP ワークロードテスト、およびその他のワークロードに対する応答時間の Sla は、これらの特定のワークロードについて、応答時間の増加が特定のしきい値 (例として 5%) を超えないようにする必要があります。

> [!NOTE]
> ワークロードがパフォーマンスメトリックとして応答時間を使用している場合、[迅速な応答時間のために、推奨されるバランスのとれた電源プランのパラメーター](recommended-balanced-plan-parameters.md)で提案されているように、システムは**高パフォーマンス**の電源プランに切り替えるか、**バランス**の取れた電源プランを変更する必要があります。

### <a name="tuning-results"></a>チューニング結果

Windows Server 2008 以降、Microsoft は Intel および AMD と連携して、Windows の各リリースの最新のサーバープロセッサに対応する PPM パラメーターを最適化しました。 以前に説明した各ワークロードで多数の PPM パラメーターの組み合わせがテストされ、さまざまな負荷レベルで最適な電力効率が得られました。 ソフトウェアアルゴリズムが改良され、ハードウェアの電源アーキテクチャが進化するにつれて、各新しい Windows Server は、テストされたワークロードの範囲全体において、以前のバージョンよりも電力効率が向上しています。

次の図は、Windows Server 2008 R2 を実行している4ソケット運用サーバー上のさまざまな TPC-E 負荷レベルでの電力効率の例を示しています。 これは、Windows Server 2008 と比較して、中程度の負荷レベルで8% 向上したことを示しています。

![電力効率の比較](../../media/serverperf-ppm-figure1.jpg)

## <a name="customized-tuning-suggestions"></a>カスタマイズされたチューニングの提案

主なワークロード特性が、既定の**バランス**の取れた電源プラン PPM のチューニングに使用される5つのワークロードと大きく異なる場合は、1つまたは複数の PPM パラメーターを変更して、環境に最適なサイズを見つけることができます。

パラメーターの数と複雑さにより、これは困難な作業になる可能性がありますが、特定の環境におけるエネルギー消費とワークロードの有効性のトレードオフを検討している場合は、労力が必要になる可能性があります。

 チューニング可能な PPM パラメーターの完全なセットについては、「[プロセッサ電源管理のチューニング](https://msdn.microsoft.com/windows/hardware/gg566941.aspx)」を参照してください。 まず、次のような最も単純な電源パラメーターを使用できます。

-   **プロセッサパフォーマンスの向上しきい値とプロセッサパフォーマンスの向上時間**–大きい値を指定すると、パフォーマンスの向上によるアクティビティの増加が遅くなります。

-   **プロセッサパフォーマンスの低下しきい値**–アイドル期間に電力を速度する大きな値

-   **プロセッサのパフォーマンスが低下**する-アイドル期間中、大きな値を超えるとパフォーマンスが徐々に低下します。

-   **プロセッサパフォーマンスの向上ポリシー** – "Single" ポリシーによって、パフォーマンスの向上と継続的なアクティビティへの対応が遅くなります。"ロケット" ポリシーは、アクティビティの増加にすばやく反応します。

-   **プロセッサのパフォーマンス低下ポリシー** – "Single" ポリシーは、より長いアイドル期間にわたってパフォーマンスを徐々に低下させます。"ロケット" ポリシーは、アイドル期間を入力したときにすぐに電力を削除します。

>[!Important]
> 実験を開始する前に、まずワークロードを把握しておく必要があります。これは、PPM のパラメーターを適切に選択し、チューニング作業を減らすのに役立ちます。

### <a name="understand-high-level-performance-and-power-requirements"></a>高レベルのパフォーマンスと電力の要件を理解する

ワークロードが "リアルタイム" である場合 (たとえば、glitching やその他の表示可能なエンドユーザーの影響を受ける可能性があります)、または非常に厳格な応答性の要件 (株式仲介など) がある場合は、**高パフォーマンス**の電源プランに切り替えることをお勧めします。 それ以外の場合は、ワークロードの応答時間の要件を理解し、その要件を満たす最適な電力効率のために PPM のパラメーターを調整する必要があります。

### <a name="understand-underlying-workload-characteristics"></a>基になるワークロードの特性を理解する

ワークロードを把握し、チューニング用の実験パラメーターセットを設計する必要があります。 たとえば、CPU コアの周波数が非常に高速である必要がある場合 (おそらく、アイドル期間が非常に長いバーストワークロードがある場合)、しかし、新しいトランザクションが発生したときに非常に迅速な応答性が必要になります。その後、プロセッサのパフォーマンスの向上に関するポリシーを "ロケット" に設定する必要があります (名前が示すとおり、CPU コアの頻度は、一定の時間にわたってステップアップするのではなく、最大値になります)。

ワークロードが非常にバーストの場合、PPM のチェック間隔を短縮して、バーストが到着した後に CPU の周波数のステップアップを開始することができます。 ワークロードに高いスレッド同時実行性がない場合、コアパーキングを有効にすることで、より少ない数のコアでワークロードを強制的に実行できます。これにより、プロセッサキャッシュのヒット率が向上する可能性もあります。

CPU の周波数を中程度の使用率レベルで増加させたい場合 (つまり、ワークロードレベルが軽い場合)、プロセッサパフォーマンスの増減しきい値を調整して、特定のレベルのアクティビティが観察されるまで対応できないようにすることができます。

### <a name="understand-periodic-behaviors"></a>定期的な動作の理解

日中と夜間、週末、または異なる時間に実行されるワークロードが異なる場合があります。 この場合、1セットの PPM パラメーターがすべての期間に最適であるとは限りません。 複数のカスタム電源プランを考案できるため、さまざまな時間帯を調整し、スクリプトまたはその他の動的システム構成の方法を使用して電源プランを切り替えることもできます。

この場合も、最適化プロセスの複雑さが増します。このため、この種類のチューニングによって得られる価値は、ハードウェアのアップグレードやワークロードが大幅に変更されたときに繰り返す必要があると考えられます。

このため、Windows では最初に**バランス**の取れた電源プランが提供されているので、多くの場合、特定のサーバー上の特定のワークロードに対して手動チューニングを行う必要はありません。

## <a name="see-also"></a>参照
- [サーバーのハードウェア パフォーマンスに関する考慮事項](../index.md)
- [サーバー ハードウェアの電源に関する考慮事項](../power.md)
- [電源とパフォーマンスのチューニング](power-performance-tuning.md)
- [プロセッサの電源管理チューニング](processor-power-management-tuning.md)
- [推奨されるバランスのプラン パラメーター](recommended-balanced-plan-parameters.md)
