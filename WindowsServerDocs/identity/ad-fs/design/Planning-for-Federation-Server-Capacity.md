---
ms.assetid: 7013fc21-9ced-4f9d-9588-cb04d6d60924
title: フェデレーション サーバーのキャパシティ プランニング
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: 63bc6291ea837e96660d6aba8f37374ef4e06b8a
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2020
ms.locfileid: "87947503"
---
# <a name="planning-for-federation-server-capacity"></a>フェデレーション サーバーのキャパシティ プランニング

フェデレーションサーバーの容量計画では、次のことを見積もることができます。

-   AD FS 構成データベースのサイズを増やす要因。

-   各フェデレーションサーバーの適切なハードウェア要件。

-   各組織に配置するフェデレーションサーバーの数。

フェデレーションサーバーは、ユーザーにセキュリティトークンを発行します。 これらのトークンは、使用のために証明書利用者に提示されます。 フェデレーションサーバーは、ユーザーを認証した後、または以前にパートナーフェデレーションサービスによって発行されたセキュリティトークンを受信した後に、セキュリティトークンを発行します。 ユーザーがフェデレーションアプリケーションに初めてサインインしたとき、またはセキュリティトークンがフェデレーションアプリケーションにアクセスしている間に期限切れになったときに、フェデレーションサービスからセキュリティトークンが要求されます。

フェデレーションサーバーは、 \- Microsoft ネットワーク負荷分散 NLB テクノロジを使用する高可用性サーバーファーム構成に対応するように設計されてい \( \) ます。 ファーム構成のフェデレーションサーバーは、要求ごとに共通のファームコンポーネントにアクセスすることなく、個別に要求を処理できます。 そのため、フェデレーションサーバーの展開をスケールアウトする際には、オーバーヘッドがほとんど発生しません。

**推奨事項:**

-   ミッション \- クリティカルまたは高可用性の展開では、 \- フォールトトレランスを提供するために、各パートナー組織に小規模なフェデレーションサーバーファームを作成し、ファームごとに少なくとも2つのフェデレーションサーバーを作成することをお勧めします。

-   高可用性を必要とし、フェデレーションサーバーを簡単にスケールアウトできるようにするために、特定のフェデレーションサービスに対して1秒あたりの要求の数が多い場合は、スケールアウトを使用することをお勧めします。 このガイドで基本構成を超えてスケールアップすると、容量の処理能力が大幅に向上することはほとんどありません。

## <a name="ad-fs-configuration-database-size-and-growth"></a>構成データベースのサイズと拡張の AD FS
AD FS 構成データベースのサイズは、通常は小さいと見なされ、AD FS の配置ではデータベースのサイズが大きな考慮事項になるとは限りません。  AD FS 構成データベースの正確なサイズは、信頼関係の数と、 \- それぞれの信頼に対して構成された要求、要求規則、監視設定などの関連する信頼関連メタデータに大きく依存します。 構成データベース内の信頼エントリの数が増えるにつれて、より多くのディスク領域が必要になります。

AD FS 構成データベースのその他の展開情報については、「 [AD FS 展開トポロジに関する考慮事項](AD-FS-Deployment-Topology-Considerations.md)」を参照してください。

## <a name="memory-cpu-and-disk-space-requirements"></a>メモリ、CPU、およびディスク領域の要件
幸いにも、フェデレーションサーバーのメモリ、CPU、およびディスク領域の要件は適度であり、ハードウェアの決定に推進要因となることはほとんどありません。 ハードウェア要件の詳細については、「[付録 a: AD FS の要件の確認](Appendix-A--Reviewing-AD-FS-Requirements.md)」を参照してください。

> [!NOTE]
> AD FS 構成データベースを格納するために専用の SQL Server で構成されたフェデレーションサーバーファームを使用して AD FS 製品チームによって実行されたテストでは、SQL Server の全体的な負荷は低くなります。 1つの SQL Server を使用するように構成された4つのフェデレーションサーバーファームを使用しているテストでは、1つのテストでは、 \- \- フェデレーションサーバーをターゲットの使用率にするために、CPU 使用率が10% を超えることはありません。

## <a name="estimate-the-number-of-federation-servers-for-your-organization"></a><a name="bk_estimatefs"></a>組織のフェデレーション サーバー数の見積もり
フェデレーションサーバーのハードウェア計画プロセスを効率化するための取り組みとして、AD FS 製品チームは、AD FS 容量計画のサイジングスプレッドシートを開発しました。 この Excel スプレッドシートには、 \- 組織内のユーザーについて提供する予想される使用状況データを取得し、AD FS 運用環境で推奨される最適なフェデレーションサーバーの数を返す、機能などの電卓が含まれています。

> [!NOTE]
> このスプレッドシートで推奨されるフェデレーションサーバーの数は、AD FS 製品チームがテスト時に使用したハードウェアとネットワークの仕様に基づいています。 そのため、このコンテキストでは、スプレッドシートで推奨されるフェデレーションサーバーの数を理解する必要があります。  テスト中に使用される仕様の詳細については、「 [Planning for AD FS Server Capacity](Planning-for-AD-FS-Server-Capacity.md)」を参照してください。

### <a name="using-the-ad-fs-capacity-planning-sizing-spreadsheet"></a>AD FS 容量計画のサイジングスプレッドシートの使用
このスプレッドシートを使用する場合は、 \( ピーク時の使用期間中にフェデレーションサーバーに認証要求を送信するユーザーの総数の割合を示す**40%**、 **60%**、または**80%** のいずれかの値を選択する必要があり \) ます。

次に、 \( **1 分**、 **15 分**、 **1 時間**のいずれかの値を選択する必要があります。これは、 \) ピーク時の使用期間が最後に予想される時間の長さを表します。たとえば、15分間にログインするユーザーの総数の値として40% を推定する場合や、ユーザーの60% が1時間以内にログインする場合があります。これらの値を一緒に使用して、サイズ設定の推奨を計算するピーク時の読み込みプロファイルを定義します。

次に、 \- \- ユーザーが次のいずれであるかに基づいて、ターゲットの要求に対応するアプリケーションへのシングルサインオンアクセスを必要とするユーザーの合計数を指定する必要があります。

-   \(Windows 統合認証を通じて企業ネットワークに物理的に接続されているローカルコンピューターから Active Directory にログインする\)

-   \(Windows 統合認証またはユーザー名とパスワードを使用して企業ネットワークに物理的に接続されていないコンピューターからリモートで Active Directory にログインする\)

-   別の組織から、信頼されたパートナーから対象の要求に対応するアプリケーションにアクセスしようとしています \-

-   SAML 2.0 id プロバイダーから、対象の要求に対応するアプリケーションにアクセスしようとしている \-

#### <a name="how-to-use-this-spreadsheet"></a>このスプレッドシートの使用方法
展開を計画しているフェデレーションサーバーファームインスタンスごとに、次の手順を使用して、推奨されるフェデレーションサーバーの数を決定できます。

1.  [Windows server 2012 R2 の AD FS 容量計画のサイジングスプレッドシート](https://adfsdocs.blob.core.windows.net/adfs/ADFSCapacityPlanning.xlsx)をダウンロードして開き、 [Windows server 2016 用の AD FS 容量計画のサイジングスプレッドシート](https://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx)を開きます。

2.  [**システムのピーク中] の使用期間中**にの右側のセルで、この割合のユーザーがセルを認証していることが予想されます。そのセルをクリックし、ドロップダウン矢印を使用し \- て、展開のシステム使用率の推定レベル ( **40%**、 **60%** 、または**80%** ) を選択します。

3.  **次の期間内**のの右側のセルで、セルをクリックし、ドロップダウン矢印を使用して \- **1 分**、 **15 分**、または**1 時間**のいずれかを選択して、ピーク時の負荷の期間を選択します。

4.  [ **SharePoint 2007、2010などの内部アプリケーションの推定数を入力してください] セル \( \( \) または [要求に対応 \) する web アプリケーション**] セルに、組織で使用する内部アプリケーションの数を入力します。

5.  [ ** \( Office 365 Exchange Online、SharePoint Online、Lync online \) などのオンラインアプリケーションの推定数を入力**してください] の右側のセルに、組織で使用するオンラインアプリケーションまたはサービスの数を入力します。

6.  [ **Number Of users**] というタイトルのセルに、ユーザーがシングルサインオンアクセスを必要とするサンプルアプリケーションシナリオに適用される行ごとに数字を入力し \- ます。 この列には、1秒あたりのピークユーザーではなく、定義されたユーザーの数が含まれている必要があります。 アプリケーションへのアクセスの試行を最初に [ホーム領域検出] ページで行う必要がある場合は、「 **Y**」と入力します。この選択がわからない場合は、「 **Y**」と入力します。

7.  次の推奨値を確認してください。

    1.  推奨されるフェデレーションサーバーの合計数については、灰色で強調表示されている右下のセルを参照してください。

    2.  各サンプルアプリケーションシナリオで推奨されるサーバー数については、灰色で強調表示されている行のセルを参照してください。

> [!NOTE]
> スプレッドシートの下部に表示される [**フェデレーションサーバーの合計数 (推奨されるフェデレーションサーバーの総数**)」というセルの右側にあるセルで自動的に計算される値には、その前にある各行のすべての値の合計に20% のバッファーが追加される数式が含まれています。 このバッファーには、ファームの全体的な負荷が飽和状態になることがほとんどないようにするために、このバッファーで推奨されるフェデレーションサーバーの合計数に対して、推奨されるセルの合計**数**に対して、推奨される合計数のセルが追加されます。

## <a name="see-also"></a>参照
[Windows Server 2012 での AD FS 設計ガイド](AD-FS-Design-Guide-in-Windows-Server-2012.md)
