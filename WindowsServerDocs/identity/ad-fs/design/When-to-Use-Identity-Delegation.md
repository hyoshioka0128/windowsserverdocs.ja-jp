---
ms.assetid: 6e711a96-9055-4508-b6d4-318d6aa95fd1
title: ID 委任が必要になるシナリオ
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 0d69c92209a2998cf2c249b865ad8d16424735ca
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/10/2019
ms.locfileid: "70867581"
---
# <a name="when-to-use-identity-delegation"></a>ID 委任が必要になるシナリオ
  
## <a name="what-is-identity-delegation"></a>ID 委任はどのような場合に必要になるか  
Id 委任は、管理者が\(指定\)したアカウント\-でユーザーの権限を借用できるようにする Active Directory フェデレーションサービス (AD FS) AD FS の機能です。 ユーザーの権限を借用するアカウントを、 *代理人と呼びます*。 この委任機能は、元の要求の承認チェーン内にある各アプリケーション、データベース、またはサービスに対して、一連のアクセス制御チェックを順次行う必要がある、多くの分散アプリケーションにおいて非常に重要です。 実際\-のシナリオとして、web アプリケーションの "フロントエンド" が、Microsoft SQL Server データベースに接続されている web サービスなど、より安全な "バックエンド" からデータを取得する必要がある場合があります。  
  
たとえば、既存のパーツ\-の注文 Web サイトをプログラムによって拡張し、パートナー組織が独自の購入履歴やアカウントの状態を表示できるようにすることができます。 セキュリティ上の理由から、パートナーの財務データはすべて、専用の SQL \(\) server 構造化照会言語上のセキュリティで保護されたデータベースに格納されます。 このような状況では、フロント\-エンドアプリケーションのコードは、取引先組織の財務データについて何も認識していません。 そのため、この場合は、そのデータを、このケースで\(ホストされているネットワーク上の他の別のコンピューターから取得する必要があります。この場合\) 、部分データベース\(の Web サービスはバックエンド\)になります。  
  
このデータ\-取得プロセスを成功させるには、次の図\-に示すように、web アプリケーションと parts データベースの web サービスの間で、"手動でのシェイク" が連続して行われる必要があります。  
  
![id 委任](media/adfs2_identitydelegationconcept.gif)  
  
元の要求は Web サーバー自体に対して送られますが、この種の Web サーバーは通常、アクセスしようとしているユーザーの組織とはまったく別の組織に存在するため、要求と共に送信されるセキュリティ トークンでは、Web サーバーの承認条件しか満たすことができず、それ以外のコンピューターにアクセスできません。 そのため、発信元のユーザーの要求に応えるには、リソース パートナー組織に中間フェデレーション サーバーを配置して、適切なアクセス特権を持ったセキュリティ トークンを再発行できるようにする必要があります。  
  
## <a name="how-does-identity-delegation-work"></a>ID 委任のしくみ  
多層アプリケーション アーキテクチャ内の Web アプリケーションは多くの場合、共通のデータや機能にアクセスするために、Web サービスを呼び出します。 ここで重要になるのは、これらの Web サービスが発信元ユーザーの ID を把握できるようにして、承認の判断や監査をそのサービスから行えるようにすることです。 この場合、フロント\-エンド web アプリケーションは、web サービスに対するユーザーをデリゲートとして表します。 AD FS は、Active Directory アカウントが別の証明書利用者に対してユーザーとして機能できるようにすることで、このシナリオを容易にします。 次の図は、ID 委任のシナリオを説明したものです。  
  
![id 委任](media/adfs2_identitydelegationsteps.gif)  
  
1.  Frank は、別の\-組織内の Web アプリケーションから、パーツの注文履歴にアクセスしようとします。 彼のクライアントコンピューターは、フロント\-エンドパート\-の注文 Web アプリケーションの AD FS からトークンを要求し、受信します。  
  
2.  クライアントコンピューターは、手順 1. で取得したトークンを含む Web アプリケーションに要求を送信して、クライアントの id を証明します。  
  
3.  Web アプリケーションは、クライアントのトランザクションを完了するために、Web サービスと通信する必要があります。 Web アプリケーションは AD FS に問い合わせて、Web サービスと対話するための委任トークンを取得します。 委任トークンとは、ユーザーとして動作する代理人に発行されるセキュリティ トークンです。 AD FS は、Web サービスを対象としたクライアントに関する要求と共に委任トークンを返します。  
  
4.  Web アプリケーションは、手順 3. で AD FS から取得したトークンを使用して、クライアントとして機能している Web サービスにアクセスします。 委任トークンを調べることで、Web サービスは Web アプリケーションがクライアントとして動作していることを確認できます。 Web サービスは承認ポリシーを実行し、要求をログに記録して、もともと Frank が要求した部品履歴データを、Web アプリケーション経由で Frank に提供します。  
  
特定のデリゲートの場合、AD FS は、Web アプリケーションが委任トークンを要求できる Web サービスを制限できます。 クライアント コンピューターは、Active Directory アカウントを持っていなくてもこの操作を完了できます。 前述のように、Web サービスはユーザーとして動作している代理人の ID を簡単に確認できます。 そのため Web サービスは、クライアント コンピューターと直接やりとりしているのか、それとも代理人を通じてやりとりしているのかによって、異なる動作を実行することができます。  
  
## <a name="configuring-ad-fs-for-identity-delegation"></a>ID 委任を使用するための AD FS の構成  
データ取得プロセスを容易にする\-必要がある場合は常に、AD FS 管理スナップインを使用して、id 委任の AD FS を構成できます。 構成が完了すると、AD FS は、保護されたデータへのアクセスを提供する\-前に、バックエンドサービスが必要とする可能性のある承認コンテキストを含む新しいセキュリティトークンを生成できます。  
  
AD FS では、権限を借用できるユーザーを制限しません。 Id 委任の AD FS を構成すると、次のことが行われます。  
  
-   ユーザー権限を借用するためのトークンを要求する権限を、どのサーバーに委任できるかを決定する。  
  
-   委任されるクライアント アカウントの ID コンテキストと、代理人として動作するサーバーの両方を確立し、個別に保持する。  
  
Id 委任を構成するには、AD FS 管理スナップイン\-で証明書利用者信頼に委任承認規則を追加します。 これを行う方法の詳細については[、「チェックリスト:証明書利用者信頼](../../ad-fs/deployment/Checklist--Creating-Claim-Rules-for-a-Relying-Party-Trust.md)の要求規則を作成する。  
  
## <a name="configuring-the-front-end-web-application-for-identity-delegation"></a>Id 委任用\-のフロントエンド Web アプリケーションの構成  
開発者は、Web フロント\-エンドアプリケーションまたはサービスを適切にプログラムして、委任要求を AD FS コンピューターにリダイレクトするために使用できるオプションがいくつかあります。 Web アプリケーションをカスタマイズして ID 委任と連携させる方法の詳細については、「 [Windows Identity Foundation SDK](https://go.microsoft.com/fwlink/?LinkId=122266)」を参照してください。  
  
## <a name="see-also"></a>関連項目
[Windows Server 2012 での AD FS 設計ガイド](AD-FS-Design-Guide-in-Windows-Server-2012.md)
