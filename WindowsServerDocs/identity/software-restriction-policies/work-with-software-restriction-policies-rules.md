---
title: ソフトウェアの制限のポリシーの規則の使用
description: Windows Server のセキュリティ
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: security-software-restriction-policies
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 4a8047d5-9bb9-4bed-bc8f-583a237731e2
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: bb5e56fe541a06b1100de2f25fc10f4db46b8d24
ms.sourcegitcommit: 06ae7c34c648538e15c4d9fe330668e7df32fbba
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/05/2020
ms.locfileid: "78371736"
---
# <a name="work-with-software-restriction-policies-rules"></a>ソフトウェアの制限のポリシーの規則の使用

>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このトピックでは、ソフトウェアの制限のポリシーを使用して証明書、パス、インターネットゾーン、およびハッシュの規則を操作する手順について説明します。

## <a name="introduction"></a>はじめに
ソフトウェアの制限のポリシーを使用すると、実行を許可するソフトウェアを特定して指定することで、信頼されていないソフトウェアからコンピューティング環境を保護できます。 グループポリシーオブジェクト (GPO) では、既定のセキュリティレベルを [**制限**しない] または [**許可**しない] のいずれかに定義できます。これにより、既定でソフトウェアの実行が許可されるかどうかが決まります。 特定のソフトウェアに対してソフトウェアの制限のポリシー規則を作成することによって、この既定のセキュリティレベルに対して例外を作成できます。 たとえば、既定のセキュリティ レベルが **[許可しない]** に設定されている場合には、特定のソフトウェアに対して実行を許可する規則を作成できます。 規則の種類は次のとおりです。

-   **証明書の規則**

    手順については、「[証明書の規則の操作](#BKMK_Cert_Rules)」を参照してください。

-   **ハッシュの規則**

    手順については、「[ハッシュの規則の操作](#BKMK_Hash_Rules)」を参照してください。

-   **インターネットゾーンの規則**

    手順については、「[インターネットゾーンルールの使用](#BKMK_Internet_Zone_Rules)」を参照してください。

-   **パスの規則**

    手順については、「[パスの規則の操作](#BKMK_Path_Rules)」を参照してください。

ソフトウェアの制限のポリシーを管理するその他のタスクについては、「[ソフトウェアの制限のポリシーの管理](administer-software-restriction-policies.md)」を参照してください。

## <a name="BKMK_Cert_Rules"></a>証明書の規則の使用
ソフトウェアの制限のポリシーでは、署名証明書によってソフトウェアを識別することもできます。 ソフトウェアを特定する証明書の規則を作成し、セキュリティ レベルに応じてソフトウェアの実行を許可するか、実行を許可しないかを指定できます。 たとえば、証明書の規則を使用すると、ドメイン内にある信頼できる発行元のソフトウェアを、ダイアログを表示することなく自動的に信頼することができます。 証明書の規則を使えばほかにも、オペレーティング システム内の許可されていない領域でファイルを実行できます。 既定では、証明書の規則は有効になっていません。

グループポリシーを使用してドメインの規則を作成する場合は、グループポリシーオブジェクトを作成または変更するためのアクセス許可が必要です。 ローカル コンピューターに規則を作成するときは、そのコンピューターの管理者の資格情報が必要です。

#### <a name="to-create-a-certificate-rule"></a>証明書の規則を作成するには

1.  [ソフトウェアの制限のポリシー] を開きます。

2.  コンソールツリーまたは詳細ペインで、 **[追加の規則]** を右クリックし、 **[新しい証明書の規則]** をクリックします。

3.  **[参照]** をクリックし、証明書または署名されているファイルを選択します。

4.  **[セキュリティレベル]** で、 **[許可]** しない または **[無制限]** をクリックします。

5.  **[説明]** にこの規則の説明を入力し、 **[OK]** をクリックします。

> [!NOTE]
> -   グループ ポリシー オブジェクト (GPO) についてソフトウェアの制限のポリシーの設定を作成していない場合には、この設定の新規作成が必要になることがあります。
> -   既定では、証明書の規則は有効になっていません。
> -   証明書の規則の影響を受けるファイルの種類は、ソフトウェアの制限のポリシーの詳細ウィンドウの **[指定されたファイルの種類]** に列挙されているもののみです。 指定されたファイルの種類の一覧は 1 つであり、それがあらゆる規則の間で共有されます。
> -   ソフトウェアの制限のポリシーを有効にするには、ユーザーがログオフしてコンピューターにログオンすることによって、ポリシー設定を更新する必要があります。
> -   ポリシー設定に複数のソフトウェアの制限のポリシーの規則が適用されている場合は、競合を処理するための規則の優先順位があります。

### <a name="enabling-certificate-rules"></a>証明書の規則の有効化
証明書の規則を有効にする手順は、環境に応じて異なります。

-   [ローカルコンピューターの場合](#BKMK_1)

-   [グループポリシーオブジェクトの場合、ドメインに参加しているサーバー上にある](#BKMK_2)

-   [グループポリシーオブジェクトの場合、リモートサーバー管理ツールがインストールされているドメインコントローラーまたはワークステーション上にある](#BKMK_3)

-   [ドメインコントローラーのみの場合、およびリモートサーバー管理ツールパックがインストールされているドメインコントローラーまたはワークステーションを使用している場合](#BKMK_4)

#### <a name="BKMK_1"></a>ローカルコンピューターの証明書の規則を有効にするには

1.  [ローカル セキュリティ設定] を開きます。

2.  コンソールツリーで、セキュリティ設定、ローカルポリシー の順に選択し、**セキュリティオプション** をクリックします。

3.  詳細ウィンドウで、 **[システム設定: ソフトウェア制限のポリシーのために Windows 実行可能ファイルに対して証明書の規則を使用する]** をダブルクリックします。

4.  次のいずれかの操作を行い、 **[OK]** をクリックします。

    -   証明書の規則を有効にするには、 **[有効]** をクリックします。

    -   証明書の規則を無効にするには、 **[無効]** をクリックします。

#### <a name="BKMK_2"></a>グループポリシーオブジェクトの証明書の規則を有効にし、ドメインに参加しているサーバーを使用するには

1.  Microsoft 管理コンソール (MMC) を開きます。

2.  **[ファイル]** メニューで、 **[スナップインの追加と削除]** をクリックし、 **[追加]** をクリックします。

3.  **[ローカル グループ ポリシー オブジェクト エディター]** をクリックし、 **[追加]** をクリックします。

4.  **[グループ ポリシー オブジェクトの選択]** で、 **[参照]** をクリックします。

5.  **[グループポリシーオブジェクトの参照]** で、適切なドメイン、サイト、または組織単位のグループポリシーオブジェクト (GPO) を選択するか、新しいものを作成して **[完了]** をクリックします。

6.  **[閉じる]** をクリックしてから **[OK]** をクリックします。

7.  コンソールツリーで、 *Grouppolicyobject* [*ComputerName*] ポリシー/コンピューターの構成/Windows の設定/セキュリティの設定/ローカルポリシー/の下にある **[セキュリティオプション]** をクリックします。

8.  詳細ウィンドウで、 **[システム設定: ソフトウェア制限のポリシーのために Windows 実行可能ファイルに対して証明書の規則を使用する]** をダブルクリックします。

9. ポリシー設定をまだ定義していない場合は、 **[これらのポリシーの設定を定義する]** チェック ボックスをオンにします。

10. 次のいずれかの操作を行い、 **[OK]** をクリックします。

    -   証明書の規則を有効にするには、 **[有効]** をクリックします。

    -   証明書の規則を無効にするには、 **[無効]** をクリックします。

#### <a name="BKMK_3"></a>グループポリシーオブジェクトの証明書の規則を有効にし、リモートサーバー管理ツールがインストールされているドメインコントローラーまたはワークステーションを使用する場合

1.  [Active Directory ユーザーとコンピューター] を開きます。

2.  コンソール ツリーで、証明書の規則を有効にするグループ ポリシー オブジェクト (GPO) を右クリックします。

3.  **[プロパティ]** 、 **[グループ ポリシー]** タブの順にクリックします。

4.  **[編集]** をクリックして、編集する GPO を開きます。 このほか、 **[新規作成]** をクリックして新しい GPO を作成し、 **[編集]** をクリックする方法があります。

5.  コンソールツリーで、 *Grouppolicyobject*[*ComputerName*] ポリシー/コンピューターの構成/Windows の設定/セキュリティの設定/ローカルポリシーの下にある **[セキュリティオプション]** をクリックします。

6.  詳細ウィンドウで、 **[システム設定: ソフトウェア制限のポリシーのために Windows 実行可能ファイルに対して証明書の規則を使用する]** をダブルクリックします。

7.  ポリシー設定をまだ定義していない場合は、 **[これらのポリシーの設定を定義する]** チェック ボックスをオンにします。

8.  次のいずれかの操作を行い、 **[OK]** をクリックします。

    -   証明書の規則を有効にするには、 **[有効]** をクリックします。

    -   証明書の規則を無効にするには、 **[無効]** をクリックします。

#### <a name="BKMK_4"></a>ドメインコントローラーに対してのみ証明書の規則を有効にし、リモートサーバー管理ツールがインストールされているドメインコントローラーまたはワークステーションを使用する場合

1.  [ドメイン コントローラー セキュリティの設定] を開きます。

2.  コンソール ツリーで、**GroupPolicyObject** [*ComputerName*] ポリシー/コンピューターの構成/Windows の設定/セキュリティの設定/ローカル ポリシー/ にある *[セキュリティ オプション]* をクリックします。

3.  詳細ウィンドウで、 **[システム設定: ソフトウェア制限のポリシーのために Windows 実行可能ファイルに対して証明書の規則を使用する]** をダブルクリックします。

4.  ポリシー設定をまだ定義していない場合は、 **[これらのポリシーの設定を定義する]** チェック ボックスをオンにします。

5.  次のいずれかの操作を行い、 **[OK]** をクリックします。

    -   証明書の規則を有効にするには、 **[有効]** をクリックします。

    -   証明書の規則を無効にするには、 **[無効]** をクリックします。

> [!NOTE]
> 証明書の規則を有効にするには、この手順を実行する必要があります。

### <a name="set-trusted-publisher-options"></a>信頼された発行元のオプションの設定
ソフトウェアの署名は、増え続けるソフトウェア発行者およびアプリケーション開発者によって、そのアプリケーションの発行元が信頼できることを確認するために使用されています。 しかし、多くのユーザーは、自分がインストールするアプリケーションに関連付けられている署名証明書について理解していないか、ほとんど関心がありません。

管理者は証明書パスの検証ポリシーの **[信頼された発行元]** タブにあるポリシー オプションを使って、信頼できる発行元の証明書として許可する証明書を制御できます。

##### <a name="to-configure-the-trusted-publishers-policy-settings-for-a-local-computer"></a>ローカル コンピューターの信頼された発行元ポリシー設定を構成するには

1.  **スタート**画面で「**gpedit.msc** 」と入力し、enter キーを押します。

2.  コンソール ツリーで、 **[ローカル コンピューター ポリシー\コンピューターの構成\Windows の設定\セキュリティの設定]** の **[公開キーのポリシー]** をクリックします。

3.  **[証明書パス検証の設定]** をダブルクリックし、 **[信頼された発行元]** タブをクリックします。

4.  **[これらのポリシーの設定を定義する]** チェック ボックスをオンにし、適用するポリシー設定を選択します。 **[OK]** をクリックして新しい設定を適用します。

##### <a name="to-configure-the-trusted-publishers-policy-settings-for-a-domain"></a>ドメインの信頼された発行元ポリシー設定を構成するには

1.  **[グループ ポリシー管理]** を開きます。

2.  コンソールツリーで、編集する**既定のドメインポリシー**グループポリシーオブジェクト (GPO) が含まれているフォレストおよびドメイン内の**グループポリシーオブジェクト**をダブルクリックします。

3.  **[既定のドメイン ポリシー]** GPO を右クリックし、 **[編集]** をクリックします。

4.  コンソール ツリーで、 **[コンピューターの構成\Windows の設定\セキュリティの設定]** の **[公開キーのポリシー]** をクリックします。

5.  **[証明書パス検証の設定]** をダブルクリックし、 **[信頼された発行元]** タブをクリックします。

6.  **[これらのポリシーの設定を定義する]** チェック ボックスをオンにし、適用するポリシー設定を選択します。 **[OK]** をクリックして新しい設定を適用します。

##### <a name="to-allow-only-administrators-to-manage-certificates-used-for-code-signing-for-a-local-computer"></a>ローカル コンピューターのコード署名に使用される証明書の管理を管理者のみに許可するには

1.  **スタート**画面で、デスクトップ上の **プログラムとファイルの検索** または Windows 8 に「 **gpedit.msc** 」と入力し、enter キーを押します。

2.  コンソールツリーの **[既定のドメインポリシー]** または **[ローカルコンピューターポリシー]** で、 **[コンピューターの構成]** 、 **[Windows の設定]** 、セキュリティの **[設定]** の順にダブルクリックし、 **[公開キーのポリシー]** をクリックします。

3.  **[証明書パス検証の設定]** をダブルクリックし、 **[信頼された発行元]** タブをクリックします。

4.  **[これらのポリシーの設定を定義する]** チェック ボックスをオンにします。

5.  **[信頼された発行元の管理]** の **[すべての管理者のみに信頼される発行元の管理を許可する]** をクリックし、 **[OK]** をクリックして新しい設定を適用します。

##### <a name="to-allow-only-administrators-to-manage-certificates-used-for-code-signing-for-a-domain"></a>ドメインのコード署名に使用される証明書の管理を管理者のみに許可するには

1.  **[グループ ポリシー管理]** を開きます。

2.  コンソールツリーで、編集する**既定のドメインポリシー** GPO を含むフォレストおよびドメイン内の**グループポリシーオブジェクト**をダブルクリックします。

3.  **[既定のドメイン ポリシー]** GPO を右クリックし、 **[編集]** をクリックします。

4.  コンソール ツリーで、 **[コンピューターの構成\Windows の設定\セキュリティの設定]** の **[公開キーのポリシー]** をクリックします。

5.  **[証明書パス検証の設定]** をダブルクリックし、 **[信頼された発行元]** タブをクリックします。

6.  **[これらのポリシーの設定を定義する]** チェック ボックスをオンにし、必要な変更を行い、 **[OK]** をクリックして新しい設定を適用します。

## <a name="BKMK_Hash_Rules"></a>ハッシュルールの操作
ハッシュとは、ソフトウェア プログラムまたはファイルを一意に特定できる固定長のバイトです。 ハッシュは、ハッシュ アルゴリズムによる計算で導き出されます。 あるソフトウェア プログラムについてハッシュの規則を作成すると、ソフトウェアの制限のポリシーによってプログラムのハッシュが計算されます。 ユーザーがソフトウェア プログラムを開こうとした時点で、プログラムのハッシュがソフトウェアの制限のポリシーの既存のハッシュの規則と比較されます。 ソフトウェア プログラムのハッシュは、そのプログラムがコンピューターのどこに置かれていても、常に同じです。 ただし、ソフトウェア プログラムがなんらかの形で変更されていると、ハッシュも変化します。このため、そのハッシュは、ソフトウェアの制限のポリシーのハッシュの規則によるハッシュと一致しなくなります。

たとえば、ハッシュの規則を作成してセキュリティ レベルを **[許可しない]** に設定すると、ユーザーが特定のファイルを実行できなくすることができます。 ファイルは名前の変更のほか、別のフォルダーに移動した場合でも、同じハッシュとなります。 ただし、ファイルそのものに変更を加えた場合には、ハッシュ値が変化するため、ファイルが制限の対象外になります。

#### <a name="to-create-a-hash-rule"></a>ハッシュの規則を作成するには

1.  [ソフトウェアの制限のポリシー] を開きます。

2.  コンソールツリーまたは詳細ペインで、 **[追加の規則]** を右クリックし、 **[新しいハッシュの規則]** をクリックします。

3.  **[参照]** をクリックしてファイルを検索します。

    > [!NOTE]
    > Windows XP では、事前に計算されたハッシュを**ファイルハッシュ**に貼り付けることができます。 Windows Server 2008 R2、Windows 7 以降のバージョンでは、このオプションは使用できません。

4.  **[セキュリティレベル]** で、 **[許可]** しない または **[無制限]** をクリックします。

5.  **[説明]** にこの規則の説明を入力し、 **[OK]** をクリックします。

> [!NOTE]
> -   グループ ポリシー オブジェクト (GPO) についてソフトウェアの制限のポリシーの設定を作成していない場合には、この設定の新規作成が必要になることがあります。
> -   ウイルスやトロイの木馬の実行を防ぐことを目的としてハッシュの規則を作成することができます。
> -   他のユーザーがハッシュルールを使用してウイルスを実行できないようにするには、ソフトウェアの制限のポリシーを使用してウイルスのハッシュを計算し、そのハッシュ値を他のユーザーに電子メールで送信します。 ウイルス自体を電子メールで送信しないでください。
> -   ウイルスが電子メールで送信されている場合は、電子メールの添付ファイルの実行を防ぐパスの規則を作成することもできます。
> -   ファイルの名前を変更したり、別のフォルダーに移動したりした場合には、ハッシュは変わりません。 ファイル自体を変更すると、別のハッシュが生成されます。
> -   ハッシュの規則の影響を受けるファイルの種類は、ソフトウェアの制限のポリシーの詳細ウィンドウの **[指定されたファイルの種類]** に列挙されているもののみです。 指定されたファイルの種類の一覧は 1 つであり、それがあらゆる規則の間で共有されます。
> -   ソフトウェアの制限のポリシーを有効にするには、ユーザーがログオフしてコンピューターにログオンすることによって、ポリシー設定を更新する必要があります。
> -   ポリシー設定に複数のソフトウェアの制限のポリシーの規則が適用されている場合は、競合を処理するための規則の優先順位があります。

## <a name="BKMK_Internet_Zone_Rules"></a>インターネットゾーンの規則の操作
インターネット ゾーンの規則は、Windows インストーラー パッケージにのみ適用されます。 ゾーンの規則では、Internet Explorer で指定したゾーンから来たソフトウェアを特定できます。 ゾーンには、インターネット、ローカル イントラネット、制限付きサイト、信頼済みサイト、およびマイ コンピューターがあります。 インターネットゾーンの規則は、ユーザーがソフトウェアをダウンロードしてインストールできないように設計されています。

#### <a name="to-create-an-internet-zone-rule"></a>インターネット ゾーンの規則を作成するには

1.  [ソフトウェアの制限のポリシー] を開きます。

2.  コンソールツリーまたは詳細ウィンドウで、 **[追加の規則]** を右クリックし、 **[新しいインターネットゾーンの規則]** をクリックします。

3.  **[インターネット ゾーン]** で、インターネット ゾーンをクリックします。

4.  **[セキュリティレベル]** で、 **[許可]** しない または **[無制限]** をクリックし、 **[OK]** をクリックします。

> [!NOTE]
> -   グループ ポリシー オブジェクト (GPO) についてソフトウェアの制限のポリシーの設定を作成していない場合には、この設定の新規作成が必要になることがあります。
> -   ゾーンの規則は、.msi ファイル (Windows インストーラー パッケージ) にのみ適用されます。
> -   ソフトウェアの制限のポリシーを有効にするには、ユーザーがログオフしてコンピューターにログオンすることによって、ポリシー設定を更新する必要があります。
> -   ポリシー設定に複数のソフトウェアの制限のポリシーの規則が適用されている場合は、競合を処理するための規則の優先順位があります。

## <a name="BKMK_Path_Rules"></a>パスの規則の操作
パスの規則では、ファイル パスによってソフトウェアを特定します。 たとえば、既定のセキュリティ レベルが **[許可しない]** になっているコンピューターでも、各ユーザーに特定のフォルダーに対する無制限のアクセス権を付与することができます。 これには、ファイル パスを使用してパスの規則を作成し、そのセキュリティ レベルを **[制限なし]** に設定します。 この種の規則でよく使用するパスは、%userprofile%、%windir%、%appdata%、%programfiles%、および %temp% です。 このほか、ソフトウェアのレジストリ キーをパスとして使用したレジストリ パスの規則を作成できます。

ここに挙げた規則はパスを使って指定するため、ソフトウェア プログラムを移動すると、パスの規則が適用されなくなります。

#### <a name="to-create-a-path-rule"></a>パスの規則を作成するには

1.  [ソフトウェアの制限のポリシー] を開きます。

2.  コンソールツリーまたは詳細ペインで、 **[追加の規則]** を右クリックし、 **[新しいパスの規則]** をクリックします。

3.  **[パス]** で、パスを入力するか、 **[参照]** をクリックしてファイルまたはフォルダーを指定します。

4.  **[セキュリティレベル]** で、 **[許可]** しない または **[無制限]** をクリックします。

5.  **[説明]** にこの規則の説明を入力し、 **[OK]** をクリックします。

> [!CAUTION]
> -   Windows フォルダーなどの特定のフォルダーでは、セキュリティレベルを [**許可**しない] に設定すると、オペレーティングシステムの動作に悪影響を及ぼす可能性があります。 オペレーティング システムまたはそれに依存するプログラムに不可欠な要素を許可しない設定にしないようにしてください。

> [!NOTE]
> -   グループ ポリシー オブジェクト (GPO) についてソフトウェアの制限のポリシーを作成していない場合には、このポリシーの新規作成が必要になることがあります。
> -   ソフトウェアにパスの規則を作成し、セキュリティ レベルを **[許可しない]** に設定している場合には、そのソフトウェアを別の場所にコピーすると、そのソフトウェアを依然として実行できます。
> -   パスの規則でサポートされているワイルドカード文字は、* と ? です。
> -   パスの規則には、環境変数 (%programfiles%、%systemroot% など) を使用できます。
> -   コンピューターのどこに保存されているかはわからないものの、レジストリ キーはわかっているソフトウェアについて、パスの規則を作成するときには、レジストリ パスの規則を作成します。
> -   ユーザーが電子メールの添付ファイルを実行できないようにするには、電子メールプログラムの添付ファイルディレクトリのパスの規則を作成して、ユーザーが電子メールの添付ファイルを実行できないようにします。
> -   パスの規則の影響を受けるファイルの種類は、ソフトウェアの制限のポリシーの詳細ウィンドウの **[指定されたファイルの種類]** に列挙されているもののみです。 指定されたファイルの種類の一覧は 1 つであり、それがあらゆる規則の間で共有されます。
> -   ソフトウェアの制限のポリシーを有効にするには、ユーザーがログオフしてコンピューターにログオンすることによって、ポリシー設定を更新する必要があります。
> -   ポリシー設定に複数のソフトウェアの制限のポリシーの規則が適用されている場合は、競合を処理するための規則の優先順位があります。

#### <a name="to-create-a-registry-path-rule"></a>レジストリ パスの規則を作成するには

1.  **スタート**画面で、「regedit」と入力します。

2.  コンソール ツリーで、規則を作成するレジストリ キーを右クリックし、 **[キー名のコピー]** をクリックします。 詳細ウィンドウに表示されている値の名前を確認してください。

3.  [ソフトウェアの制限のポリシー] を開きます。

4.  コンソールツリーまたは詳細ペインで、 **[追加の規則]** を右クリックし、 **[新しいパスの規則]** をクリックします。

5.  **[パス]** に、レジストリキー名の後に値の名前を貼り付けます。

6.  レジストリパスをパーセント記号 (%) (% HKEY_LOCAL_MACHINE \SOFTWARE\Microsoft\PlatformSDK\Directories\InstallDir%. など) で囲みます。

7.  **[セキュリティレベル]** で、 **[許可]** しない または **[無制限]** をクリックします。

8.  **[説明]** にこの規則の説明を入力し、 **[OK]** をクリックします。


