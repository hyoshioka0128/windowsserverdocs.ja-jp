---
ms.assetid: 709353b0-b913-4367-8580-44745183e2bc
title: ディレクトリ レプリケーションをサポートする DNS 機能を確認する
ms.author: joflore
ms.date: 05/31/2017
author: Femila
ms.openlocfilehash: 90950ea59dc831f294f6ca96125ec4c9abe68bf9
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2020
ms.locfileid: "87941576"
---
# <a name="verify-dns-functionality-to-support-directory-replication"></a>ディレクトリ レプリケーションをサポートする DNS 機能を確認する

>適用先:Windows Server 2016 では、Windows Server 2012 R2、Windows Server 2012

 Active Directory レプリケーションに干渉する可能性のあるドメインネームシステム (DNS) の設定を確認するには、まず、DNS がドメインに対して正しく動作することを確認する基本的なテストを実行します。 基本テストを実行した後、リソースレコードの登録や動的更新など、DNS 機能の他の側面をテストできます。

この基本的な DNS 機能のテストはどのドメインコントローラーでも実行できますが、通常は、レプリケーションの問題が発生している可能性があるドメインコントローラーでこのテストを実行します。たとえば、イベント Id 1844、1925、2087、2088をイベントビューアー Directory サービスの DNS ログに報告するドメインコントローラーなどです。



## <a name="running-the-domain-controller-basic-dns-testtitle"></a>ドメインコントローラーの基本的な DNS テストの実行</title>

基本的な DNS テストでは、DNS 機能の次の点を確認します。


- **接続:** このテストでは、ドメインコントローラーが DNS に登録されているかどうか、 <system>ping</system>コマンドによってアクセスできるかどうか、ライトウェイトディレクトリアクセスプロトコル/リモートプロシージャコール (LDAP/RPC) 接続があるかどうかが判断されます。 ドメインコントローラーで接続テストが失敗した場合、そのドメインコントローラーに対して他のテストは実行されません。 接続テストは、他の DNS テストが実行される前に自動的に実行されます。
- **重要なサービス:** テストでは、次のサービスが実行されていて、テスト対象のドメインコントローラーで使用可能であることを確認します。 DNS クライアントサービス、Net Logon サービス、キー配布センター (KDC) サービス、および DNS サーバーサービス (DNS がドメインコントローラーにインストールされている場合)。
- **DNS クライアントの構成:** テストでは、DNS クライアントコンピューターのすべてのネットワークアダプター上の DNS サーバーに到達できることを確認します。
- **リソースレコードの登録:** テストでは、各ドメインコントローラーのホスト (A) リソースレコードが、クライアントコンピューターに構成されている1つ以上の DNS サーバーに登録されていることを確認します。
- **ゾーンと SOA (start of authority):** ドメインコントローラーが DNS サーバーサービスを実行している場合、テストでは、Active Directory ドメインゾーンの Active Directory ドメインゾーンと SOA (start of authority) リソースレコードが存在することを確認します。
- **ルートゾーン:** ルート (.) ゾーンが存在するかどうかを確認します。

これらの手順を完了するには、Enterprise Admins のメンバーシップ、またはそれと同等のメンバーシップが最低限必要です。

基本的な DNS 機能を確認するには、次の手順に従います。

### <a name="to-verify-basic-dns-functionality"></a>基本的な DNS 機能を確認するには:


1. テストするドメインコントローラー、または Active Directory Domain Services (AD DS) ツールがインストールされているドメインメンバーコンピューターで、管理者としてコマンドプロンプトを開きます。 管理者としてコマンド プロンプトを開くには、[**スタート**] ボタンをクリックします。
2. [検索開始] で、「コマンド プロンプト」と入力します。
3. [スタート] メニューの上部で [コマンド プロンプト] を右クリックしてから [管理者として実行] をクリックします。 [ユーザー アカウント制御] ダイアログ ボックスが表示されたら、表示された操作が正しいことを確認し、[続行] をクリックします。
4. コマンドプロンプトで、次のコマンドを入力し、enter キーを押します。`dcdiag /test:dns /v /s:<DCName> /DnsBasic /f:dcdiagreport.txt`
</br></br>DCName のドメインコントローラーの実際の識別名、NetBIOS 名、または DNS 名に置き換え &lt; &gt; ます。 代わりに、/s: の代わりに「/e:」と入力して、フォレスト内のすべてのドメインコントローラーをテストすることもできます。
/F スイッチはファイル名を指定します。これは、前のコマンドで dcdiagreport.txt します。 現在の作業ディレクトリ以外の場所にファイルを配置する場合は、/f:c:reportsdcdiagreport.txt のようなファイルパスを指定します。

5. メモ帳または同様のテキストエディターで dcdiagreport.txt ファイルを開きます。 メモ帳でファイルを開くには、コマンドプロンプトで「notepad dcdiagreport.txt」と入力し、enter キーを押します。 別の作業ディレクトリにファイルを配置した場合は、ファイルへのパスを含めます。 たとえば、c:reports にファイルを配置した場合は、メモ帳 c:reportsdcdiagreport.txt を入力し、enter キーを押します。
6. ファイルの下部近くにある概要テーブルまでスクロールします。
</br></br>概要テーブルで "警告" または "失敗" の状態を報告するすべてのドメインコントローラーの名前を確認します。  "DC: DCName" という文字列を検索して詳細なブレイクアウトセクションを検索し、問題のあるドメインコントローラーがあるかどうかを確認します。ここで、DCName はドメインコントローラーの実際の名前です。

明確な構成の変更が必要な場合は、必要に応じて変更してください。 たとえば、ドメインコントローラーの1つに誤った IP アドレスがあることがわかった場合は、修正できます。 次に、テストを再実行します。

構成の変更を検証するには、必要に応じて、/e: または/s: スイッチを使用して、Dcdiag/test: DNS/v コマンドを再実行します。 ドメインコントローラーで IP version 6 (IPv6) が有効になっていない場合は、テストのホスト (AAAA) 検証部分が失敗することが予想されますが、ネットワークで IPv6 を使用していない場合は、これらのレコードは必要ありません。

## <a name="verifying-resource-record-registration"></a>リソースレコードの登録を確認しています

宛先ドメインコントローラは、DNS エイリアス (CNAME) リソースレコードを使用して、ソースドメインコントローラレプリケーションパートナーを検索します。 Windows Server を実行しているドメインコントローラー (Windows Server 2003 Service Pack 1 (SP1) 以降) では、完全修飾ドメイン名 (Fqdn) を使用してソースレプリケーションパートナーを見つけることができますが、失敗した場合は、エイリアス (CNAME) リソースレコードが存在することを確認し、適切な DNS 機能を確認する必要があります。

エイリアス (CNAME) リソースレコードの登録など、リソースレコードの登録を確認するには、次の手順に従います。

### <a name="to-verify-resource-record-registrationtitle"></a>リソースレコードの登録を確認するには</title>


1. 管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、[スタート] ボタンをクリックします。 [検索開始] で、「コマンド プロンプト」と入力します。
2. [スタート] メニューの上部で [コマンド プロンプト] を右クリックしてから [管理者として実行] をクリックします。 [ユーザー アカウント制御] ダイアログ ボックスが表示されたら、表示された操作が正しいことを確認し、[続行] をクリックします。  </br></br>Dcdiag ツールを使用すると、コマンドを実行して、ドメインコントローラーの場所に必要なすべてのリソースレコードの登録を確認でき `dcdiag /test:dns /DnsRecordRegistration` ます。

このコマンドは、次のリソースレコードが DNS に登録されているかどうかを確認します。


- **エイリアス (CNAME):** レプリケーションパートナーを検索するグローバル一意識別子 (GUID) ベースのリソースレコード
- **ホスト (A):** ドメインコントローラーの IP アドレスを含むホストリソースレコード
- **LDAP SRV:** ldap サーバーを検索するサービス (SRV) リソースレコード
- **GC SRV**: グローバルカタログサーバーを検索するサービス (SRV) リソースレコード
- **PDC SRV**: プライマリドメインコントローラー (pdc) エミュレーターの操作マスターを検索するサービス (srv) リソースレコード

エイリアス (CNAME) リソースレコードの登録だけを確認するには、次の手順に従います。

### <a name="to-verify-alias-cname-resource-record-registration"></a>エイリアス (CNAME) リソースレコードの登録を確認するには

1. DNS スナップインを開きます。 DNS を開くには、[開始] をクリックします。 [検索の開始] に「dnsmgmt.msc」と入力し、enter キーを押します。 [ユーザーアカウント制御] ダイアログボックスが表示されたら、目的の操作が表示されていることを確認し、[続行] をクリックします。
2. Dns スナップインを使用して、dns サーバーサービスを実行しているドメインコントローラーを検索します。このサーバーは、ドメインコントローラーの Active Directory ドメインと同じ名前の DNS ゾーンをホストします。
3. コンソールツリーで、_msdcs という名前のゾーンをクリックします。Dns_Domain_Name。
4. 詳細ウィンドウで、次のリソースレコードが存在することを確認します。 Dsa_Guid という名前のエイリアス (CNAME) リソースレコードが _msdcs です。<placeholder>Dns_Domain_Name</placeholder>と、Dns サーバーの名前に対応するホスト (a) リソースレコードです。

エイリアス (CNAME) リソースレコードが登録されていない場合は、動的更新が正常に機能していることを確認します。 動的更新を確認するには、次のセクションのテストを使用します。

## <a name="verifying-dynamic-update"></a>動的更新を検証しています

基本的な DNS テストで、リソースレコードが DNS に存在しないことが示されている場合は、動的更新テストを使用して、Net Logon サービスがリソースレコードを自動的に登録しなかった理由を特定します。 セキュリティで保護された動的更新を受け入れるように Active Directory ドメインゾーンが構成されていることを確認し、テストレコード (_dcdiag_test_record) の登録を実行するには、次の手順に従います。 テストレコードは、テストの後に自動的に削除されます。

### <a name="to-verify-dynamic-updatetitle"></a>動的更新を確認するには</title>


1. 管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、[スタート] ボタンをクリックします。 [検索開始] で、「コマンド プロンプト」と入力します。 [スタート] メニューの上部で [コマンド プロンプト] を右クリックしてから [管理者として実行] をクリックします。 [ユーザー アカウント制御] ダイアログ ボックスが表示されたら、表示された操作が正しいことを確認し、[続行] をクリックします。
2. コマンドプロンプトで、次のコマンドを入力し、enter キーを押します。`dcdiag /test:dns /v /s:<DCName> /DnsDynamicUpdate`
   </br></br>DCName のドメインコントローラーの識別名、NetBIOS 名、または DNS 名に &lt; 置き換え &gt; ます。 代わりに、/s: の代わりに「/e:」と入力して、フォレスト内のすべてのドメインコントローラーをテストすることもできます。 ドメインコントローラーで IPv6 が有効になっていない場合は、テストのホスト (AAAA) リソースレコード部分が失敗することを期待する必要があります。これは、IPv6 が有効になっていない場合の通常の状態です。

セキュリティで保護された動的更新が構成されていない場合は、次の手順を使用して構成できます。

### <a name="to-enable-secure-dynamic-updates"></a>セキュリティで保護された動的更新を有効にするには


1. DNS スナップインを開きます。 DNS を開くには、[開始] をクリックします。
2. [検索の開始] に「dnsmgmt.msc」と入力し、enter キーを押します。 [ユーザーアカウント制御] ダイアログボックスが表示されたら、必要な操作が表示されていることを確認し、[続行] をクリックします。
3. コンソールツリーで、該当するゾーンを右クリックし、[プロパティ] をクリックします。
4. [全般] タブで、ゾーンの種類が Active Directory 統合されていることを確認します。
5. [動的更新] で、[セキュリティのみ] をクリックします。

## <a name="registering-dns-resource-records"></a>DNS リソースレコードを登録しています

Dns リソースレコードがソースドメインコントローラーの DNS に表示されず、動的更新を確認し、DNS リソースレコードを直ちに登録する場合は、次の手順を使用して手動で登録することができます。 ドメインコントローラー上の Net Logon サービスは、ドメインコントローラーをネットワーク上に配置するために必要な DNS リソースレコードを登録します。 DNS クライアントサービスは、エイリアス (CNAME) レコードが指すホスト (A) リソースレコードを登録します。

### <a name="to-register-dns-resource-records-manuallytitle"></a>DNS リソースレコードを手動で登録するには</title>


1. 管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、[スタート] ボタンをクリックします。
2. [検索開始] で、「コマンド プロンプト」と入力します。
3. スタート画面の上部にある [コマンドプロンプト] を右クリックし、[管理者として実行] をクリックします。 [ユーザー アカウント制御] ダイアログ ボックスが表示されたら、表示された操作が正しいことを確認し、[続行] をクリックします。
4. ソースドメインコントローラーでドメインコントローラーロケーターリソースレコードの登録を手動で開始するには、コマンドプロンプトで次のコマンドを入力し、enter キーを押します。`net stop netlogon && net start netlogon`
5. ホスト (A) リソースレコードの登録を手動で開始するには、コマンドプロンプトで次のコマンドを入力し、enter キーを押します。`ipconfig /flushdns && ipconfig /registerdns`
6. コマンドプロンプトで、次のコマンドを入力し、enter キーを押します。`dcdiag /test:dns /v /s:<DCName>` </br></br>DCName のドメインコントローラーの識別名、NetBIOS 名、または DNS 名に &lt; 置き換え &gt; ます。 テストの出力を確認して、DNS テストが成功したことを確認します。 ドメインコントローラーで IPv6 が有効になっていない場合は、テストのホスト (AAAA) リソースレコード部分が失敗することを期待する必要があります。これは、IPv6 が有効になっていない場合の通常の状態です。
