---
ms.assetid: 5ab76733-804d-4f30-bee6-cb672ad5075a
title: ドメイン コントローラーの展開のトラブルシューティング
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 03/20/2019
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: e3f215abaccbd1f95ee46eca93a573aa1db9e065
ms.sourcegitcommit: 3632b72f63fe4e70eea6c2e97f17d54cb49566fd
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/03/2020
ms.locfileid: "87519410"
---
# <a name="troubleshooting-domain-controller-deployment"></a>ドメイン コントローラーの展開のトラブルシューティング

>適用先:Windows Server 2016

このトピックでは、ドメイン コントローラーの構成と展開に関するトラブルシューティングの詳しい方法について説明します。

## <a name="introduction-to-troubleshooting"></a>トラブルシューティングの概要

![トラブルシューティング](media/Troubleshooting-Domain-Controller-Deployment/adds_deploy_troubleshooting.png)

## <a name="built-in-logs-for-troubleshooting"></a>トラブルシューティング用の組み込みログ

ドメイン コントローラーの昇格と降格に関する問題のトラブルシューティングでは、組み込みのログが最も重要な情報源となります。 できるだけ詳しい情報を得るため、すべての組み込みのログが既定で有効化され構成されています。

| 段階 | ログ |
|--|--|
| サーバー マネージャーまたは ADDSDeployment Windows PowerShell の操作 | - %systemroot%\debug\dcpromoui.log<p>-%systemroot%\debug\dcpromoui * .log |
| ドメイン コントローラーのインストールと昇格 | -%systemroot%\debug\dcpromo.log<p>-%systemroot%\debug\dcpromo * .log<p>イベント ビューアー \windows ログ \ システム<p>イベント ビューアー \windows ログ \ アプリケーション<p>イベント ビューアー \ アプリケーションとサービス ログ \ ディレクトリ サービス<p>イベント ビューアー \ アプリケーションとサービス ログ \ ファイル レプリケーション サービス<p>イベント ビューアー \ アプリケーションとサービス ログ \dfs レプリケーション |
| フォレストまたはドメインのアップグレード | -%systemroot%\debug\adprep \\ <datetime> \adprep.log<p>-%systemroot%\debug\adprep \\ <datetime> \csv.log<p>-%systemroot%\debug\adprep \\ <datetime> \dspecup.log<p>-%systemroot%\debug\adprep \\ <datetime> \ldif.log * |
| サーバー マネージャー ADDSDeployment Windows PowerShell 展開エンジン | -Event ビューアー \ アプリケーションと services logs\Microsoft\Windows\DirectoryServices-Deployment\Operational |
| Windows サービシング | - %systemroot%\Logs\CBS\\*<p>-% systemroot% \servicing\sessions\sessions.xml<p>- %systemroot%\winsxs\poqexec.log<p>-% systemroot% \winsxs\pending.xml |

### <a name="tools-and-commands-for-troubleshooting-domain-controller-configuration"></a>ドメイン コントローラー構成のトラブルシューティングを行うためのツールとコマンド

ログで説明されていない問題を解決する際は、まず以下のツールを使ってみてください。

-   Dcdiag.exe

-   Repadmin.exe

-   [AutoRuns.exe](/sysinternals/downloads/autoruns)、タスク マネージャー、および MSInfo32.exe

-   [Network Monitor 3.4](https://www.microsoft.com/download/en/details.aspx?displaylang=en&id=4865) (またはサード パーティのネットワーク キャプチャおよび分析ツール)

### <a name="general-methodology-for-troubleshooting-domain-controller-configuration"></a>ドメイン コントローラー構成のトラブルシューティングのための一般的な手法

1.  単純な構文の問題によるエラーの場合

    1.  ADDSDeployment Windows PowerShell に指定した引数にタイプミスはありませんか、また引数を指定し忘れていませんか。 たとえば ADDSDeployment Windows PowerShell を使用している場合、必須引数である **-domainname** を入力して有効な名前を指定しましたか。

    2.  Windows PowerShell コンソールの出力を確認して、指定したコマンドラインの解析に失敗した理由を調べてください。

2.  前提条件が満たされていないことによるエラーの場合

    1.  以前は致命的な昇格の結果となっていたエラーの多くは、前提条件チェッカーによって予防できるようになりました。

    2.  前提条件エラーのテキストをご確認ください。これらは管理されたシナリオであり、ほとんどの問題の解決に必要なガイダンスが示されています。

3.  昇格のエラーであり、そのために致命的なエラーである場合

    1.  結果をご確認ください。エラーの多くは、パスワードの誤り、ネットワーク名の解決、重要なドメイン コントローラーがオフラインといった単純な理由によるものです。

    2.  出力に表示されたエラーについて Dcpromoui.log と dcpromo.log を確認し、そこからさかのぼってエラー発生の理由を探してみてください。

        1.  動作が確認されているサンプル ログと比較してみてください。

        2.  スキーマの拡張やフォレストまたはドメインの準備の問題が結果に示されている場合のみ、ADPrep ログを調べてください。

        3.  Dcpromoui.log に詳細が表示されていない場合や、構成プロセスで、処理されない例外によってこのログが予期せず終了した場合のみ、DirectoryServices-Deployment イベント ログを調べてください。

    3.  構成の問題に関するその他の情報については、ディレクトリ サービス、システム、アプリケーション イベント ログなどを調べてください。 他のネットワークの構成ミスで分散システム全体に影響が及んだ結果として、ドメイン コントローラーの昇格の問題が生ずることがよくあります。

    4.  .dcdiag.exe と repadmin.exe を使用して、さらにドメイン コントローラーの昇格を妨げるような、フォレストの全体的な正常性と構成ミスについてご確認ください。

    5.  AutoRuns.exe、タスク マネージャー、MSinfo32.exe などを使用してコンピューターを調べ、サード パーティのソフトウェアが干渉していないかどうかご確認ください。

        1.  サード パーティのソフトウェアを削除してみてください (無効化してもドライバーは読み込まれるため、削除する必要があります)。

    6.  昇格できないコンピューターとレプリケーション パートナーのドメイン コントローラーに NetMon 3.4 をインストールし、両面からネットワーク キャプチャを行い昇格プロセスを分析してください。

        1.  これを、動作確認済みのラボ環境と比較して、正常な昇格の状態とエラーの発生場所をご確認ください。

        2.  この時点で考えられるのは、フォレスト オブジェクト、既定でないセキュリティ設定変更、またはネットワークにエラーがあり、DNS の構成ミス、ファイアウォール、ホスト侵入保護ソフトウェア、その他の外部要因がこの新しいドメイン コントローラーに影響を与えているということです。

## <a name="troubleshooting-events-and-error-messages"></a>イベントとエラーメッセージのトラブルシューティング

ドメイン コントローラーの昇格と降格の終了時にはコードが返されますが、通常のプログラムと違って成功の場合に返されるのはゼロではありません。 ドメイン コントローラー構成の終了時のコードを見る方法は複数あります。

1. サーバー マネージャーを使用している場合は、自動再起動の 10 秒前に昇格の結果を確認します。

2. ADDSDeployment Windows PowerShell を使用している場合は、自動再起動の 10 秒前に昇格の結果を確認します。 または、完了時に自動再起動しないように設定します。 **Format-List** パイプラインを追加すると、出力が読みやすくなります。 次に例を示します。

   ```
   Install-addsdomaincontroller <options> -norebootoncompletion:$true | format-list
   ```

   前提条件の確認および検証中にエラーが発生すると再起動は行われませんので、どのような場合でもエラーが表示されます。 次に例を示します。

   ![トラブルシューティング](media/Troubleshooting-Domain-Controller-Deployment/ADDS_PSPrereqError.png)

3. どのようなシナリオでも、dcpromo.log と dcpromoui.log をご確認ください。

   > [!NOTE]
   > 以下にリストするエラーの中には、オペレーティング システムの違いや、新しいオペレーティング システムでのドメイン コントローラーの構成の変更により、発生しなくなったものもあります。 また、新しい ADDSDeployment Windows PowerShell コードによって防止されるエラーもあります。しかし dcpromo.exe /unattend ではこれらのエラーは防止されません。このため、お使いのすべてのオートメーションを、非推奨の DCPromo から ADDSDeployment Windows PowerShell に切り替えることをお勧めします。

### <a name="promotion-and-demotion-success-codes"></a>昇格と降格の成功コード

| エラー コード | 説明 | Note |
|--|--|--|
| 1 | 終了、成功 | 自動再起動フラグが削除されたことを示しているだけですので、再起動を実行する必要があります |
| 2 | 終了、成功、再起動が必要 |  |
| 3 | 終了、成功、重大でないエラーあり | 通常は DNS 委任の警告が返されるときのコードです。 DNS 委任を設定しない場合は以下を使用してください。<p>-creatednsdelegation:$false |
| 4 | 終了、成功、重大でないエラーあり、再起動が必要 | 通常は DNS 委任の警告が返されるときのコードです。 DNS 委任を設定しない場合は以下を使用してください。<p>-creatednsdelegation:$false |

### <a name="promotion-and-demotion-failure-codes"></a>プロモーションと降格のエラーコード

昇格と降格では、以下のエラー メッセージ コードが返されます。 多くの場合はエラーの詳しい情報が表示されます。番号の部分だけでなくエラー全体をお読みください。

| エラー コード | 説明 | 推奨される解決策 |
|--|--|--|
| 11 | ドメイン コントローラーの昇格が既に実行中です | 1 つのターゲット コンピューターに対して、一度に複数インスタンスのドメイン コントローラーの昇格を実行しないでください |
| 12 | ユーザーは管理者でなければなりません | 組み込みの Administrators グループのメンバーとしてログインし、UAC で昇格してください |
| 13 | 認証機関がインストールされています | このドメイン コントローラーは証明機関でもあるため、降格できません。 CA を削除する前にその使用状況を詳しくご確認ください。証明書を発行している場合、役割を削除すると機能が停止します。 ドメイン コントローラー上で CA を実行することはお勧めしません |
| 14 | セーフブート モードで実行中です | サーバーを通常モードで起動してください |
| 15 | 役割の変更が進行中か、または起動が必要です | 昇格の前にサーバーを再起動する必要があります (構成変更を行ったため) |
| 16 | 正しくないプラットフォームで実行しています | *このエラーは通常は発生しません* |
| 17 | NTFS 5 ドライブが存在しません | Windows Server 2012 では少なくとも %systemdrive% が NTFS でフォーマットされている必要があるため、このエラーは発生しません |
| 18 | windir に十分な空き容量がありません | cleanmgr.exe を使用して、%systemdrive% ボリューム上にスペースを確保してください |
| 19 | 名前の変更が保留中です。再起動が必要です | サーバーを再起動してください |
| 20 | コンピューター名の構文が無効です | コンピューター名を有効な名前に変更してください |
| 21 | このドメイン コントローラーは、FSMO 役割を持っているか、GC であるか、または DNS サーバーです。またはこれらすべてが当てはまります | - **Forceremoval**を使用する場合は **、-demoteoperationmasterrole**を追加します。 |
| 22 | TCP/IP がインストールされていないか、または機能していません | コンピューターで TCP/IP が構成され、バインドされ、正常に動作していることをご確認ください |
| 23 | まず DNS クライアントを構成する必要があります | ドメインに新しいドメイン コントローラーを追加する前に、プライマリ DNS サーバーを設定してください |
| 24 | 指定された資格情報が有効でないか、または必須の要素がありません | ユーザー名とパスワードが正しいことをご確認ください |
| 25 | 特定のドメインのドメイン コントローラーが見つかりません | DNS クライアント設定とファイアウォール規則をご確認ください |
| 26 | フォレストからドメインのリストを読み込むことができません | DNS クライアント設定、LDAP 機能、ファイアウォール規則をご確認ください |
| 27 | ドメイン名がありません | 昇格または降格の際にはドメイン名を指定してください |
| 28 | ドメイン名が正しくありません | 昇格の際には、別の有効な DNS ドメイン名を選択してください |
| 29 | 親ドメインが存在しません | 新しい子ドメインまたはツリードメインを作成する際は、指定した親ドメインを検証してください |
| 30 | ドメインがフォレストにありません | 指定したドメイン名を検証してください |
| 31 | 子ドメインが既に存在します | 別のドメイン名を指定してください |
| 32 | NetBIOS ドメイン名が正しくありません | 有効な NetBIOS ドメイン名を指定してください |
| 33 | IFM ファイルへのパスが無効です | メディアからのインストール (IFM) のフォルダーへのパスをご確認ください |
| 34 | IFM データベースが正しくありません | このオペレーティング システムと役割に適した IFM (メディアからのインストール) を使用してください (同じバージョンのオペレーティング システム、同じタイプのドメイン コントローラー、RODC 対 RWDC) |
| 35 | SYSKEY がありません | IFM (メディアからのインストール) が暗号化されているため、使用するには有効な SYSKEY を指定する必要があります |
| 37 | NTDS データベースまたはそのログへのパスが無効です | データベースおよびログへのパスを、マップされたドライブや UNC パスでなく、固定 NTFS ボリュームに変更してください |
| 38 | ボリュームに、NTDS データベースまたはログのための十分な空き容量がありません | cleanmgr.exe を使用して空き容量を確保するか、ディスク容量を追加するか、不要なデータを他の場所に移動してください |
| 39 | SYSVOL へのパスが無効です | SYSVOL フォルダーへのパスを、マップされたドライブや UNC パスでなく、固定 NTFS ボリュームに変更してください |
| 40 | サイト名が無効です | 存在するサイト名を指定してください |
| 41 | セーフモードのパスワードを指定する必要があります | DSRM アカウントのパスワードを指定してください。パスワード ポリシーの設定にかかわらず、パスワードは指定する必要があります |
| 42 | セーフモードのパスワードが基準を満たしていません (昇格のみ) | DSRM アカウント用の、パスワード ポリシー設定の規則に沿ったパスワードを指定してください |
| 43 | 管理者のパスワードが基準を満たしていません (降格のみ) | ローカル管理者アカウント用の、パスワード ポリシー設定の規則に沿ったパスワードを指定してください |
| 44 | フォレストに指定した名前が無効です | 有効なフォレスト ルート DNS ドメイン名を指定してください |
| 45 | 指定した名前のフォレストが既に存在します | 別のフォレスト ルート DNS ドメイン名を選択してください |
| 46 | ツリーに指定した名前が無効です | 有効なツリー DNS ドメイン名を指定してください |
| 47 | 指定した名前のツリーが既に存在します | 別のツリー DNS ドメイン名を選択してください |
| 48 | ツリー名が、フォレストの構造に適合しません | 別のツリー DNS ドメイン名を選択してください |
| 49 | 指定されたドメインが存在しません | 入力したドメイン名をご確認ください |
| 50 | 降格中に最後のドメイン コントローラーが検出されましたが、最後のドメイン コントローラーではありません。または最後のドメイン コントローラーが指定されましたが、最後のドメイン コントローラーではありません | [**ドメイン内の最後のドメイン コントローラー**] (**-lastdomaincontrollerindomain**) には、正しいものだけを指定してください。 このが本当に最後のドメインコントローラーであり、ファントムドメインコントローラーメタデータがある場合は **、-ignorelastdcindomainmismatch**を使用してオーバーライドします。 |
| 51 | このドメイン コントローラーにアプリ パーティションが存在します | **[アプリケーション パーティションの削除**] (**-removeapplicationpartitions**) に指定してください |
| 52 | 必須のコマンドライン引数がありません (コマンドラインで応答ファイルを指定する必要があります) | *非推奨とされた dcpromo/unattend でのみ表示されます。以前のドキュメントを見る* |
| 53 | 昇格または降格に失敗しました。クリーンアップのためにコンピューターを再起動する必要があります | エラーの詳細とログをご確認ください |
| 54 | 昇格または降格に失敗しました | エラーの詳細とログをご確認ください |
| 55 | 昇格または降格がユーザーによってキャンセルされました | エラーの詳細とログをご確認ください |
| 56 | 昇格または降格がユーザーによってキャンセルされました。クリーンアップのためにコンピューターを再起動する必要があります | エラーの詳細とログをご確認ください |
| 58 | RODC 昇格中にサイト名を指定する必要があります | RODC ではサイトを指定する必要があります。RWDC と異なり、自動的には検出されません |
| 59 | 降格中、このドメイン コントローラーがゾーンのいずれかで最後の DNS サーバーです | これが**ドメイン内の最後の DNS サーバー**であることを指定するか、または **-ignorelastdnsserverfordomain** を使用してください |
| 60 | RODC を昇格するには、Windows Server 2008 以降を実行するドメイン コントローラーがドメイン内に存在する必要があります | Windows Server 2008 以降のモデルの書き込み可能なドメイン コントローラーを少なくとも 1 つ昇格してください |
| 61 | DNS を現在ホストしていない既存のドメイン内に、DNS を使用した Active Directory Domain Services をインストールすることはできません | *このエラーは発生しないはずです* |
| 62 | 応答ファイルに [DCInstall] セクションがありません | *非推奨とされた dcpromo/unattend でのみ表示されます。以前のドキュメントを参照してください。* |
| 63 | フォレストの機能レベルが Windows Server 2003 以下です | フォレストの機能レベルを少なくとも Windows Server 2003 ネイティブと同じレベルにしてください。 Windows 2000 と Windows NT 4.0 のサポートは終了しました |
| 64 | コンポーネントのバイナリの検出に失敗したため、昇格に失敗しました | AD DS 役割をインストールしてください |
| 65 | コンポーネントのバイナリのインストールに失敗したため、昇格に失敗しました | AD DS 役割をインストールしてください |
| 66 | オペレーティング システムの検出に失敗したため、昇格に失敗しました | エラーの詳細とログをご確認ください。サーバーが、自身のオペレーティング システムのバージョンを返すことができません。 コンピューターの全般的な状態に問題があることが考えられます。おそらくコンピューターの再インストールが必要です |
| 68 | レプリケーション パートナーが無効です | repadmin.exe または**Get adreplication \\ ** Windows PowerShell を使用して、 \* パートナードメインコントローラーの正常性を検証する |
| 69 | 必須のポートが既に別のアプリケーションによって使用されています | **netstat.exe -anob** を使用して、予約済みの AD DS ポートに誤って割り当てられているプロセスを見つけます |
| 70 | フォレストのルート ドメイン コントローラーは GC でなければなりません | *非推奨とされた dcpromo/unattend でのみ表示されます。以前のドキュメントを見る* |
| 71 | DNS サーバーは既にインストールされています | DNS サーバーがインストール済みの場合は DNS をインストールする指定 (**-installDNS**) を行わないでください |
| 72 | コンピューターで、リモート デスクトップ サービスが非管理者モードで実行されています | このドメイン コントローラーは、3 名以上の管理者ユーザー用に構成された RDS サーバーでもあるため、昇格することはできません。 RDS を削除する前にその使用状況を詳しくご確認ください。アプリケーションまたはエンドユーザーによって使用されている場合、削除すると機能が停止します |
| 73 | 指定されたフォレストの機能レベルは無効です。 | 有効なフォレスト機能レベルを指定してください |
| 74 | 指定されたドメインの機能レベルは無効です。 | 有効なドメイン機能レベルを指定してください |
| 75 | デフォルトのパスワード レプリケーション ポリシーを識別することができません。 | RODC のパスワード レプリケーション ポリシーが存在し、アクセス可能であることをご確認ください |
| 76 | 指定された、レプリケート済みまたはレプリケートされていないセキュリティ グループが無効です | パスワード レプリケーション ポリシーを指定したときに、有効なドメインとユーザー アカウントを入力したことをご確認ください |
| 77 | 指定された引数は無効です | エラーの詳細とログをご確認ください |
| 78 | Active Directory フォレストを調べることができませんでした | エラーの詳細とログをご確認ください |
| 79 | rodcprep が実行されていないため、RODC を昇格できません | Windows Server 2012 を使用してフォレストを準備するか、**adprep.exe /rodcprep** を使用してください |
| 80 | Domainprep が実行されていません | Windows Server 2012 を使用してドメインを準備するか、**adprep.exe /domainprep** を使用してください |
| 81 | Forestprep が実行されていません | Windows Server 2012 を使用してフォレストを準備するか、**adprep.exe /forestprep** を使用してください |
| 82 | フォレストのスキーマが一致しません | Windows Server 2012 を使用してフォレストを準備するか、**adprep.exe /forestprep** を使用してください |
| 83 | サポートされていない SKU です | *このエラーは通常は発生しません* |
| 84 | ドメイン コントローラーのアカウントを検出できません | 既存のドメイン コントローラーに正しいユーザー アカウント コントロール属性セットがあることをご確認ください。 |
| 85 | 第 2 段階のドメイン コントローラー アカウントを選択することができません | [既存のアカウントの使用] を指定した場合で、アカウントが見つからないかアカウントの参照時にエラーが発生した場合にこのエラーが返されます。 正しい RODC 段階的アカウントを指定したことをご確認ください |
| 86 | 第 2 段階の昇格を実行する必要があります | 追加のドメイン コントローラーを昇格する場合で、既存のアカウントが存在し、[再インストールを許可] を指定していない場合にこのエラーが返されます。 |
| 87 | 競合するタイプのドメイン コントローラー アカウントが存在します | 使用されていないドメイン コントローラーにアタッチする場合以外は、昇格前にコンピューターの名前を変更してください。 **-Useexistingaccount**と、アカウントの種類に応じて、正しい読み取り専用または書き込み可能な引数を使用して、使用されていないドメインコントローラーアカウントにアタッチする必要があります |
| 88 | 指定されたサーバー管理者は有効ではありません | RODC 管理者の委任に、無効なアカウントを指定しました。 指定したアカウントが有効なユーザーまたはグループであることをご確認ください |
| 89 | 指定されたドメインの RID マスターがオフラインです。 | **netdom.exe query fsmo** を使用して RID マスターを検出し、 オンラインにしたうえで、昇格するドメイン コントローラーからアクセスできるように設定してください |
| 90 | ドメイン名前付けマスターがオフラインです。 | **netdom.exe query fsmo** を使用してドメイン名前付けマスターを検出し、 オンラインにしたうえで、昇格するドメイン コントローラーからアクセスできるように設定してください |
| 91 | プロセスが wow64 かどうかの確認に失敗しました | *オペレーティング システムが 64 ビットであるため、このエラーは発生しなくなりました* |
| 92 | Wow64 はサポートされていません | *オペレーティング システムが 64 ビットであるため、このエラーは発生しなくなりました* |
| 93 | ドメイン コントローラー サービスが非強制降格用に実行されていません | AD DS サービスを開始してください |
| 94 | ローカル管理者パスワードが要件を満たしていません。空白または必須に設定されていません | 空白でないパスワードを指定し、ローカル パスワード ポリシーでパスワードが必須に設定されていることをご確認ください |
| 95 | ライブ RODC が存在するドメインで、最後の Windows Server 2008 以降のドメイン コントローラーを降格できません | すべての Windows Server 2008 以降の書き込み可能ドメイン コントローラーを降格する前に、すべての RODC を降格する必要があります |
| 96 | DS バイナリをアンインストールできません | *非推奨とされた dcpromo/unattend でのみ表示されます。以前のドキュメントを見る* |
| 97 | フォレストの機能レベルのバージョンが、子ドメインのオペレーティング システムのものよりも高いです | 子ドメインの機能レベルを、フォレストの機能レベルと同じかそれよりも高いものにしてください |
| 98 | コンポーネントのバイナリのインストールまたはアンインストールが進行中です。 | *非推奨とされた dcpromo/unattend でのみ表示されます。以前のドキュメントを見る* |
| 99 | フォレストの機能レベルが低すぎます (Windows Server 2012 のみのエラーです) | フォレストの機能レベルを少なくとも Windows Server 2003 ネイティブと同じレベルにしてください。 Windows 2000 と Windows NT 4.0 のサポートは終了しました |
| 100 | ドメインの機能レベルが低すぎます (Windows Server 2012 のみのエラーです) | ドメインの機能レベルを少なくとも Windows Server 2003 ネイティブと同じレベルにしてください。 Windows 2000 と Windows NT 4.0 のサポートは終了しました |

## <a name="known-issues-and-common-support-scenarios"></a>既知の問題と一般的なサポートシナリオ

Windows Server 2012 開発プロセス中に発生する一般的な問題を次に示します。 これらはすべて "設計上" の問題で、最初の段階で回避するための有効な回避策または適切な手段があります。 これらの多くは Windows Server 2008 R2 およびそれ以前のオペレーティング システムでも同じですが、AD DS の展開が変更されたことで、問題への感度が高まりました。

| 問題 | ドメイン コントローラーを降格すると、DNS がゾーンなしで実行される |
|--|--|
| 現象 | サーバーは DNS 要求に応答しますが、ゾーン情報がありません |
| 解決策と説明 | AD DS 役割を削除する際は、DNS サーバー役割も削除するか、DNS サーバー サービスを無効化してください。 DNS クライアントを、それ自体でなく別のサーバーにポイントしてください。 Windows PowerShell を使用している場合は、サーバーを降格した後に以下のコマンドを実行してください<p>コード-uninstall-add-windowsfeature dns<p>or<p>コードセット-サービス dns-starttype disabled<br />サービス dns の停止 |

| 問題 | Windows Server 2012 を既存の単一ラベル ドメインに昇格しても、updatetopleveldomain=1 or allowsinglelabeldnsdomain=1 が設定されない |
|--|--|
| 現象 | DNS レコードの動的登録が行われません |
| 解決策と説明 | Netlogon と DNS グループ ポリシーを使用してこれらの値を設定します Microsoft では、Windows Server 2008 での単一ラベル ドメインの作成をブロックするようになりました。ADMT またはドメイン リネーム ツールを使って、承認済みの DNS ドメイン構造に変更してください |

| 問題 | 作成済みの、使用されていない RODC アカウントがあると、ドメイン内の最後のドメイン コントローラーの降格に失敗する |
|--|--|
| 現象 | 降格が失敗し、メッセージが表示される<p>**Dcpromo.General.54**<p>Active Directory Domain Services が、ディレクトリ パーティション CN=Schema,CN=Configuration,DC=corp,DC=contoso,DC=com 内の残りのデータを転送するための、別の Active Directory ドメイン コントローラーを見つけることができませんでした。<p>"The format of the specified domain name is invalid." |
| 解決策と説明 | ドメインを降格する前に、**Dsa.msc** または **Ntdsutil.exe metadata cleanup** を使用して、作成済みの残りの RODC を削除してください。 |

| 問題 | 自動フォレストおよびドメイン準備で GPPREP が実行されない |
|--|--|
| 現象 | グループ ポリシーのドメイン間計画機能であるポリシーの結果セット (RSOP) 計画モードでは、更新済みのファイルシステムと、既存の GP の Active Directory アクセス許可が必要です。 Gpprep がないと、ドメイン間で RSOP 計画を使用できません。 |
| 解決策と説明 | Windows Server 2003、Windows Server 2008、Windows Server 2008 R2 用に準備されていないすべてのドメインに対して、**adprep.exe /gpprep** を手動で実行してください。 管理者は、特定のドメインに対して一度だけ (アップグレードのたびにではなく) GPPrep を実行する必要があります。 これは 自動 adprep によって実行されません。その理由は、適切なカスタム アクセス許可を既に設定した場合は、すべての SYSVOL コンテンツがすべてのドメイン コントローラー上で再度レプリケートされるためです。 |

| 問題 | UNC パスをポイントしているとメディアからのインストールの検証に失敗する |
|--|--|
| 現象 | 返されるエラー<p>コード-メディアパスを検証できませんでした。 "2" 個の引数を持つ "GetDatabaseInfo" を呼び出し中に例外が発生した。 フォルダーが無効です。 |
| 解決策と説明 | IFM ファイルは、UNC パスでなくローカル ディスクに保存する必要があります。 この意図的なブロックにより、ネットワークの中断による部分的なサーバーの昇格を防止できます。 |

| 問題 | ドメイン コントローラーの昇格中に、DNS 委任の警告が 2 回表示される |
|--|--|
| 現象 | ADDSDeployment Windows PowerShell を使用して昇格すると、警告が*2 回*返されました:<p>コード-"権限のある親ゾーンが見つからないか、Windows DNS サーバーを実行していないため、この DNS サーバーの委任を作成できません。 既存の DNS インフラストラクチャと統合する場合は、ドメインの外部からの名前解決を確実に行うために、親ゾーンでこの DNS サーバーへの委任を手動で作成する必要があります。 それ以外の場合、操作は必要ありません。 " |
| 解決策と説明 | 無視。 ADDSDeployment Windows PowerShell は、前提条件チェックの際に一度、ドメイン コントローラーの構成中にもう一度、合計 2 度警告を表示します。 DNS 委任を構成したくない場合は、以下の引数を使用してください。<p>Code--creatednsdelegation: $false<p>このメッセージの表示を防止する目的で前提条件チェック** を省略することは避けてください |

| 問題 | 構成中に UPN または非ドメインの資格情報を指定すると、誤ったエラーが表示される |
|--|--|
| 現象 | サーバー マネージャーが以下のエラーを返します<p>コード-"6" 個の引数を持つ "DNSOption" を呼び出し中に例外が発生した<p>ADDSDeployment Windows PowerShell が以下のエラーを返します<p>ユーザーアクセス許可のコード検証に失敗しました。 このユーザーアカウントが属しているドメインの名前を指定する必要があります。 |
| 解決策と説明 | 有効なドメイン資格情報を **domain\user** の形式で指定したことをご確認ください |

| 問題 | Dism.exe を使用して DirectoryServices-DomainController 役割を削除すると、サーバーが起動できなくなる |
|--|--|
| 現象 | ドメイン コントローラーを正常に降格する前に Dism.exe を使用して AD DS 役割を削除すると、サーバーが正常に起動しなくなり、以下のエラーが表示されます<p>コード-状態: 0x000000000<br />情報: 予期しないエラーが発生しました。 |
| 解決策と説明 | まず *Shift + F8* を使用して、ディレクトリ サービス復元モードで起動してください。 その後 AD DS 役割をもう一度設定し、ドメイン コントローラーを強制的に降格します。 または、バックアップからシステムの状態を復元してください。 Dism.exe を使用して AD DS 役割を削除しないでください。このユーティリティはドメイン コントローラーを認識しません。 |

| 問題 | フォレスト モードを Win2012 に設定すると、新しいフォレストのインストールに失敗する |
|--|--|
| 現象 | ADDSDeployment Windows PowerShell を使用して昇格を行うと、以下のエラーが返されます<p>VerifyDcPromoCore........................<p>ドメインコントローラーの昇格の前提条件の確認に失敗しました。 指定されたドメインの機能レベルが無効です |
| 解決策と説明 | Win2012 のフォレスト機能モードを指定するときは**、Win2012 のドメイン機能モードも指定してください。 以下のように指定するとエラーが発生せずに動作します<p>Code--forestmode Win2012-domainmode Win2012] |

| 問題 | [メディアからのインストール] の選択領域で [検証] をクリックしても何も起こらない |
|--|--|
| 現象 | IFM フォルダーへのパスを指定する際、[**検証**] ボタンをクリックしても、メッセージが返されることもなく、何も実行されません。 |
| 解決策と説明 | [**検証**] ボタンをクリックすると、問題が発生している場合のみエラーが表示されます。 問題がない場合は、IFM パスを既に指定していれば、[**次へ**] ボタンが選択可能になります。 IFM を選択した場合、続行するには [**検証**] をクリックする必要があります。 |

| 問題 | サーバー マネージャーを使用して降格すると、完了するまでフィードバックが返されない。 |
|--|--|
| 現象 | サーバー マネージャーを使用して AD DS 役割を削除しドメイン コントローラーを降格した場合、降格が完了または失敗するまでフィードバックは返されません。 |
| 解決策と説明 | これはサーバー マネージャーの制限です。 フィードバックが必要な場合は、以下の ADDSDeployment Windows PowerShell コマンドレットを使用してください。<p>Uninstall-addsdomaincontroller |

| 問題 | [メディアからのインストール] の [検証] で、RODC メディアが書き込み可能なドメイン コントローラー用に提供されたかまたはその逆が行われたことが検出されない |
|--|--|
| 現象 | IFM を使用して新しいドメイン コントローラーを昇格し、IFM に、書き込み可能なドメイン コントローラーの RODC メディアや RODC の RWDC メディアなどの誤ったメディアを指定すると、[検証] ボタンでエラーが返されません。 その後、昇格に失敗して以下のエラーが返されます。<p>コード-このマシンをドメインコントローラーとして構成しようとして、エラーが発生しました。 <br />指定されたソースデータベースが許可されていないため、読み取り専用 DC のメディアからのインストールの昇格を開始できません。 RODC の IFM 昇格に使用できるのは、他の Rodc のデータベースだけです。 |
| 解決策と説明 | [検証] ボタンでは、IFM の全体的な整合性のみが確認されます。 サーバーに、誤ったタイプの IFM を指定しないでください。 次に昇格を実行する前に、正しいメディアを使用してサーバーを再起動してください。 |

| 問題 | 作成済みのコンピューター アカウントに RODC を昇格すると失敗する |
|--|--|
| 現象 | ADDSDeployment Windows PowerShell を使用して、段階的なコンピューター アカウントで新しい RODC を昇格すると、以下のエラーが表示されます。<p>指定された名前付きパラメーターを使用してコードパラメーターセットを解決することはできません。    <br />InvalidArgument: ParameterBindingException<br />    + FullyQualifiedErrorId: AmbiguousParameterSet の場合は、System.directoryservices をインストールします。 |
| 解決策と説明 | 作成済みの RODC アカウント上で既に定義済みのパラメーターを指定しないでください。 次の設定があります。<p>Code--readonlyreplica<br />-installdns<br />-donotconfigureglobalcatalog<br />-sitename<br />-installdns |

| 問題 | [必要に応じて対象サーバーを自動的に再起動する] を選択または選択解除しても何も変わらない |
|--|--|
| 現象 | 役割の削除によってドメインコントローラーを降格するときに、**必要に応じて各移行先サーバーを自動的に再起動**するサーバーマネージャーオプションを選択する (選択しない) 場合、サーバーは選択されているかどうかに関係なく、常に再起動されます。 |
| 解決策と説明 | これは意図的なものであり、 この設定に関係なく、降格プロセスを実行するとサーバーが再起動されます。 |

| 問題 | Dcpromo.log で "[error] setting security on server files failed with 2" と表示される |
|--|--|
| 現象 | ドメイン コントローラーの降格は問題なく完了するが、dcpromo ログに以下のエラーが記録されます<p>コード-[エラー] サーバーファイルのセキュリティ設定が2で失敗しました |
| 解決策と説明 | 無視してください。このエラーは予期されるものであり、特に問題はありません。 |

| 問題 | 前提条件 adprep チェックが失敗し、"交換スキーマ競合チェックを実行できません" というエラーが表示される |
|--|--|
| 現象 | Windows Server 2012 ドメイン コントローラーを既存の Windows Server 2003、Windows Server 2008、Windows Server 2008 R2 フォレストに昇格しようとすると、前提条件チェックに失敗し、以下のエラーが表示されます<p>AD 準備の前提条件のコード検証に失敗しました。 ドメインの Exchange スキーマ競合チェックを実行できません *<domain name>* (例外: RPC サーバーが使用できません)<p>adprep.log に以下のエラーが表示される<p>コード-Adprep はサーバーからデータを取得できませんでした*<domain controller>*<p>Windows Management Instrumentation (WMI) を使用します。 |
| 解決策と説明 | 新しいドメイン コントローラーは、既存のドメイン コントローラーに対する DCOM/RPC プロトコルを通じて WMI にアクセスできません。 これまでに、以下の 3 つの原因が知られています。<p>-ファイアウォール規則により、既存のドメインコントローラーへのアクセスがブロックされます。<p>-既存のドメインコントローラーに対する "サービスとしてログオン" (SeServiceLogonRight) 特権にネットワークサービスアカウントがありません<p>-Ntlm[認証の制限の概要](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd560653(v=ws.10))に関するページで説明されているセキュリティポリシーを使用して、ドメインコントローラーで ntlm が無効になっています。 |

| 問題 | 新しい AD DS フォレストを作成すると常に DNS の警告が表示される |
|--|--|
| 現象 | 新しい AD DS フォレストを作成し、それ自身に対し、新しいドメイン コントローラー上に DNS ゾーンを作成すると、以下の警告メッセージが表示されます<p>コード-DNS 構成でエラーが検出されました。 <br />このコンピューターで使用されている DNS サーバーがタイムアウト間隔内に応答しませんでした。<br />(エラーコード 0x000005B4 "ERROR_TIMEOUT") |
| 解決策と説明 | 無視。 既存の DNS サーバーおよびゾーンにポイントしようとした場合は、新しいフォレストのルートドメイン内の最初のドメイン コントローラーでこの警告が表示されるように設計されています |

| 問題 | Windows PowerShell -whatif 引数が誤った DNS サーバー情報を返す |
|--|--|
| 現象 | 暗黙的または明示的 **-installdns:$true** を使用してドメイン コントローラーを構成する際に **-whatif** 引数を使用した場合、以下の出力が返されます<p>コード-"DNS サーバー: いいえ" |
| 解決策と説明 | 無視。 DNS は正しくインストールされ構成されています。 |

| 問題 | 昇格の後、ログオンが失敗し、" このコマンドを実行するのに十分な記憶域がありません" と表示される |
|--|--|
| 現象 | 新しいドメイン コントローラーを昇格した後ログオフし、対話的にログオンしようとすると、以下のエラーが表示されます<p>コード-このコマンドを処理するのに十分なストレージがありません |
| 解決策と説明 | エラーか、または ADDSDeployment Windows PowerShell 引数 **-norebootoncompletion** を指定したことが原因で、ドメイン コントローラーが昇格の後再起動されません。 ドメイン コントローラーを再起動してください。 |

| 問題 | [ドメイン コントローラー オプション] ページで [次へ] ボタンを使用できない |
|--|--|
| 現象 | パスワードを設定しても、サーバー マネージャーの [**ドメイン コントローラー オプション**] ページで [**次へ**] ボタンが使用できません。 [**サイト名**] メニューにサイトがリストされません。 |
| 解決策と説明 | 複数の AD DS サイトがあり、そのうち少なくとも 1 つにサブネットがありません。この未来のドメイン コントローラーは、それらのサブネットの 1 つに属しています。 [サイト名] ドロップダウン メニューから手動でサブネットを選択する必要があります。 また、DSSITE.MSC を使用してすべての AD サイトを確認するか、または以下の Windows PowerShell コマンドを使用して、サブネットがないサイトをすべて調べてください。<p>コード-get-adreplicationsite-filter \* -property サブネット &#124; where-オブジェクト {! $ _. サブネット-eq " \* "} &#124; 形式-テーブル名 |

| 問題 | 昇格または降格が失敗し、"サービスを開始できません" というメッセージが表示される |
|--|--|
| 現象 | ドメイン コントローラーの昇格、降格、複製などを実行しようとすると、以下のエラーが表示されます。<p>コード-サービスが無効になっているか、有効なデバイスが関連付けられていないため、サービスを開始できませんでした。 (0x80070422)<p>このエラーは、対話型か、イベントか、または dcpromoui.log や dcpromo.log といったログに書き込まれます |
| 解決策と説明 | DS 役割サーバー サービス (DsRoleSvc) が無効化されています。 既定では、このサービスは AD DS 役割のインストール中にインストールされ、開始の種類が [手動] に設定されます。 このサービスは無効にしないでください。 サービスを [手動] に設定しなおし、DS 役割の操作が必要に応じて開始および終了できるようにします。 この動作は仕様です。 |

| 問題 | サーバー マネージャーが、DC を降格する必要があると引き続き警告する |
|--|--|
| 現象 | 非推奨の dcpromo.exe /unattend を使用してドメイン コントローラーを昇格するか、または既存の Windows Server 2008 R2 ドメイン コントローラーを Windows Server 2012 にアップグレードすると、サーバー マネージャーは展開後の構成タスク [**このサーバーをドメイン コントローラーに昇格する**] を引き続き表示します。 |
| 解決策と説明 | 展開後の警告のリンクをクリックすると、メッセージが消えます。 このエラーは予期されるものであり、特に問題はありません。 |

| 問題 | サーバー マネージャーの展開スクリプトに役割インストールがない |
|--|--|
| 現象 | サーバー マネージャーを使用してドメイン コントローラーを昇格し、Windows PowerShell 展開スクリプトを保存すると、役割インストールのコマンドレットと引数 (install-windowsfeature -name ad-domain-services -includemanagementtools) が含まれません。 役割がないと、DC を構成できない。 |
| 解決策と説明 | スクリプトに、該当するコマンドレットと引数を手動で追加してください。 この動作は仕様です。 |

| 問題 | サーバー マネージャーの展開スクリプトが PS1 という名前ではない |
|--|--|
| 現象 | サーバー マネージャーを使用してドメイン コントローラーを昇格し、Windows PowerShell 展開スクリプトを保存すると、ファイルには、PS1 ではなくランダムな一時名が付けられます。 |
| 解決策と説明 | ファイル名を手動で変更してください。 この動作は仕様です。 |

| 問題 | Dcpromo /unattend で、サポートされない機能レベルが許可される |
|--|--|
| 現象 | dcpromo /unattend を使用し、以下のサンプル応答ファイルでドメイン コントローラーを昇格した場合、<p>コード<p>DCInstall<br />NewDomain = フォレスト<p>ReplicaOrNewDomain = ドメイン<p>NewDomainDNSName = corp. .com<p>SafeModeAdminPassword =Safepassword@6<p>DomainNetbiosName = corp<p>DNSOnNetwork = はい<p>AutoConfigDNS = はい<p>RebootOnSuccess = NoAndNoPromptEither か<p>RebootOnCompletion = いいえ<p>*DomainLevel = 0*<p>*ForestLevel = 0*<p>昇格が失敗し、dcpromoui.log に以下のエラーが記録されます<p>コード-dcproの i EA 4.5 B8 0089 13:31: 50.783 Enter CArgumentsSpec:: ValidateArgument DomainLevel<p>dcproの i EA 4.5 B8 008A 13:31: DomainLevel の50.783 値は0です。<p>dcproの i EA 4.5 B8 008B 13:31: 50.783 終了コードは77<p>dcprob8 i EA 4.5 008C 13:31: 50.783 指定された引数が無効です。<p>dcprob8 i EA 4.5 008D 13:31: 50.783 終了ログ<p>dcprob8 i EA 4.5 0032 13:31: 50.830 終了コードは77<p>レベル 0 は、Windows Server 2012 でサポートされていない Windows 2000 です。 |
| 解決策と説明 | 非推奨の dcpromo /unattend を使用しないでください。これを使用すると無効な設定が可能となり、エラーの原因となります。 この動作は仕様です。 |

| 問題 | NTDS 設定オブジェクトの作成時に昇格がハングし、完了しない |
|--|--|
| 現象 | レプリカ DC または RODC を昇格させた場合、昇格は "NTDS 設定オブジェクトの作成" に達し、続行または完了しません。 ログも更新されなくなります。 |
| 解決策と説明 | これは、ビルトイン ドメイン管理者アカウントに一致するパスワードを使用してビルトイン ローカル管理者のアカウントの資格情報を指定すると発生することが知られている問題です。 これにより、中心となるセットアップ エンジンに問題が発生し、エラーを発生させるのでなく、永遠に待機します (疑似ループ). これは予想される動作ですが、望ましくありません。<p>サーバーを修復するには以下の手順を実行してください。<p>1. 再起動します。<p>1. AD で、そのサーバーのメンバーコンピューターアカウントを削除します (まだ DC アカウントではありません)。<p>1. そのサーバーで、ドメインから強制的に切断を行います。<p>1. そのサーバーで、AD DS の役割を削除します。<p>1. 再起動<p>1. AD DS の役割をもう一度追加し、昇格を再試行します。これにより、組み込みのローカル管理者アカウントだけでなく、常に、ドメイン \***管理***者によって書式設定された資格情報が DC の昇格に提供されるようになります。 |
