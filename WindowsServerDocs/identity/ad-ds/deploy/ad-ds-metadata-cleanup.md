---
title: AD DS サーバーメタデータのクリーンアップ
description: 組み込みのツールを使用して、削除されたドメインコントローラーからメタデータをクリーンアップする
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 11/14/2018
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: a8061aa6488c97211506d321d0b38b1360be97eb
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/23/2020
ms.locfileid: "86960584"
---
# <a name="clean-up-active-directory-domain-controller-server-metadata"></a>Active Directory ドメイン Controller サーバーメタデータのクリーンアップ

適用先:Windows Server

Active Directory Domain Services (AD DS) を強制的に削除した後で、メタデータのクリーンアップが必要な手順です。 強制的に削除したドメインコントローラーのドメインのドメインコントローラーで、メタデータのクリーンアップを実行します。 メタデータのクリーンアップでは、ドメインコントローラーを識別する AD DS からレプリケーションシステムへのデータを削除します。 また、メタデータのクリーンアップでは、ファイルレプリケーションサービス (FRS) と分散ファイルシステム (DFS) レプリケーション接続を削除し、廃止されたドメインコントローラーが保持する操作マスター (フレキシブルシングルマスター操作または FSMO とも呼ばれます) ロールの転送または強制を試行します。

サーバーのメタデータをクリーンアップするには、次の3つのオプションがあります。

- GUI ツールを使用したサーバーメタデータのクリーンアップ
- コマンドラインを使用してサーバーメタデータをクリーンアップする
- スクリプトを使用したサーバーメタデータのクリーンアップ

> [!NOTE]
> これらの方法のいずれかを使用してメタデータのクリーンアップを実行するときに "アクセスが拒否されました" というエラーが発生した場合は、ドメインコントローラーのコンピューターオブジェクトと NTDS 設定オブジェクトが誤って削除されないように保護されていないことを確認してください。 これを確認するには、コンピューターオブジェクトまたは NTDS 設定オブジェクトを右クリックし、[**プロパティ**]、[**オブジェクト**] の順にクリックして、[誤って削除されないように**オブジェクトを保護**する] チェックボックスをオフにします。 Active Directory ユーザーとコンピューター] で、[**表示**] をクリックし、[**高度な機能**] をクリックすると、オブジェクトの [**オブジェクト**] タブが表示されます。

## <a name="clean-up-server-metadata-using-gui-tools"></a>GUI ツールを使用したサーバーメタデータのクリーンアップ

Windows Server に含まれているリモートサーバー管理ツール (RSAT) または Active Directory ユーザーとコンピューターコンソール (Dsa.msc) を使用して、ドメインコントローラーのコンピューターアカウントをドメインコントローラー組織単位 (OU) から削除すると、サーバーメタデータのクリーンアップが自動的に実行されます。 Windows Server 2008 より前では、個別のメタデータクリーンアップ手順を実行する必要がありました。

また、Active Directory サイトとサービスコンソール (Dssite .msc) を使用して、ドメインコントローラーのコンピューターアカウントを削除することもできます。これにより、メタデータのクリーンアップも自動的に完了します。 ただし、Active Directory のサイトとサービスでは、Dssite .msc のコンピューターアカウントの下にある NTDS 設定オブジェクトを最初に削除した場合にのみ、メタデータが自動的に削除されます。

以前のバージョンの Windows オペレーティングシステムを実行しているドメインコントローラーの場合、Windows Server 2008 またはそれ以降のバージョンの RSAT または Dssite .msc を使用している限り、メタデータを自動的にクリーンアップできます。

これらの手順を完了するには、 **Domain Admins**のメンバーシップ、またはそれと同等のメンバーシップが最低限必要です。

## <a name="clean-up-server-metadata-using-activedirectory-users-and-computers"></a>Active Directory ユーザーとコンピューターを使用してサーバーメタデータをクリーンアップする

1. **[Active Directory ユーザーとコンピューター]** を開きます。
2. この手順の準備としてレプリケーションパートナーを特定し、削除しようとしているメタデータを持つ削除されたドメインコントローラーのレプリケーションパートナーに接続していない場合は、[ **Active Directory ユーザーとコンピューター** ] ノードを右クリックし、[**ドメインコントローラーの変更**] をクリックします。 メタデータを削除するドメインコントローラーの名前をクリックし、[ **OK]** をクリックします。
3. 強制的に削除されたドメインコントローラーのドメインを展開し、[**ドメインコントローラー**] をクリックします。
4. 詳細ウィンドウで、メタデータをクリーンアップするドメインコントローラーのコンピューターオブジェクトを右クリックし、[**削除**] をクリックします。
5. [ **Active Directory Domain Services** ] ダイアログボックスで、削除するドメインコントローラの名前が表示されていることを確認し、[は**い**] をクリックしてコンピュータオブジェクトの削除を確定します。
6. [**ドメインコントローラーを削除**しています] ダイアログボックスで、[**このドメインコントローラーは完全にオフラインになっており、Active Directory ドメインサービスインストールウィザード (DCPROMO) を使用して降格できないよう**にする] を選択し、[**削除**] をクリックします。
7. ドメインコントローラーがグローバルカタログサーバーの場合は、[**ドメインコントローラーの削除**] ダイアログボックスで [**はい**] をクリックして削除を続行します。
8. ドメインコントローラーが現在1つ以上の操作マスターの役割を保持している場合は、[ **OK]** をクリックして、表示されているドメインコントローラーに役割または役割を移動します。 このドメインコントローラーを変更することはできません。 役割を別のドメインコントローラーに移動する場合は、サーバーメタデータのクリーンアップ手順を完了した後に役割を移動する必要があります。

## <a name="clean-up-server-metadata-using-activedirectory-sites-and-services"></a>Active Directory サイトとサービスを使用したサーバーメタデータのクリーンアップ

1. [Active Directory サイトとサービス] を開きます。
2. この手順の準備としてレプリケーションパートナーを特定していて、削除しようとしているメタデータを持つ削除されたドメインコントローラーのレプリケーションパートナーに接続していない場合は、[ **Active Directory サイトとサービス**] を右クリックし、[**ドメインコントローラーの変更**] をクリックします。 メタデータを削除するドメインコントローラーの名前をクリックし、[ **OK]** をクリックします。
3. 強制的に削除されたドメインコントローラーのサイトを展開し、[**サーバー**] を展開し、ドメインコントローラーの名前を展開します。次に、[NTDS 設定] オブジェクトを右クリックし、[**削除**] をクリックします。
4. [**サイトとサービスの Active Directory** ] ダイアログボックスで、[**はい**] をクリックして、NTDS 設定の削除を確認します。
5. [**ドメインコントローラーを削除**しています] ダイアログボックスで、[**このドメインコントローラーは完全にオフラインになっており、Active Directory ドメインサービスインストールウィザード (DCPROMO) を使用して降格できないよう**にする] を選択し、[**削除**] をクリックします。
6. ドメインコントローラーがグローバルカタログサーバーの場合は、[**ドメインコントローラーの削除**] ダイアログボックスで [**はい**] をクリックして削除を続行します。
7. ドメインコントローラーが現在1つ以上の操作マスターの役割を保持している場合は、[ **OK]** をクリックして、表示されているドメインコントローラーに役割または役割を移動します。
8. 強制的に削除されたドメインコントローラーを右クリックし、[削除] をクリックします。
9. [ **Active Directory Domain Services** ] ダイアログボックスで、[**はい**] をクリックしてドメインコントローラーの削除を確定します。

## <a name="clean-up-server-metadata-using-the-command-line"></a>コマンドラインを使用してサーバーメタデータをクリーンアップする

別の方法として、Active Directory ライトウェイトディレクトリサービス (AD LDS) がインストールされているすべてのドメインコントローラーとサーバーに自動的にインストールされるコマンドラインツール Ntdsutil.exe を使用して、メタデータをクリーンアップすることもできます。 Ntdsutil.exe は、RSAT がインストールされているコンピューターでも使用できます。

## <a name="to-clean-up-server-metadata-by-using-ntdsutil"></a>Ntdsutil を使用してサーバーメタデータをクリーンアップするには

1. 管理者としてコマンドプロンプトを開きます。 [**スタート**] メニューで、[**コマンドプロンプト**] を右クリックし、[**管理者として実行**] をクリックします。 [**ユーザーアカウント制御**] ダイアログボックスが表示されたら、必要に応じてエンタープライズ管理者の資格情報を入力し、[**続行**] をクリックします。
2. コマンド プロンプトで、次のコマンドを入力して Enter キーを押します。

   `ntdsutil`

3. `ntdsutil:` プロンプトで次のコマンドを入力し、Enter キーを押します。

   `metadata cleanup`

4. `metadata cleanup:` プロンプトで次のコマンドを入力し、Enter キーを押します。

   `remove selected server <ServerName>`

5. [**サーバーの構成の削除] ダイアログ**で、情報と警告を確認し、[は**い**] をクリックしてサーバーオブジェクトとメタデータを削除します。

   この時点で、Ntdsutil はドメインコントローラーが正常に削除されたことを確認します。 オブジェクトが見つからないことを示すエラーメッセージが表示された場合は、ドメインコントローラが既に削除されている可能性があります。

6. プロンプトで、「」と入力し、enter `metadata cleanup:` `ntdsutil:` キーを `quit` 押します。

7. ドメインコントローラーの削除を確認するには、次のようにします。

   [Active Directory ユーザーとコンピューター] を開きます。 削除されたドメインコントローラーのドメインで、[**ドメインコントローラー**] をクリックします。 詳細ウィンドウでは、削除したドメインコントローラーのオブジェクトは表示されません。

   Active Directory サイトとサービスを開きます。 [**サーバー** ] コンテナーに移動し、削除したドメインコントローラのサーバーオブジェクトに NTDS 設定オブジェクトが含まれていないことを確認します。 サーバーオブジェクトの下に子オブジェクトが表示されない場合は、サーバーオブジェクトを削除できます。 子オブジェクトが存在する場合は、別のアプリケーションがオブジェクトを使用しているため、サーバーオブジェクトを削除しないでください。

## <a name="see-also"></a>参照

* [ドメイン コント ローラーの降格](Demoting-Domain-Controllers-and-Domains--Level-200-.md)
* [Ntdsutil コマンドリファレンス](/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/cc753343(v=ws.10))
