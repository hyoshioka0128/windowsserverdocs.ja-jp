---
ms.assetid: 4cc9c16c-1928-4dce-a3a8-6229be28eb65
title: Active Directory レプリケーションの概念
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: 96e6ae37851119b40cf03772b6a8710acaf62333
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2020
ms.locfileid: "80824625"
---
# <a name="active-directory-replication-concepts"></a>Active Directory レプリケーションの概念

>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

サイトトポロジを設計する前に、いくつかの Active Directory レプリケーションの概念を理解しておいてください。  
  
-   [Connection オブジェクト](#BKMK_1)  
  
-   [KCC](#BKMK_2)  
  
-   [フェールオーバー機能](#BKMK_3)  
  
-   [・](#BKMK_4)  
  
-   [サイト](#BKMK_5)  
  
-   [サイトリンク](#BKMK_6)  
  
-   [サイトリンクブリッジ](#BKMK_7)  
  
-   [サイトリンクの推移性](#BKMK_8)  
  
-   [グローバルカタログサーバー](#BKMK_9)  
  
-   [ユニバーサルグループメンバーシップのキャッシュ](#BKMK_10)  
  
## <a name="connection-object"></a><a name="BKMK_1"></a>Connection オブジェクト  
接続オブジェクトは、ソースドメインコントローラから宛先ドメインコントローラへのレプリケーション接続を表す Active Directory オブジェクトです。 ドメインコントローラは、1つのサイトのメンバであり、サイトで Active Directory Domain Services (AD DS) のサーバーオブジェクトによって表されます。 各サーバーオブジェクトには、サイト内のレプリケートするドメインコントローラーを表す NTDS 設定の子オブジェクトがあります。  
  
接続オブジェクトは、移行先サーバー上の NTDS 設定オブジェクトの子です。 2つのドメインコントローラー間でレプリケーションが行われるようにするには、1つのサーバーオブジェクトに、もう一方からの入力方向のレプリケーションを表す接続オブジェクトがある必要があります。 ドメインコントローラーのすべてのレプリケーション接続は、NTDS 設定オブジェクトの下に接続オブジェクトとして格納されます。 接続オブジェクトは、レプリケーションの移行元サーバーを識別し、レプリケーションスケジュールを含み、レプリケーショントランスポートを指定します。  
  
知識整合性チェッカー (KCC) では、接続オブジェクトが自動的に作成されますが、手動で作成することもできます。 KCC によって作成された接続オブジェクトは、Active Directory サイトとサービススナップインに **<automatically generated>** として表示され、通常の動作状況では適切と見なされます。 管理者によって作成された接続オブジェクトは、手動で作成された接続オブジェクトです。 手動で作成された接続オブジェクトは、作成時に管理者によって割り当てられた名前によって識別されます。 **<automatically generated>** 接続オブジェクトを変更すると、管理者が変更した接続オブジェクトに変換され、オブジェクトが GUID の形式で表示されます。 KCC は、手動または変更された接続オブジェクトに変更を加えません。  
  
## <a name="kcc"></a><a name="BKMK_2"></a>KCC  
KCC は、すべてのドメインコントローラー上で実行され、Active Directory フォレストのレプリケーショントポロジを生成する組み込みプロセスです。 KCC は、レプリケーションがサイト内 (サイト内) とサイト間 (サイト間) のどちらで発生しているかに応じて、個別のレプリケーショントポロジを作成します。 また、KCC は、新しいドメインコントローラーの追加、既存のドメインコントローラーの削除、サイトとの間でのドメインコントローラーの移動、コストとスケジュールの変更、一時的に使用できない、またはエラー状態になっているドメインコントローラーの追加に対応するトポロジを動的に調整します。  
  
サイト内では、書き込み可能なドメインコントローラー間の接続は常に双方向リングに配置され、追加のショートカット接続を使用して大規模なサイトでの待機時間を短縮できます。 一方、サイト間トポロジは、スパニングツリーのレイヤーです。これは、各ディレクトリパーティションの2つのサイト間に1つのサイト間接続が存在し、通常、ショートカット接続が含まれていないことを意味します。 ツリーと Active Directory レプリケーショントポロジの詳細については、「Active Directory レプリケーショントポロジのテクニカルリファレンス ([https://go.microsoft.com/fwlink/?LinkID=93578](https://go.microsoft.com/fwlink/?LinkID=93578))」を参照してください。  
  
各ドメインコントローラーで、KCC は、他のドメインコントローラーからの接続を定義する一方向の受信接続オブジェクトを作成することによって、レプリケーションルートを作成します。 同じサイト内のドメインコントローラーの場合、KCC は管理者の介入なしに自動的に接続オブジェクトを作成します。 複数のサイトがある場合は、サイト間のサイトリンクを構成し、各サイトの1つの KCC でもサイト間の接続が自動的に作成されます。  
  
### <a name="kcc-improvements-for-windows-server-2008-rodcs"></a>Windows Server 2008 Rodc の KCC の機能強化  

Windows Server 2008 で新しく使用できる読み取り専用ドメインコントローラー (RODC) に対応するために、いくつかの KCC の機能強化が行われています。 RODC の典型的な展開シナリオは、ブランチオフィスです。 このシナリオで最も一般的に展開される Active Directory レプリケーショントポロジは、ハブとスポークの設計に基づいています。複数のサイト内のブランチドメインコントローラーは、ハブサイト内の少数のブリッジヘッドサーバーを使用してレプリケートされます。  
  
このシナリオで RODC を展開する利点の1つは、一方向のレプリケーションです。 RODC からのレプリケートにブリッジヘッドサーバーは必要ありません。これにより、管理とネットワークの使用が軽減されます。  
  
ただし、以前のバージョンの Windows Server オペレーティングシステムでハブスポークトポロジによって強調表示されている管理上の課題の1つは、ハブに新しいブリッジヘッドドメインコントローラーを追加した後、ブランチドメインコントローラーとハブドメインコントローラーの間でレプリケーション接続を再配布して新しいハブドメインコントローラーを活用するための自動メカニズムがないことです。  
  
Windows Server 2003 ドメインコントローラーでは、Windows Server 2003 ブランチオフィス展開ガイド ([https://go.microsoft.com/fwlink/?LinkID=28523](https://go.microsoft.com/fwlink/?LinkID=28523)) の adlb .exe などのツールを使用して、ワークロードを再調整できます。  
  
Windows Server 2008 Rodc の場合、KCC の通常の機能によっていくつかの再調整が提供されるため、Adlb .exe などの追加ツールを使用する必要がなくなります。 新しい機能は既定で有効になっています。 RODC に次のレジストリキーセットを追加することで、無効にすることができます。  
  
**HKEY_LOCAL_MACHINE \SYSTEM\CurrentControlSet\Services\NTDS\Parameters**  
  
**"ランダムな BH 負荷分散が許可されています"**  
**1 = 有効 (既定)、0 = 無効**  
  
これらの KCC の機能強化のしくみの詳細については、「ブランチオフィスの Active Directory Domain Services の計画と展開」 ([https://go.microsoft.com/fwlink/?LinkId=107114](https://go.microsoft.com/fwlink/?LinkId=107114)) を参照してください。  
  
## <a name="failover-functionality"></a><a name="BKMK_3"></a>フェールオーバー機能  
サイトでは、ネットワーク障害やオフラインドメインコントローラーに対してレプリケーションがルーティングされるようにします。 KCC は、指定した間隔で実行され、新しいドメインコントローラーが追加され、新しいサイトが作成されたときなど、AD DS で発生する変更のレプリケーショントポロジを調整します。 KCC は、既存の接続のレプリケーションステータスを確認して、接続が機能していないかどうかを判断します。 ドメインコントローラーに障害が発生したために接続が機能していない場合は、他のレプリケーションパートナーへの一時的な接続が KCC によって自動的に作成され、レプリケーションが確実に行われます。 サイト内のすべてのドメインコントローラが使用できない場合は、KCC によって、別のサイトのドメインコントローラ間のレプリケーション接続が自動的に作成されます。  
  
## <a name="subnet"></a><a name="BKMK_4"></a>・  
サブネットは、一連の論理 IP アドレスが割り当てられる TCP/IP ネットワークのセグメントです。 サブネットは、ネットワーク上の物理的な距離を識別するようにコンピューターをグループ化します。 AD DS のサブネットオブジェクトは、コンピューターをサイトにマップするために使用されるネットワークアドレスを識別します。  
  
## <a name="site"></a><a name="BKMK_5"></a>サイト  
サイトは、信頼性が高く高速なネットワーク接続を備えた1つまたは複数の TCP/IP サブネットを表すオブジェクト Active Directory ます。 サイト情報を使用すると、管理者は Active Directory アクセスとレプリケーションを構成して、物理ネットワークの使用を最適化することができます。 サイトオブジェクトはサブネットのセットに関連付けられており、フォレスト内の各ドメインコントローラーは、その IP アドレスに従って Active Directory サイトに関連付けられています。 サイトは複数のドメインからドメインコントローラーをホストでき、1つのドメインを複数のサイトで表すことができます。  
  
## <a name="site-link"></a><a name="BKMK_6"></a>サイトリンク  
サイトリンクは、KCC が Active Directory レプリケーションの接続を確立するために使用する論理パスを表すオブジェクト Active Directory ます。 サイトリンクオブジェクトは、指定されたサイト間トランスポートを通じて一様なコストで通信できるサイトのセットを表します。  
  
サイトリンク内に含まれるすべてのサイトは、同じネットワークの種類を使用して接続されていると見なされます。 1つのサイトのドメインコントローラーが別のサイトのドメインコントローラーからディレクトリの変更をレプリケートできるように、サイトを別のサイトに手動でリンクする必要があります。 サイトリンクは、レプリケーション時に物理ネットワーク上のネットワークパケットによって実行される実際のパスに対応していないため、Active Directory レプリケーションの効率を向上させるために、冗長なサイトリンクを作成する必要はありません。  
  
2つのサイトがサイトリンクによって接続されている場合は、レプリケーションシステムによって、ブリッジヘッドサーバーと呼ばれる各サイトの特定のドメインコントローラ間の接続が自動的に作成されます。 Windows Server 2008 では、同じディレクトリパーティションをホストするサイト内のすべてのドメインコントローラーが、ブリッジヘッドサーバーとして選択されていることが候補となります。 KCC によって作成されたレプリケーション接続は、レプリケーションワークロードを共有するために、サイト内のすべての候補となるブリッジヘッドサーバー間でランダムに分散されます。 既定では、接続オブジェクトが最初にサイトに追加されるときに、ランダム化された選択プロセスが1回だけ行われます。  
  
## <a name="site-link-bridge"></a><a name="BKMK_7"></a>サイトリンクブリッジ  
サイトリンクブリッジは、サイトリンクのセットを表す Active Directory オブジェクトであり、すべてのサイトが共通のトランスポートを使用して通信できます。 サイトリンクブリッジは、通信リンクを使用して直接接続されていないドメインコントローラーを相互にレプリケートできるようにします。 通常、サイトリンクブリッジは、IP ネットワーク上のルーター (またはルーターのセット) に対応します。  
  
既定では、KCC は、共通のサイトを含むすべてのサイトリンクを介して、推移的なルートを形成できます。 この動作が無効になっている場合、各サイトリンクは個別の分離されたネットワークを表します。 単一のルートとして扱われるサイトリンクのセットは、サイトリンクブリッジによって表されます。 各ブリッジは、ネットワークトラフィック用の分離通信環境を表します。  
  
サイトリンクブリッジは、サイト間の推移的な物理的な接続を論理的に表すメカニズムです。 サイトリンクブリッジを使用すると、KCC は、含まれているサイトリンクの任意の組み合わせを使用して、これらのサイトに保持されているディレクトリパーティションを相互接続するための最もコストが低いルートを判断できます。 サイトリンクブリッジは、ドメインコントローラーへの実際の接続を提供しません。 サイトリンクブリッジが削除されると、KCC がリンクを削除するまで、結合されたサイトリンク経由のレプリケーションは続行されます。  
  
サイトリンクブリッジは、サイトに、隣接するサイトのドメインコントローラーではホストされていないディレクトリパーティションをホストしているドメインコントローラーが含まれていて、そのディレクトリパーティションをホストしているドメインコントローラーがフォレスト内の1つまたは複数の他のサイトに配置されている場合にのみ必要です。 隣接するサイトは、1つのサイトリンクに含まれる2つ以上のサイトとして定義されます。  
  
サイトリンクブリッジは、2つのサイトリンクの間に論理接続を作成し、中間サイトを使用して2つの接続されていないサイト間に推移的なパスを提供します。 サイト間トポロジジェネレーター (ISTG) の目的では、ブリッジは中間サイトを使用して物理的な接続を意味します。 ブリッジは、中間サイトのドメインコントローラーがレプリケーションパスを提供することを意味しません。 ただし、これは、中間サイトに、レプリケートするディレクトリパーティションをホストするドメインコントローラーが含まれている場合に発生します。この場合、サイトリンクブリッジは必要ありません。  
  
各サイトリンクのコストが加算され、結果として得られるパスの合計コストが作成されます。 サイトリンクブリッジは、中間サイトにディレクトリパーティションをホストしているドメインコントローラーが含まれておらず、コストが低いリンクが存在しない場合に使用されます。 中間サイトにディレクトリパーティションをホストするドメインコントローラーが含まれている場合、切断された2つのサイトは、中間ドメインコントローラーへのレプリケーション接続を設定し、ブリッジは使用しません。  
  
## <a name="site-link-transitivity"></a><a name="BKMK_8"></a>サイトリンクの推移性  
既定では、すべてのサイトリンクが推移的または "ブリッジ" されます。 サイトリンクがブリッジされ、スケジュールが重複する場合、サイト間のドメインコントローラーのレプリケーションパートナーを決定するレプリケーション接続が KCC によって作成されます。この場合、サイトはサイトリンクによって直接接続されていませんが、一連の共通サイト経由で推移的に接続されます。 これは、サイトリンクを組み合わせることによって、任意のサイトを他のサイトに接続できることを意味します。  
  
一般に、完全にルーティングされたネットワークでは、レプリケーションの変更のフローを制御する必要がある場合を除き、サイトリンクブリッジを作成する必要はありません。 ネットワークが完全にルーティングされていない場合は、レプリケーションの試行が行われないように、サイトリンクブリッジを作成する必要があります。 特定のトランスポートのすべてのサイトリンクは、そのトランスポートの単一サイトリンクブリッジに暗黙的に属しています。 サイトリンクの既定のブリッジングは自動的に実行され、そのブリッジを表す Active Directory オブジェクトは存在しません。 IP および簡易メール転送プロトコル (SMTP) のサイト間トランスポートコンテナーのプロパティにある [**すべてのサイトリンクをブリッジ**する] 設定は、サイトリンクの自動ブリッジングを実装します。  
  
> [!NOTE]  
> SMTP レプリケーションは、今後のバージョンの AD DS ではサポートされません。そのため、SMTP コンテナーにサイトリンクオブジェクトを作成することはお勧めできません。  
  
## <a name="global-catalog-server"></a><a name="BKMK_9"></a>グローバルカタログサーバー  
グローバルカタログサーバーは、フォレスト内のすべてのオブジェクトに関する情報を格納するドメインコントローラーであり、アプリケーションは要求されたデータを格納している特定のドメインコントローラーを参照せずに AD DS を検索できます。 すべてのドメインコントローラーと同様に、グローバルカタログサーバーには、スキーマおよび構成ディレクトリパーティションの完全な書き込み可能なレプリカ、およびホストしているドメインのドメインディレクトリパーティションの完全な書き込み可能なレプリカが格納されます。 さらに、グローバルカタログサーバーには、フォレスト内の他のすべてのドメインの読み取り専用の部分的なレプリカが格納されます。 読み取り専用ドメインの部分的なレプリカには、ドメイン内のすべてのオブジェクトが含まれますが、属性のサブセット (オブジェクトの検索に最もよく使用される属性) のみが含まれます。  
  
## <a name="universal-group-membership-caching"></a><a name="BKMK_10"></a>ユニバーサルグループメンバーシップのキャッシュ  
ユニバーサルグループメンバーシップのキャッシュを使用すると、ドメインコントローラーはユーザーのユニバーサルグループメンバーシップ情報をキャッシュできます。 Active Directory サイトとサービス スナップインを使用して、ユニバーサルグループメンバーシップをキャッシュするために、Windows Server 2008 を実行しているドメインコントローラーを有効にすることができます。  
  
ユニバーサルグループメンバーシップのキャッシュを有効にすると、ドメイン内のすべてのサイトでグローバルカタログサーバーを使用する必要がなくなります。これにより、ドメインコントローラーはフォレストにあるすべてのオブジェクトをレプリケートする必要がなくなるため、ネットワーク帯域幅の使用を最小限に抑えられます。 また、認証を行うドメインコントローラーは、ユニバーサルグループメンバーシップ情報を取得するために常にグローバルカタログにアクセスする必要がないため、ログオン時間が短縮されます。 ユニバーサルグループメンバーシップのキャッシュを使用する場合の詳細については、「[グローバルカタログサーバーの配置の計画](../../../ad-ds/plan/Planning-Global-Catalog-Server-Placement.md)」を参照してください。  
  


