---
title: フェールオーバー クラスタ リングのないライブ マイグレーションのためのホストの設定します。
description: 非クラスター化環境でのライブ マイグレーションのセットアップ手順します。
ms.prod: windows-server-threshold
ms.service: na
manager: dongill
ms.technology: compute-hyper-v
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: b5e3c405-cb76-4ff2-8042-c2284448c435
author: KBDAzure
ms.author: kathydav
ms.date: 9/30/2016
ms.openlocfilehash: 49e36d7fae5eec07772fd6f82c5a5d69838351d8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59821993"
---
# <a name="set-up-hosts-for-live-migration-without-failover-clustering"></a>フェールオーバー クラスタ リングのないライブ マイグレーションのためのホストの設定します。

>適用先:Windows Server 2016、Microsoft HYPER-V Server 2016、Windows Server 2019、Microsoft HYPER-V Server 2019

この記事では、ホスト クラスターを構成していないため、それらの間の移行を受け入れられるを設定する方法を示します。 、HYPER-V をインストールしたときに、ライブ マイグレーションを設定していない場合、または、設定を変更する場合は、次の手順を使用します。 クラスター化されたホストを設定するには、フェールオーバー クラスタ リングのツールを使用します。  
  
## <a name="requirements-for-setting-up-live-migration"></a>ライブ マイグレーションを設定するための要件  
  
ライブ マイグレーションのための非クラスター化ホストをセットアップするには、必要があります。   
  
-  さまざまな手順を実行するアクセス許可を持つユーザー アカウント。 ローカル HYPER-V Administrators グループまたはソースと宛先の両方のコンピューターの Administrators グループのメンバーシップは、制約付き委任を構成している場合を除き、この要件を満たしています。 ドメイン管理者グループのメンバーシップは、制約付き委任を構成する必要があります。  
  
- Windows Server 2016 または元と移行先サーバーにインストールされている Windows Server 2012 R2 で HYPER-V ロール。 仮想マシンは、少なくとも場合は、Windows Server 2016 および Windows Server 2012 R2 を実行しているホスト間のライブ マイグレーションを行うことができますバージョン 5。 <br>バージョンのアップグレード手順については、次を参照してください。 [Windows 10 または Windows Server 2016 での Hyper-v で仮想マシンのアップグレード バージョン](Upgrade-virtual-machine-version-in-Hyper-V-on-Windows-or-Windows-Server.md)します。 インストール手順については、次を参照してください。 [Windows server、Hyper-v の役割をインストール](../get-started/Install-the-Hyper-V-role-on-Windows-Server.md)します。  
  
- 同じ Active Directory ドメインに属しているか、相互に信頼関係ドメインに属しているか、ソースおよび展開先コンピューター。    
- 送信元または送信先のサーバーで、ツールがインストールされていない場合は、Windows Server 2016 または Windows 10 を実行しているコンピューターにインストールされている HYPER-V 管理ツールでは、サーバーから、ツールを実行します。  
  
## <a name="consider-options-for-authentication-and-networking"></a>認証およびネットワークのオプションを検討してください。  
  
以下を設定する方法を検討してください。  
  
-  **認証**:ソースと移行先サーバー間のライブ マイグレーション トラフィックの認証にどのプロトコルが使用されますか。 この選択は、ライブ マイグレーションを開始する前に、移行元サーバーへのサインオンに必要かどうかにより決まります。   
   - Kerberos は、サーバーにサインインしなくてもすむようにすることができますが、制約付き委任を設定する必要があります。 手順については、以下を参照してください。  
   - CredSSP はしないように、制約付き委任を設定することができますが、移行元サーバーにサインインする必要があります。 これは、ローカル コンソール セッション、リモート デスクトップ セッションまたはリモートの Windows PowerShell セッションで実行できます。  
  
      CredSPP では、サインインする明白なことができない可能性がある状況が必要です。 たとえば、仮想マシンを TestServer02 に移動し、仮想マシンを TestServer01 に移動する TestServer01 にサインインする場合は、仮想マシンを TestServer01 に移動しようとする前に、TestServer02 にサインインする必要があります。 これを行わない場合は、エラーが発生する認証の試行は失敗し、次のメッセージが表示されます。  
    
      "バーチャル マシンの移行操作は、移行元で失敗しました。  
      ホストとの接続を確立できませんでした*コンピューター名*:資格情報がない 0x8009030E セキュリティ パッケージで使用できます。"
  
-   **パフォーマンス**:理にかなってパフォーマンス オプションを構成しますか。 これらのオプションはネットワークと CPU 使用率を削減だけでなく高速のライブ マイグレーションを行います。 お客様の要件と、インフラストラクチャを考慮し、決定に役立つさまざまな構成をテストします。 手順 2 の最後に、オプションが示されます。  
  
-  **ネットワークの優先順位**:ライブ マイグレーションのトラフィックが使用可能なネットワークを通過することを許可するか。トラフィックを切り離して、特定のネットワークだけを通過するようにするか。 ライブ マイグレーション トラフィックがネットワーク経由で送信された場合は暗号化されないため、セキュリティのベスト プラクティスとして、信頼できるプライベート ネットワークにトラフィックを切り離すことをお勧めします。 ネットワークの分離は、ネットワークを物理的に分離するか、VLAN などの別の信頼できるネットワーク テクノロジによって実現できます。  
  
## <a name="BKMK_Step1"></a>手順 1:(省略可能) 制約付き委任を構成します。  
ライブ マイグレーションのトラフィックを認証に Kerberos を使用することが決定されました、Domain Administrators グループのメンバーであるアカウントを使用して制約付き委任を構成します。  
  
### <a name="use-the-users-and-computers-snap-in-to-configure-constrained-delegation"></a>ユーザーとコンピューター スナップインを使用して、制約付き委任を構成します。  
  
1.  Active Directory ユーザーとコンピューターのスナップインを開きます。 (サーバー マネージャーで、選択されていない場合に、サーバーを選択して **ツールの** >> **Active Directory ユーザーとコンピューター**)。  
  
2.  ナビゲーション ペインで、 **Active Directory ユーザーとコンピューター**, 、ドメインを選択し、ダブルクリック、 **コンピューター** フォルダーです。  
  
3.  **コンピューター** フォルダーが移行元サーバーのコンピューター アカウントを右クリックし、をクリックして **プロパティ**します。  
  
4.  **プロパティ**, をクリックして、 **委任**  タブをクリックします。  
  
5.  委任 タブで**このコンピューターを指定されたサービスのみへの委任で信頼**し、**任意の認証プロトコルを使用して**します。  
  
6.  **[追加]** をクリックします。  
  
7.  **サービスの追加**, 、クリックして **ユーザーまたはコンピューター**します。  
  
8.  **ユーザーまたはコンピューター**, 、移行先サーバーの名前を入力します。 をクリックして **名前の確認** 、それを確認する **OK**します。  
  
9. **サービスの追加**, で、使用可能なサービスの一覧で、次の操作をクリックして **OK**:  
  
    -   仮想マシンの記憶域を移動するには、 **[CIFS]** を選択します。 これは、機能は、する場合、バーチャル マシンと共に記憶域を移動ものみ仮想マシンの記憶域を移動する場合に必要です。 Hyper-V に対して SMB 記憶域を使用するようにサーバーが構成されている場合、このオプションは既に選択されています。  
  
    -   仮想マシンを移動するには、 **[Microsoft 仮想システム移行サービス]** を選択します。  
  
10. [プロパティ] ダイアログ ボックスの **[委任]** タブで、前の手順で選択したサービスが、移行先コンピューターで委任された資格情報を提供できるサービスとして一覧表示されていることを確認します。 **[OK]** をクリックします。  
  
11. **[Computers]** フォルダーで、移行先サーバーのコンピューター アカウントを選択し、このプロセスを繰り返します。 **[ユーザーまたはコンピューターの選択]** ダイアログ ボックスで、移行元サーバーの名前を指定します。  
  
構成の変更は、次の両方が実行後に、効果を実行します。  
  
  -  変更は、HYPER-V を実行しているサーバーにログに記録されるドメイン コント ローラーにレプリケートされます。  
  -  ドメイン コント ローラーは、新しい Kerberos チケットを発行します。  
  
## <a name="BKMK_Step2"></a>手順 2:ライブ マイグレーションのため元と移行先コンピューターのセットアップします。  
この手順には、認証およびネットワークのオプションの選択が含まれます。 セキュリティのベスト プラクティスとして、前述のように、ライブ マイグレーション トラフィックに使用する特定のネットワークを選択することをお勧めします。 この手順はパフォーマンス オプションを選択する方法も示します。   
  
### <a name="use-hyper-v-manager-to-set-up-the-source-and-destination-computers-for-live-migration"></a>HYPER-V マネージャーを使用して、ライブ マイグレーションのため元とコピー先のコンピューターを設定するには  
  
1.  Hyper-V マネージャーを開きます。 (サーバー マネージャーで、クリックして **ツールの** >>**Hyper V マネージャー**.)  
  
2.  ナビゲーション ウィンドウで、サーバーのいずれかを選択します。 (表示されていない場合は右クリック **HYPER-V マネージャーで**, 、 をクリックして **サーバーへの接続**, サーバー名を入力し、クリックして、 **OK**します。 繰り返してサーバーを追加します。)  
  
3.  **アクション**  ウィンドウで、をクリックして **HYPER-V 設定** >>**ライブ マイグレーション**します。  
  
4.  **[ライブ マイグレーション]** ウィンドウで、**[ライブ マイグレーションでの送受信を有効にする]** をオンにします。  
  
5.  **ライブ マイグレーションの同時**, 、既定値は 2 を使用しない場合は、異なる値を指定します。  
  
6.  ライブ マイグレーション トラフィックを受け入れるために特定のネットワーク接続を使用する場合は、 **[ライブ マイグレーションの受信]** で **[追加]** をクリックし、IP アドレス情報を入力します。 それ以外の場合は、 **[使用可能な任意のネットワークをライブ マイグレーションに使用する]** をクリックします。 **[OK]** をクリックします。  
  
7.  Kerberos とパフォーマンスのオプションを選択するには展開 **ライブ マイグレーション** し、 **高度な機能**です。  
  
    - 制約付き委任を構成した場合 **認証プロトコル**,  **Kerberos**します。  
    - **パフォーマンス オプション**, 、詳細を確認し、各自の環境である場合は、別のオプションを選択します。   
  
8. **[OK]** をクリックします。  
  
9. HYPER-V マネージャーで、その他のサーバーを選択し、手順を繰り返します。  
  
### <a name="use-windows-powershell-to-set-up-the-source-and-destination-computers-for-live-migration"></a>Windows PowerShell を使用して、ライブ マイグレーションのため元とコピー先のコンピューターを設定するには  
  
3 つのコマンドレットは非クラスター化ホストでライブ マイグレーションを構成できます。[Enable-vmmigration](https://technet.microsoft.com/library/hh848544.aspx)、 [Set-vmmigrationnetwork](https://technet.microsoft.com/library/hh848467.aspx)、および[Set-vmhost](https://technet.microsoft.com/library/hh848524.aspx)します。 この例では、3 つすべてを使用しは、次の処理します。   
  - ローカル ホストでのライブ マイグレーションを構成します。  
  - により、特定のネットワークでのみマイグレーション トラフィックを受信  
  - 認証プロトコルとして Kerberos を選択します。   
  
各行は、個々のコマンドを表しています。  
  
```  
PS C:\> Enable-VMMigration  
  
PS C:\> Set-VMMigrationNetwork 192.168.10.1  
  
PS C:\> Set-VMHost -VirtualMachineMigrationAuthenticationType Kerberos  
  
```  
Set-vmhost パフォーマンス オプション (とその他の多くのホストの設定) を選択することもできます。 たとえば、SMB を選択して、CredSSP の既定設定に認証プロトコルを残すにするには、次のように入力します。  
  
```  
PS C:\> Set-VMHost -VirtualMachineMigrationPerformanceOption SMBTransport  
  
```  
  
次の表では、パフォーマンス オプションの機能について説明します。  
  
|オプション|説明|  
|----------|---------------|  
    |TCP/IP|TCP/IP 接続経由で仮想マシンのメモリを移行先サーバーにコピーします。|  
    |圧縮|TCP/IP 接続を介して移行先サーバーにコピーする前に、仮想マシンのメモリの内容を圧縮します。 **注:** これは、**既定**設定します。|  
    |SMB|SMB 3.0 接続を介して移行先サーバーに仮想マシンのメモリをコピーします。<br /><br />SMB ダイレクトが使用元と移行先サーバー上のネットワーク アダプターがあるリモート ダイレクト メモリ アクセス (RDMA) 機能が有効な場合にします。<br />SMB マルチ チャネルは自動的に検出し、適切な SMB マルチ チャネル構成が識別されると、複数の接続を使用します。<br /><br />詳細については、「[SMB ダイレクトを使用してファイル サーバーのパフォーマンスを向上させる](https://technet.microsoft.com/library/jj134210(WS.11).aspx)」を参照してください。|  
      
 ## <a name="next-steps"></a>次のステップ
 
 ホストを設定した後は、ライブ移行を実行する準備ができたらします。 手順については、次を参照してください。 [フェールオーバー クラスタ リングのないライブ マイグレーションを使用して、バーチャル マシンの移動を](../manage/Use-live-migration-without-Failover-Clustering-to-move-a-virtual-machine.md)します。 
    


