---
title: RD Web およびゲートウェイ Web フロントに高可用性を追加する
description: RDS 展開に RD Web およびゲートウェイ サーバーをインストールする手順について説明します。
ms.prod: windows-server
ms.technology: remote-desktop-services
ms.topic: article
author: lizap
ms.author: elizapo
ms.date: 11/08/2016
manager: dongill
ms.openlocfilehash: e98bbda5460311dd379eab6f5a5bde0ec3845d5c
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2020
ms.locfileid: "80860285"
---
# <a name="add-high-availability-to-the-rd-web-and-gateway-web-front"></a>RD Web およびゲートウェイ Web フロントに高可用性を追加する

>適用先:Windows Server (半期チャネル)、Windows Server 2019、Windows Server 2016


リモート デスクトップ Web アクセス (RD Web アクセス) およびリモート デスクトップ ゲートウェイ (RD ゲートウェイ) ファームを展開して、Windows Server リモート デスクトップ サービス (RDS) 展開の可用性を向上し規模を拡大することができます 

次の手順を使用して、既存のリモート デスクトップ サービスの基本的な展開に、RD Web およびゲートウェイ サーバーを追加します。  

## <a name="pre-requisites"></a>前提条件

追加の RD Web および RD ゲートウェイとして機能するようにサーバーを設定します。これは物理サーバーでも VM でもかまいません。 これには、サーバーのドメインへの参加や、リモート管理の有効化が含まれます。

## <a name="step-1-configure-the-new-server-to-be-part-of-the-rds-environment"></a>手順 1:RDS 環境の一部として新しいサーバーを構成する

1. リモート デスクトップ接続クライアントを使用して、Azure portal で RDM サーバーに接続します。
2. サーバー マネージャーに新しい RD Web およびゲートウェイ サーバーを追加します。
    1. サーバー マネージャーを起動し、 **[管理] > [サーバーの追加]** をクリックします。   
    2. [サーバーの追加] ダイアログ ボックスで、 **[検索開始]** をクリックします。   
    3. 新しく作成した RD Web およびゲートウェイ サーバー (たとえば、Contoso-WebGw2) を選択し、 **[OK]** をクリックします。
3. RD Web およびゲートウェイ サーバーを展開に追加する  
    1. サーバー マネージャーを起動します。  
    2. **[リモート デスクトップ サービス] > [概要] > [展開サーバー] > [タスク] > [Add RD Web Access Servers] (RD Web アクセス サーバーの追加)** の順にクリックします。   
    3. 新しく作成したサーバー (たとえば、Contoso-WebGw2) を選択し、 **[次へ]** をクリックします。  
    4. [確認] ページで、 **[必要に応じてリモート コンピューターを再起動する]** を選択し、 **[追加]** をクリックします。  
    5. これらの手順を繰り返して RD ゲートウェイ サーバーを追加しますが、手順 b では **[RD ゲートウェイ サーバー]** を選択します。
4. RD ゲートウェイ サーバーの証明書を再インストールします。
   1. RDMS サーバーのサーバー マネージャーで、 **[リモート デスクトップ サービス] > [概要] > [タスク] > [Edit Deployment Properties] (展開プロパティの編集)** の順にクリックします。  
   2. **[証明書]** を展開します。  
   3. 表まで下へスクロールします。 **[RD Gateway Role Service] (RD ゲートウェイ ロール サービス) > [既存の証明書の選択]** の順にクリックします。  
   4. **[別の証明書を選択する]** をクリックし、続いて証明書の場所を参照します。 たとえば、\Contoso-CB1\Certificates です。 前提条件 (例: ContosoRdGwCert) 中に作成された RD Web およびゲートウェイ サーバーの証明書ファイルを選択し、 **[開く]** をクリックします。  
   5. 証明書のパスワードを入力し、 **[Allow the certificate to be added to the Trusted Root Certificate Authorities certificate store on the destination computers]** (対象のコンピューターの信頼されたルート証明機関の証明書ストアに証明書を追加できるようにする) を選択して、 **[OK]** をクリックします。  
   6. **[適用]** をクリックします。
      > [!NOTE] 
      > サーバー マネージャーかタスク マネージャーのどちらかから、各 RD ゲートウェイ サーバーで実行されている TSGateway サービスを手動で再起動することが必要になる場合があります。
   7. RD Web アクセス ロール サービスには、手順 a から f を繰り返します。

## <a name="step-2-configure-rd-web-and-rd-gateway-properties-on-the-new-server"></a>手順 2:新しいサーバーで RD Web および RD ゲートウェイのプロパティを構成する
1. サーバーを RD ゲートウェイ ファームの一部になるように構成します。
    1.  RDMS サーバー上のサーバー マネージャーで、 **[すべてのサーバー]** をクリックします。 RD ゲートウェイ サーバーの 1 つを右クリックし、 **[リモート デスクトップ接続]** をクリックします。
    2.  ドメイン管理者アカウントを使用して、RD ゲートウェイ サーバーにサインインします。  
    3.  RD ゲートウェイ サーバー上のサーバー マネージャーで、 **[ツール] > [リモート デスクトップ サービス] > [RD ゲートウェイ マネージャー]** の順にクリックします。  
    4.  ナビゲーション ウィンドウで、ローカル コンピューター (例: Contoso-WebGw1) をクリックします。  
    5.  **[RD ゲートウェイ サーバー ファーム メンバーの追加]** をクリックします。  
    6.  **[サーバー ファーム]** タブで、各 RD ゲートウェイ サーバーの名前を入力し、 **[追加]** と **[適用]** をクリックします。  
    7.  各 RD ゲートウェイ サーバーで手順 a から f を繰り返して、互いにファーム内の RD ゲートウェイ サーバーと認識し合うようにします。 DNS 設定が伝播するまで時間がかかることがあるので、警告があっても心配しないでください。
2. サーバーを RD Web アクセス ファームの一部になるように構成します。 次の手順では、両方の RDWeb サイトで同じになるように、検証および暗号化解除コンピューター キーを構成します。
    1.  RDMS サーバー上のサーバー マネージャーで、 **[すべてのサーバー]** をクリックします。 最初の RD Web アクセス サーバー (例: Contoso-WebGw1) を右クリックし、 **[リモート デスクトップ接続]** をクリックします。  
    2.  ドメイン管理者アカウントを使用して、RD Web アクセス サーバーにサインインします。  
    3.  RD Web アクセス サーバー上のサーバー マネージャーで、 **[ツール] > [インターネット インフォメーション サービス (IIS) マネージャー]** の順にクリックします。  
    4.  IIS マネージャーの左側のウィンドウで、 **[サーバー] (例: Contoso-WebGw1) > [サイト] > [既定の Web サイト]** の順にクリックし、 **[RDWeb]** をクリックします。  
    5.  **[コンピューター キー]** を右クリックし、 **[機能を開く]** をクリックします。
    6.  [コンピューター キー] ページの **[アクション]** ウィンドウで、 **[キーの生成]** を選択し、 **[適用]** をクリックします。
    7.  検証キーをコピーします (キーを右クリックして、 **[コピー]** をクリックします)。
    8.  IIS マネージャーの **[既定の Web サイト]** の下で、 **[フィード]** 、 **[FeedLogon]** 、および **[ページ]** を順に選択します。
    9. それぞれで次のように操作します。
        1.  **[コンピューター キー]** を右クリックし、 **[機能を開く]** をクリックします。
        2.  検証キーについては、 **[実行時に自動的に生成する]** をクリアし、手順 g でコピーしたキーを貼り付けます。
    10.  RD 接続ウィンドウをこの RD Web サーバーまで最小化します。  
    11.  2 番目の RD Web アクセス サーバーについて手順 b から e を繰り返し、 **[コンピューター キー]** の機能ビューで終わります。
    12. 検証キーについては、 **[実行時に自動的に生成する]** をクリアし、手順 g でコピーしたキーを貼り付けます。
    13. **[適用]** をクリックします。
    14. **[RDWeb]** 、 **[フィード]** 、 **[FeedLogon]** 、および **[ページ]** の各ページについてこのプロセスを完了します。
    15. RD 接続ウィンドウを 2 番目の RD Web アクセス サーバーまで最小化してから、RD 接続ウィンドウを最初の RD Web アクセス サーバーまで最大化します。  
    16. 手順 g から n を繰り返して、暗号化解除キーをコピーします。
    17. **[RDWeb]** 、 **[フィード]** 、 **[FeedLogon]** 、および **[ページ]** の各ページについて両方の RD Web アクセス サーバーで検証キーと暗号化解除キーが同一であれば、すべての RD 接続ウィンドウからサインアウトします。

## <a name="step-3-configure-load-balancing-for-the-rd-web-and-rd-gateway-servers"></a>手順 3:RD Web および RD ゲートウェイ サーバーの負荷分散を構成する

Azure インフラストラクチャを使用している場合は、外部の Azure ロード バランサーを作成できます。使用していない場合は、個別のハードウェアまたはソフトウェア ロード バランサーを設定できます。 リモート デスクトップ クライアントから RD ゲートウェイを通過してユーザーがワークロードを実行するサーバーへの長期間維持される接続で、トラフィックを均等に分散させるために負荷分散は重要です。

> [!NOTE] 
> RD Web および RD ゲートウェイを実行する以前のサーバーが、既に外部ロード バランサーの背後に設定がされていた場合は、手順 4 へスキップして、既存のバックエンド プールを選択し、新しいサーバーをプールに追加します。

1.  Azure Load Balancer を作成します。  
    1.  Azure portal で **[参照] > [ロード バランサー] > [追加]** の順にクリックします。  
    2.  名前を入力します (例: **WebGwLB**)。  
    3.  **[スキーム]** として **[パブリック]** を選択します。
    4.  **[パブリック IP アドレス]** で **[パブリック IP アドレスの選択]** を選択し、既存のパブリック IP アドレスを選択するか、新しいパブリック IP アドレスを作成します。
    5.  適切な **[サブスクリプション]** 、 **[リソース グループ]** 、および **[場所]** を選択します。
    6.  **[作成]** をクリックします。  
2. どのサーバーが有効化を監視するために[プローブ](https://azure.microsoft.com/documentation/articles/load-balancer-custom-probe-overview/)を作成します。  
    1.  Azure portal で **[参照]**  >  **[ロード バランサー]** を選択し、前のステップで作成したロード バランサーを選択します。
    2.  **[すべての設定]**  >  **[プローブ]**  >  **[追加]** を選択します。  
    3.  プローブの名前を入力します (例: **HTTPS** など)。 **[プロトコル]** として **[TCP]** を選択し、 **[ポート]** に **443** を入力し、 **[OK]** をクリックします。   
3.  HTTPS と UDP の負荷分散規則を作成します。  
    1.  **[設定]** で、 **[負荷分散規則]** をクリックします。  
    2.  **[HTTPS rule]** (HTTPS 規則) には **[追加]** を選択します。  
    3.  HTTPS などの規則の名前を入力し、 **[プロトコル]** には **[TCP]** を選択します。 **[ポート]** と **[バックエンド ポート]** の両方に **443** と入力し、 **[OK]** をクリックします。  
    4.  **[負荷分散規則]** で、 **[UDP rule]** (UDP 規則) に対して **[追加]** をクリックします。  
    5.  規則の名前を入力し (例: **UDP**)、 **[プロトコル]** に対して **[UDP]** を選択します。 **[ポート]** と **[バックエンド ポート]** の両方に **3391** と入力し、 **[OK]** をクリックします。  
4. RD Web および RD ゲートウェイ サーバーのバックエンド プールを作成します。
      1. **[設定]** で、 **[バックエンド アドレス プール] > [追加]** の順にクリックします。   
      2. 名前を入力し (例: **WebGwBackendPool**)、 **[仮想マシンの追加]** をクリックします。  
      3. 可用性セットを選択し (例: WebGwAvSet)、 **[OK]** をクリックします。   
      4. **[仮想マシンの選択]** をクリックし、各仮想マシンを選択してから、 **[選択] > [OK] > [OK]** の順にクリックします。
