---
title: ホスト用の保護されたファブリックとシールドされた VM 計画ガイド
ms.prod: windows-server
ms.topic: article
ms.assetid: 392af37f-a02d-4d40-a25d-384211cbbfdd
manager: dongill
author: nirb-ms
ms.author: nirb
ms.technology: security-guarded-fabric
ms.openlocfilehash: 829d6a3efef082e35c6a4f98e0ba9e4b70c27a93
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2020
ms.locfileid: "80856475"
---
# <a name="guarded-fabric-and-shielded-vm-planning-guide-for-tenants"></a>保護されたファブリックとテナント向けのシールドされた VM 計画ガイド

>適用対象: windows server 2019、Windows Server (半期チャネル)、Windows Server 2016

このトピックでは、コンプライアンスとセキュリティのために仮想マシン (Vm) を保護する VM 所有者について説明します。 Vm がホスティングプロバイダーの保護されたファブリックとプライベートに保護されたファブリックのどちらで実行されているかにかかわらず、VM 所有者は、シールドされた Vm のセキュリティレベルを制御する必要があります。これには、必要に応じて暗号化を解除する機能が含まれます。

シールドされた Vm を使用する場合は、次の3つの点を考慮する必要があります。

- Vm のセキュリティレベル
- 保護に使用される暗号化キー
- シールドデータ—シールドされた Vm の作成に使用される機密情報 

## <a name="security-level-for-the-vms"></a>Vm のセキュリティレベル

シールドされた Vm をデプロイする場合は、次の2つのセキュリティレベルのいずれかを選択する必要があります。

- 意識 
- 暗号化のサポート

シールドされた Vm と暗号化がサポートされている Vm はどちらも、仮想 TPM がアタッチされており、Windows を実行する Vm は BitLocker によって保護されています。 主な違いは、シールドされた Vm はファブリック管理者によるアクセスをブロックするのに対し、暗号化がサポートされている Vm では、ファブリック管理者が通常の VM と同じレベルのアクセスを許可することです。 これらの違いの詳細については、「保護された[ファブリックとシールド](guarded-fabric-and-shielded-vms.md)された vm の概要」を参照してください。 

侵害されたファブリック (侵害された管理者を含む) から VM を保護する場合は、シールドされた**vm**を選択します。 ファブリック管理者とファブリック自体が信頼されていない環境で使用する必要があります。 保存時の暗号化と、ネットワーク上での VM の暗号化 (ライブマイグレーション中など) の両方が必要となるコンプライアンス対応バーを使用する場合は、 **[暗号化がサポートされている vm]** を選択します。

暗号化がサポートされている Vm は、ファブリック管理者が完全に信頼されているが、暗号化は要件を維持する環境に最適です。

保護されたファブリックと同じ Hyper-v ホスト上で、通常の Vm、シールドされた Vm、暗号化がサポートされている Vm を組み合わせて実行できます。 

VM がシールドされているか、暗号化がサポートされているかは、VM の作成時に選択されたシールドデータによって決まります。 VM 所有者は、シールドデータを作成するときにセキュリティレベルを構成します (「[シールドデータ](#shielding-data)」セクションを参照してください)。
この選択を行った後は、仮想化ファブリックに VM が残っている間は変更できないことに注意してください。

## <a name="cryptographic-keys-used-for-shielded-vms"></a>シールドされた Vm に使用される暗号化キー

シールドされた Vm は、暗号化されたディスクとその他の暗号化された要素を使用した仮想化ファブリック攻撃ベクトルから保護されます。暗号化された要素は、

- 所有者キー–これは、VM 所有者によって管理される暗号化キーであり、通常は最後の手段での回復またはトラブルシューティングに使用されます。 VM 所有者は、セキュリティで保護された場所で所有者キーを保持する役割を担います。
- 1つまたは複数のガーディアン (ホストガーディアンキー) –各ガーディアンは、シールドされた Vm の実行を承認する仮想化ファブリックを表します。 多くの場合、企業はプライマリとディザスターリカバリー (DR) の仮想化ファブリックの両方を備えており、シールドされた Vm が両方で実行されることを承認します。 場合によっては、セカンダリ (DR) ファブリックがパブリッククラウドプロバイダーによってホストされることがあります。 保護されたファブリックの秘密キーは、仮想化ファブリックでのみ保持され、その公開キーはダウンロードでき、ガーディアン内に含まれます。 

**所有者キーを作成操作方法には** 所有者キーは、2つの証明書によって表されます。 暗号化用の証明書と署名用の証明書。 独自の PKI インフラストラクチャを使用して、または公開証明機関 (CA) から SSL 証明書を取得することで、これらの2つの証明書を作成できます。 テスト目的の場合は、Windows 10 または Windows Server 2016 以降の任意のコンピューターで自己署名証明書を作成することもできます。

**所有者キーはいくつ必要ですか。** 1つの所有者キーまたは複数の所有者キーを使用できます。 ベストプラクティスでは、同じセキュリティ、信頼、またはリスクレベルを共有する Vm のグループに対して単一の所有者キーを使用することをお勧めします。 ドメインに参加しているすべてのシールドされた Vm に対して1つの所有者キーを共有し、ドメイン管理者がその所有者キーを管理することができます。

**ホストガーディアンに独自のキーを使用できますか。** はい。独自のキーをホスティングプロバイダーに "持ち込む" ことができ、そのキーをシールドされた Vm に使用することができます。 これにより、(ホスティングプロバイダーキーを使用して) 特定のキーを使用できるようになります。また、遵守する必要がある特定のセキュリティまたは規制がある場合にも使用できます。 キーの検疫のために、ホストガーディアンキーは、所有者キーと異なる必要があります。

## <a name="shielding-data"></a>シールドデータ

シールドデータには、シールドまたは暗号化がサポートされている Vm をデプロイするために必要なシークレットが含まれています。 また、通常の Vm をシールドされた Vm に変換するときにも使用されます。

シールドデータは、シールドデータファイルウィザードを使用して作成され、VM 所有者が保護されたファブリックにアップロードする PDK ファイルに格納されます。

シールドされた Vm は、侵害された仮想化ファブリックからの攻撃を防ぐのに役立ちます。そのため、管理者のパスワード、ドメイン参加資格情報、RDP 証明書など、機密性の高い初期化データを、仮想化ファブリック自体または管理者に開示することなく、安全な機構で渡す必要があります。 さらに、シールドデータには次のものが含まれます。

1. セキュリティレベル–シールドまたは暗号化がサポートされています
2. 所有者と、VM を実行できる信頼されたホストガーディアンの一覧
3. 仮想マシンの初期化データ (unattend.xml、RDP 証明書)
4. 仮想化環境で VM を作成するための、信頼された署名済みテンプレートディスクの一覧 

シールドまたは暗号化がサポートされている VM を作成したり、既存の VM を変換したりするときに、機密情報の入力を求められるのではなく、シールドデータを選択するように求められます。

**必要なシールドデータファイルの数を確認できます。** シールドされたすべての VM を作成するには、1つのシールドデータファイルを使用できます。 ただし、特定のシールドされた VM で4つの項目のいずれかが異なる必要がある場合は、追加のシールドデータファイルが必要です。 たとえば、IT 部門用に1つのシールドデータファイルがあり、人事部用に別のシールドデータファイルがある場合があります。これは、最初の管理者パスワードと RDP 証明書が異なっているためです。

シールドされた VM ごとに個別のシールドデータファイルを使用できますが、必ずしも最適な選択ではなく、適切な理由で実行する必要があります。 たとえば、すべてのシールドされた VM に異なる管理者パスワードが必要な場合は、代わりに、 [Microsoft のローカル管理者パスワードソリューション (LAPS) などの](https://www.microsoft.com/download/details.aspx?id=46899)パスワード管理サービスまたはツールを使用することを検討してください。

## <a name="creating-a-shielded-vm-on-a-virtualization-fabric"></a>仮想化ファブリックでのシールドされた VM の作成

仮想化ファブリックにシールドされた VM を作成するには、いくつかのオプションがあります (シールドされた VM と暗号化がサポートされている Vm の両方に関連します)。

1. 環境内にシールドされた VM を作成し、仮想化ファブリックにアップロードする
2. 仮想化ファブリックで署名されたテンプレートから新しいシールドされた VM を作成する
3. 既存の VM をシールドする (既存の VM は第2世代である必要があり、Windows Server 2012 以降を実行している必要があります)

テンプレートから新しい Vm を作成するのは通常の方法です。 ただし、新しいシールドされた VM の作成に使用するテンプレートディスクは仮想化ファブリックに存在するため、悪意のあるファブリック管理者またはファブリックで実行されているマルウェアによって改ざんされていないことを確認するために、追加の対策が必要になります。 この問題は、署名付きテンプレートディスクを使用して解決されます。署名付きテンプレートディスクとそのディスク署名は、信頼された管理者または VM 所有者によって作成されます。 シールドされた VM が作成されると、テンプレートディスクの署名が、指定されたシールドデータファイルに含まれる署名と比較されます。 シールドデータファイルの署名のいずれかがテンプレートディスクの署名と一致する場合、デプロイプロセスは続行されます。 一致するものが見つからない場合は、展開プロセスが中止され、信頼できないテンプレートディスクが原因で VM シークレットが侵害されないようにします。

署名付きテンプレートディスクを使用してシールドされた Vm を作成する場合、次の2つのオプションを使用できます。

1. 仮想化プロバイダーによって提供される既存の署名済みテンプレートディスクを使用します。 この場合、仮想化プロバイダーは署名付きテンプレートディスクを保持します。
2. 署名されたテンプレートディスクを仮想化ファブリックにアップロードします。 VM 所有者は、署名されたテンプレートディスクを維持する役割を担います。 


