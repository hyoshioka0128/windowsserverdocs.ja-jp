---
ms.assetid: 75cc1d24-fa2f-45bd-8f3b-1bbd4a1aead0
title: クラスター対応更新の要件とベスト プラクティス
ms.topic: article
manager: lizross
author: JasonGerend
ms.author: jgerend
ms.date: 08/06/2018
description: クラスター対応更新を使用して、Windows Server を実行しているクラスターに更新プログラムをインストールするための要件。
ms.openlocfilehash: f306ee80873e7082eef9195494f5c509167b596a
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2020
ms.locfileid: "87990823"
---
# <a name="cluster-aware-updating-requirements-and-best-practices"></a>クラスター対応更新の要件とベスト プラクティス

> 適用先:Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このセクションでは、[クラスター対応更新](cluster-aware-updating.md)(CAU) を使用して、Windows Server を実行しているフェールオーバークラスターに更新プログラムを適用するために必要な要件と依存関係について説明します。

> [!NOTE]
> \- **Microsoft.windowsupdateplugin**以外のプラグインを使用する場合は、クラスター環境で更新プログラムを適用する準備ができているかどうかを個別に検証する必要があります。 Microsoft 以外のプラグインを使用している場合、詳細については、 \- \- 発行元にお問い合わせください。 プラグインの詳細につい \- ては、「[プラグイン \- のしくみ](cluster-aware-updating-plug-ins.md)」を参照してください。

## <a name="install-the-failover-clustering-feature-and-the-failover-clustering-tools"></a><a name="BKMK_REQ_CLUS"></a>フェールオーバー クラスタリング機能とフェールオーバー クラスタリング ツールのインストール
CAU を利用するには、フェールオーバー クラスタリング機能とフェールオーバー クラスタリング ツールをインストールする必要があります。 フェールオーバークラスタリングツールには、CAU ツール \(clusterawareupdating.dll、 \) フェールオーバークラスタリングコマンドレット、cau 操作に必要なその他のコンポーネントが含まれています。 フェールオーバー クラスタリング機能のインストール手順については、「 [フェールオーバー クラスタリング機能とツールのインストール](create-failover-cluster.md#install-the-failover-clustering-feature)」をご覧ください。

フェールオーバークラスタリングツールの厳密なインストール要件は、CAU が \( 自己更新モードを使用して、 \- \) またはリモートコンピューターから、フェールオーバークラスター上のクラスター化された役割として更新を調整するかどうかによって異なります。 また、cau の自己更新モードでは、cau \- ツールを使用して、フェールオーバークラスターに cau のクラスター化された役割をインストールする必要があります。

次の表は、2 つの CAU 更新モードの CAU 機能インストール要件をまとめたものです。

|インストールされているコンポーネント|自己 \- 更新モード|リモート \- 更新モード|
|-----------------------|-----------------------|-------------------------|
|フェールオーバー クラスタリング機能|すべてのクラスター ノードで必要|すべてのクラスター ノードで必要|
|フェールオーバー クラスタリング ツール|すべてのクラスター ノードで必要|-リモート \- 更新コンピューターで必要<br />- [Save-caudebugtrace](/powershell/module/clusterawareupdating/Save-CauDebugTrace?view=win10-ps)コマンドレットを実行するすべてのクラスターノードで必要|
|CAU のクラスター化された役割|必須|必要なし|

## <a name="obtain-an-administrator-account"></a>管理者アカウントの取得
CAU 機能を使用するには、次の管理者要件が必要です。

-   CAU ユーザーインターフェイス UI またはクラスター対応更新コマンドレットを使用して更新アクションをプレビューまたは適用するには、 \( \) すべてのクラスターノードに対してローカル管理者権限とアクセス許可を持つドメインアカウントを使用する必要があります。 アカウントにすべてのノードに対する十分な特権がない場合、これらの操作を実行するときに必要な資格情報を提供するために、クラスター対応更新ウィンドウでメッセージが表示されます。 [クラスター対応更新](/powershell/module/clusterawareupdating/?view=win10-ps)のコマンドレットを使用するには、コマンドレットパラメーターとして必要な資格情報を指定します。

-   \-クラスターノードのローカル管理者権限とアクセス許可を持たないアカウントを使用してサインインしたときに、リモート更新モードで cau を使用する場合は、更新コーディネーターコンピューターのローカル管理者アカウントを使用するか、**認証後にクライアントを偽装**することによって、管理者として cau ツールを実行する必要があります。

-   CAU ベストプラクティスアナライザーを実行するには、クラスターノードに対する管理者特権を持つアカウントと、 [test-causetup](/powershell/module/clusterawareupdating/Test-CauSetup?view=win10-ps)コマンドレットの実行に使用するコンピューターのローカル管理者特権を持つアカウントを使用するか、クラスター対応更新ウィンドウを使用してクラスター更新の準備を分析する必要があります。 詳細は、「[クラスター更新の準備のテスト](#BKMK_BPA)」をご覧ください。

## <a name="verify-the-cluster-configuration"></a>クラスター構成の検証
次は、CAU による更新をサポートするためのフェールオーバー クラスターの一般要件です。 ノードのリモート管理の追加構成要件はこのトピックの後半の「[リモート管理のためのノードの構成](#BKMK_NODE_CONFIG)」にあります。

-   クラスターの定足数が確保されるだけ十分な数のクラスター ノードがオンラインになっている必要があります。

-   すべてのクラスター ノードが同じ Active Directory ドメインにある必要があります。

-   クラスター名は DNS を利用し、ネットワーク上で解決する必要があります。

-   CAU がリモート更新モードで使用されている場合 \- 、更新コーディネーターコンピューターはフェールオーバークラスターノードへのネットワーク接続を備えている必要があり、フェールオーバークラスターと同じ Active Directory ドメインに存在する必要があります。

-   すべてのクラスター ノードでクラスター サービスを実行している必要があります。 既定では、このサービスはすべてのクラスター ノードにインストールされ、自動的に開始するように構成されています。

-   \-CAU 更新実行中に PowerShell 更新スクリプトまたは更新後スクリプトを使用するには \- 、すべてのクラスターノードにスクリプトがインストールされていること、または可用性の高いネットワークファイル共有上にあるすべてのノードからアクセスできることを確認してください。 スクリプトがネットワーク ファイル共有に保存される場合、Everyone グループの読み取りアクセスのフォルダーを構成します。

## <a name="configure-the-nodes-for-remote-management"></a><a name="BKMK_NODE_CONFIG"></a>リモート管理のノードの構成
クラスター対応更新を使用するには、クラスターのすべてのノードがリモート管理用に構成されている必要があります。 既定では、リモート管理のためにノードを構成するために実行する必要があるタスクは、[ファイアウォール規則で自動再起動を有効](#BKMK_FW)にすることだけです。

次の表に、環境が既定値から逸脱した場合の完全なリモート管理要件を示します。

これらの要件は、「[フェールオーバー クラスタリング機能とツールのインストール](#BKMK_REQ_CLUS)」のイントール要件と本トピックの前のセクションで説明した一般的なクラスタリング要件に追加されるものです。

|要件|既定の状態|自己 \- 更新モード|リモート \- 更新モード|
|---------------|---|-----------------------|-------------------------|
|[自動再起動を許可するファイアウォール規則の有効化](#BKMK_FW)|無効|ファイアウォールが使用される場合にすべてのクラスター ノードで必要|ファイアウォールが使用される場合にすべてのクラスター ノードで必要|
|[Windows Management Instrumentation の有効化](#BKMK_WMI)|Enabled|すべてのクラスター ノードで必要|すべてのクラスター ノードで必要|
|[Windows PowerShell 3.0 または 4.0 と Windows PowerShell リモート処理の有効化](#BKMK_PS)|Enabled|すべてのクラスター ノードで必要|次を実行するすべてのクラスター ノードで必要:<p>- [Save-caudebugtrace](/powershell/module/clusterawareupdating/Save-CauDebugTrace?view=win10-ps)コマンドレット<br />-更新実行中の PowerShell の \- 更新前 \- スクリプトと更新後スクリプト<br />-クラスター対応更新ウィンドウまたは[Test \- Test-causetup](/powershell/module/clusterawareupdating/Test-CauSetup?view=win10-ps) Windows PowerShell コマンドレットを使用して、クラスター更新の準備のテストを行います。|
|[.NET Framework 4.6 または4.5 のインストール](#BKMK_NET)|Enabled|すべてのクラスター ノードで必要|次を実行するすべてのクラスター ノードで必要:<p>- [Save-caudebugtrace](/powershell/module/clusterawareupdating/Save-CauDebugTrace?view=win10-ps)コマンドレット<br />-更新実行中の PowerShell の \- 更新前 \- スクリプトと更新後スクリプト<br />-クラスター対応更新ウィンドウまたは[Test \- Test-causetup](/powershell/module/clusterawareupdating/Test-CauSetup?view=win10-ps) Windows PowerShell コマンドレットを使用して、クラスター更新の準備のテストを行います。|

### <a name="enable-a-firewall-rule-to-allow-automatic-restarts"></a><a name="BKMK_FW"></a>自動再起動を許可するファイアウォール規則の有効化
更新プログラムのインストール時に再起動を許可するには \( \) 、Windows ファイアウォールまたは Microsoft 以外の \- ファイアウォールがクラスターノードで使用されている場合は、次のトラフィックを許可する各ノードでファイアウォール規則を有効にする必要があります。

-   プロトコル:TCP

-   方向: 受信

-   プログラム: wininit.exe

-   ポート: RPC 動的ポート

-   プロファイル: ドメイン

Windows ファイアウォールをクラスター ノードで使用する場合、クラスター ノードごとに [**リモート シャットダウン**] Windows ファイアウォール規則グループを有効にします。 クラスター対応更新ウィンドウを使用して更新プログラムを適用し、自己更新オプションを構成すると、 \- 各クラスターノードで [**リモートシャットダウン**] Windows ファイアウォール規則グループが自動的に有効になります。

> [!NOTE]
> Windows ファイアウォールのグループ ポリシー設定と競合する場合、**Remote Shutdown** Windows ファイアウォール規則グループは有効になりません。

**リモートシャットダウン**ファイアウォール規則グループは、次の CAU コマンドレットを実行するときに **– EnableFirewallRules**パラメーターを指定することによっても有効になります: [Add-cauclusterrole](/powershell/module/clusterawareupdating/Add-CauClusterRole?view=win10-ps)、 [Invoke/caurun](/powershell/module/clusterawareupdating/Invoke-CauRun?view=win10-ps)、および[SetCauClusterRole](/powershell/module/clusterawareupdating/Set-CauClusterRole?view=win10-ps)。

次の PowerShell の例は、クラスターノードで自動再起動を有効にするための追加の方法を示しています。

```PowerShell
Set-NetFirewallRule -Group "@firewallapi.dll,-36751" -Profile Domain -Enabled true
```

### <a name="enable-windows-management-instrumentation-wmi"></a><a name="BKMK_WMI"></a>Windows Management Instrumentation を有効にする (WMI)
Windows Management Instrumentation WMI を使用して、すべてのクラスターノードがリモート管理用に構成されている必要があり \( \) ます。 この機能は、既定では有効になっています。

リモート管理を手動で有効にするには、次のように操作します。

1.  サービス コンソールで、[**Windows リモート管理**] サービスを開始し、起動タイプを [**自動**] に設定します。

2.  [Set-wsmanquickconfig](/powershell/module/Microsoft.WsMan.Management/Set-WSManQuickConfig?view=powershell-6)コマンドレットを実行するか、管理者特権でのコマンドプロンプトから次のコマンドを実行します。

    ```PowerShell
    winrm quickconfig -q
    ```

WMI リモート処理をサポートするには、Windows ファイアウォールがクラスターノードで使用されている場合、 ** \( \- の \) Windows リモート管理 HTTP**の受信ファイアウォール規則を各ノードで有効にする必要があります。  既定では、この規則は有効になっています。

### <a name="enable-windows-powershell-and-windows-powershell-remoting"></a><a name="BKMK_PS"></a>Windows PowerShell と Windows PowerShell リモート処理の有効化
自己 \- 更新モードとリモート更新モードの特定の CAU 機能を有効にするには \- 、すべてのクラスターノードでリモートコマンドを実行できるように PowerShell をインストールして有効にする必要があります。 既定では、PowerShell がインストールされており、リモート処理が有効になっています。

PowerShell リモート処理を有効にするには、次のいずれかの方法を使用します。

-   [Enable-psremoting](/powershell/module/Microsoft.PowerShell.Core/Enable-PSRemoting)コマンドレットを実行します。

-   \-Windows リモート管理 WinRM のドメインレベルグループポリシー設定を構成し \( \) ます。

PowerShell リモート処理の有効化の詳細については、「[リモート要件につい](/powershell/module/microsoft.powershell.core/about/about_remote_requirements?view=powershell-6)て」を参照してください。

### <a name="install-net-framework-46-or-45"></a><a name="BKMK_NET"></a>.NET Framework 4.6 または4.5 のインストール
自己 \- 更新モードとリモート更新モードの特定の CAU 機能を有効にするには \- 、すべてのクラスターノードに .net Framework 4.6 または .NET Framework 4.5 (Windows Server 2012 R2 上) がインストールされている必要があります。 既定では、NET Framework がインストールされています。

まだインストールされていない場合に PowerShell を使用して .NET Framework 4.6 (または 4.5) をインストールするには、次のコマンドを使用します。

```PowerShell
Install-WindowsFeature -Name NET-Framework-45-Core
```

## <a name="best-practices-recommendations-for-using-cluster-aware-updating"></a><a name="BKMK_BEST_PRAC"></a>クラスター対応更新を使用するためのベストプラクティスの推奨事項

### <a name="recommendations-for-applying-microsoft-updates"></a><a name="BKMK_BP_WUA"></a>マイクロソフト更新適用の推奨事項

CAU を使用してクラスター上の既定の**microsoft.windowsupdateplugin**プラグインを使用して更新プログラムを適用する場合は \- 、他の方法を使用して microsoft からのソフトウェア更新プログラムをクラスターノードにインストールすることを停止することをお勧めします。

> [!CAUTION]
> 個々のノードを自動的に更新するメソッドを使用して CAU を固定すると、 \( \) サービスの中断や予定外のダウンタイムなど、予期しない結果が発生する可能性があります。

次のガイドラインに従うことをお勧めします。

-   最適な結果を得るために、たとえば、コントロール パネルの自動更新設定やグループ ポリシーを利用して構成される設定を利用し、クラスター ノードの自動更新設定を無効にすることをお勧めします。

    > [!CAUTION]
    > クラスター ノードの更新の自動インストールが CAU による更新のインストールに干渉し、CAU にエラーが発生することがあります。

    必要であれば、次の自動更新設定が CAU と共存します。管理者が更新インストールのタイミングを制御できるためです。

    -   更新のダウンロード前に通知するための設定とインストール前に通知するための設定

    -   更新を自動的にダウンロードするための設定とインストール前に通知するための設定

    ただし、自動更新が CAU 更新実行と同時に更新をダウンロードする場合、更新実行の完了に時間がかかることがあります。

-   更新 \( \) プログラムを、固定され \( た時間スケジュールで自動的にクラスターノードに適用するように、Windows Server Update Services WSUS などの更新システムを構成しないでください \) 。

-   WSUS サーバー、Windows 更新、マイクロソフト更新など、同じ更新元を利用するように、すべてのクラスター ノードを等しく構成する必要があります。

-   構成管理システムを使用してネットワーク上のコンピューターにソフトウェア更新を適用する場合は、必要な更新または自動更新からクラスター ノードを除外してください。 構成管理システムの例としては、Microsoft エンドポイント Configuration Manager、Microsoft System Center Virtual Machine Manager 2008 などがあります。

-   たとえば、内部のソフトウェア配布サーバー \( で、 \) 更新プログラムを格納して展開するために WSUS サーバーを使用する場合は、それらのサーバーがクラスターノードの承認済み更新プログラムを正しく識別するようにしてください。

#### <a name="apply-microsoft-updates-in-branch-office-scenarios"></a><a name="BKMK_PROXY"></a>支店シナリオのマイクロソフト更新適用
特定の支店シナリオで Microsoft Update または Windows Update からクラスター ノードにマイクロソフト更新をダウンロードするには、ノードごとに、ローカル システム アカウントのプロキシ設定を構成する必要があります。 たとえば、支店のクラスターがローカル プロキシ サーバーを利用し、Microsoft Update または Windows Update にアクセスして更新をダウンロードする場合にこの作業が必要になります。

必要に応じて、各ノードで WinHTTP プロキシ設定を構成してローカルプロキシサーバーを指定し、ローカルアドレス例外 \( (ローカルアドレスのバイパスリスト) を構成し \) ます。 その場合、管理者特権のコマンド プロンプトでクラスター ノードごとに次のコマンドを実行できます。

```
netsh winhttp set proxy <ProxyServerFQDN >:<port> "<local>"
```

ここで <*Proxyserverfqdn*> はプロキシサーバーの完全修飾ドメイン名、<*ポート*> は通信に使用するポート (通常はポート 443) です。

たとえば、プロキシサーバー *MyProxy.CONTOSO.com*を指定するローカルシステムアカウントの WinHTTP プロキシ設定を構成するには、ポート443とローカルアドレス例外を指定し、次のコマンドを入力します。

```
netsh winhttp set proxy MyProxy.CONTOSO.com:443 "<local>"
```

### <a name="recommendations-for-using-the-microsofthotfixplugin"></a><a name="BKMK_BP_HF"></a>Microsoft.HotfixPlugin を使用する場合の推奨事項

-   修正プログラムのルート フォルダーと構成ファイルにアクセス許可を設定し、これらのファイルの保管に使用されるコンピューターに対してローカル管理者にのみ書き込みアクセスを許可することをお勧めします。 それにより、無許可のユーザーがこれらのファイルを改ざんし、修正プログラムの適用時にフェールオーバー クラスターの機能を損なうような事態を防止できます。

-   修正プログラムルートフォルダーへのアクセスに使用されるサーバーメッセージブロック smb 接続のデータ整合性を確保するために、smb \( \) 共有フォルダーで smb 暗号化を構成できる場合は、smb 共有フォルダーに構成する必要があります。 **Microsoft.HotfixPlugin** を利用するには、SMB 接続のデータ完全性を維持するように SMB 署名または SMB 暗号化を構成する必要があります。

    詳細については、「[修正プログラムルートフォルダーと修正プログラムの構成ファイルへのアクセスを制限する](cluster-aware-updating-plug-ins.md#BKMK_ACL)」を参照してください。

### <a name="additional-recommendations"></a>その他の推奨事項

-   同じ時間にスケジュールされる可能性がある CAU 更新実行を邪魔しないように、スケジュールされている保守管理時間帯にクラスター名オブジェクトと仮想コンピューター オブジェクトにパスワード変更をスケジュールしないでください。

-   承認されていない \- ユーザーがこれらの \- ファイルを改ざんしないように、ネットワーク共有フォルダーに保存される更新前スクリプトと更新後スクリプトに適切なアクセス許可を設定する必要があります。

-   自己更新モードで CAU を構成するには \- 、cau のクラスター化された役割の仮想コンピューターオブジェクトの \( VCO を \) Active Directory で作成する必要があります。 CAU は、フェールオーバー クラスターに十分なアクセス許可があれば、CAU のクラスター化された役割が追加された時点でこのオブジェクトを自動的に作成できます。 ただし、一部の組織ではセキュリティ ポリシーにより、Active Directory にオブジェクトを事前登録する必要があります。 この手順については、「 [クラスター化された役割のアカウントを事前登録するための手順](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731002\(v=ws.10\)#steps-for-prestaging-the-cluster-name-account)」をご覧ください。

-   IT 組織内で同様に更新する必要があるフェールオーバー クラスター全体に更新実行設定を保存し、再利用するために、更新実行プロファイルを作成できます。 また、更新モードにもよりますが、すべてのリモート Update Coordinator コンピューターまたはフェールオーバー クラスターにアクセスできるファイル共有に更新実行プロファイルを保存し、管理できます。 詳細については、「 [CAU の詳細オプションと更新実行プロファイル](cluster-aware-updating-options.md)」を参照してください。

## <a name="test-cluster-updating-readiness"></a><a name="BKMK_BPA"></a>クラスター更新の準備のテスト
CAU ベストプラクティスアナライザー BPA モデルを実行して、 \( \) フェールオーバークラスターとネットワーク環境が、cau によってソフトウェア更新プログラムを適用するために必要な多くの要件を満たしているかどうかをテストできます。 多くのテストでは、既定のプラグインである Microsoft.windowsupdateplugin を使用して、Microsoft 更新プログラムを適用する準備が環境にあるかどうかを確認します \- 。 **Microsoft.WindowsUpdatePlugin**

> [!NOTE]
> 場合によっては、クラスター環境で \- **microsoft.windowsupdateplugin**以外のプラグインを使用してソフトウェア更新プログラムを適用する準備ができているかどうかを個別に検証する必要があります。 \-ハードウェアの製造元から提供されているものなど、Microsoft 以外のプラグインを使用している場合は、 \- 発行元に問い合わせてください。

BPA は次の 2 通りの方法で実行できます。

1.  CAU コンソールで [**クラスター更新の準備の分析**] を選択します。 BPA が準備テストを完了すると、テストレポートが表示されます。 クラスター ノードで問題が検出された場合、是正措置をとれるように、具体的な問題と問題が発生したノードが特定されます。 テストの完了には数分かかることがあります。

2.  [Test-causetup](/powershell/module/clusterawareupdating/Test-CauSetup)コマンドレットを実行します。 このコマンドレットは、Windows PowerShell のフェールオーバークラスタリングモジュール (フェールオーバークラスタリングツールの一部) がインストールされているローカルまたはリモートコンピューターで実行できます。 フェールオーバー クラスターのノードでもコマンドレットを実行できます。

> [!NOTE]
> -   クラスターノードに対する管理者特権を持つアカウントと、 **Test \- test-causetup**コマンドレットの実行に使用するコンピューターのローカル管理者特権を持つアカウントを使用するか、クラスター対応更新ウィンドウを使用してクラスター更新の準備を分析する必要があります。 クラスター対応更新ウィンドウを使用してテストを実行するには、必要な資格情報を使用してコンピューターにログオンしている必要があります。
> -   このテストでは、ソフトウェア更新をプレビューし、適用するために使用される CAU ツールは、クラスター更新の準備をテストするために使用されるコンピューターと同じコンピューターから、同じユーザー資格情報で実行するものと想定しています。

> [!IMPORTANT]
> 次の状況でクラスター更新の準備をテストすることをお勧めします。
>
> -   初めて CAU を利用してソフトウェア更新を適用する前。
> -   クラスターにノードを追加したか、クラスターの検証ウィザードの実行を必要とする他のハードウェア変更をクラスターで実行した後。
> -   更新プログラムのソースを変更した後、または更新プログラムの設定を変更した場合、または \( \) ノードの更新プログラムの適用に影響する可能性がある CAU 以外の構成を変更した場合。

### <a name="tests-for-cluster-updating-readiness"></a>クラスター更新の準備のテスト
次の表は、クラスター更新の準備のテスト、一部の共通問題、解消手順についてまとめたものです。


|                                                      テスト                                                      |                                                                                                                                               考えられる問題と影響                                                                                                                                               |                                                                                                                                                                                         解決手順                                                                                                                                                                                         |
|----------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                     フェールオーバー クラスターを利用できる必要があります                                     |                                                                                       フェールオーバー クラスター名を解決できません。または、1 つまたは複数のノードにアクセスできません。 BPA がクラスターの準備テストを実行できません。                                                                                        |                                                                   -BPA 実行中に指定されたクラスターの名前のスペルを確認します。<br />-クラスターのすべてのノードがオンラインで実行されていることを確認します。<br />-構成の検証ウィザードがフェールオーバークラスターで正常に実行できることを確認します。                                                                    |
|                    WMI を利用し、フェールオーバー クラスター ノードのリモート管理を有効にする必要があります                    |                                                Windows Management Instrumentation WMI を使用したリモート管理のために1つ以上のフェールオーバークラスターノードが有効になっていません \( \) 。 ノードのリモート管理が構成されていない場合、CAU はクラスター ノードを更新できません。                                                 |                                                                                                  WMI を利用し、すべてのフェールオーバー クラスター ノードのリモート管理を有効にします。 詳しくは、本トピックの「[ノードのリモート管理の構成](#BKMK_NODE_CONFIG)」をご覧ください。                                                                                                   |
|                      各フェールオーバークラスターノードで PowerShell リモート処理を有効にする必要があります。                       |                                                           PowerShell がインストールされていないか、1つまたは複数のフェールオーバークラスターノードでリモート処理が有効になっていません。 CAU を自己更新モード用に構成 \- したり、リモート更新モードで特定の機能を使用したりすることはできません \- 。                                                            |                                                                                             PowerShell がすべてのクラスターノードにインストールされ、リモート処理が有効になっていることを確認してください。<p>詳しくは、本トピックの「[ノードのリモート管理の構成](#BKMK_NODE_CONFIG)」をご覧ください。                                                                                             |
|                                            フェールオーバー クラスター バージョン                                            |                                                                            フェールオーバークラスターの1つまたは複数のノードで、Windows Server 2016、Windows Server 2012 R2、または Windows Server 2012 が実行されていません。 CAU がフェールオーバー クラスターを更新できません。                                                                             |                                                                   BPA 実行中に指定されたフェールオーバークラスターが、Windows Server 2016、Windows Server 2012 R2、または Windows Server 2012 を実行していることを確認します。<p>詳しくは、本トピックの「[クラスター構成の検証](#BKMK_REQ_CLUS)」をご覧ください。                                                                   |
| 必須バージョンの .NET Framework と Windows PowerShell をすべてのフェールオーバー クラスター ノードにインストールする必要があります |                                                                                              .NET Framework 4.6、4.5、または Windows PowerShell が1つ以上のクラスターノードにインストールされていません。 一部の CAU 機能が動作しないことがあります。                                                                                              |                                                                            必要に応じて、すべてのクラスターノードに .NET Framework 4.6、4.5、および Windows PowerShell がインストールされていることを確認します。<p>詳しくは、本トピックの「[ノードのリモート管理の構成](#BKMK_NODE_CONFIG)」をご覧ください。                                                                             |
|                           クラスター サービスがすべてのクラスター ノードで実行されている必要があります                           |                                                                                                            クラスター サービスが 1 つまたは複数のノードで実行されていません。 CAU がフェールオーバー クラスターを更新できません。                                                                                                             |                        - \( \) クラスター内のすべてのノードでクラスターサービス clussvc が開始されており、自動的に開始するように構成されていることを確認します。<br />-構成の検証ウィザードがフェールオーバークラスターで正常に実行できることを確認します。<p>詳しくは、本トピックの「[クラスター構成の検証](#BKMK_REQ_CLUS)」をご覧ください。                         |
|     フェールオーバー クラスター ノードに更新を自動インストールするように自動更新を構成してはなりません     |                                           少なくとも 1 つのクラスター ノードで、そのノードにマイクロソフト更新を自動インストールするように自動更新が構成されています。 CAU とその他の更新方法を組み合わせると、予期しないダウンタイムまたは予測できない結果を招くことがあります。                                            |                                                     1 つまたは複数のクラスター ノードで Windows Update 機能の自動更新が構成されている場合、更新を自動インストールするように自動更新が構成されていないことを確認します。<p>詳しくは、「[マイクロソフト更新の推奨事項](#BKMK_BP_WUA)」をご覧ください。                                                     |
|                          フェールオーバー クラスター ノードは同じ更新元を使用する必要があります                          |                                                    1 つまたは複数のクラスター ノードで、残りのノードとは異なる更新元がマイクロソフト更新に使用されるように構成されています。 CAU では、クラスター ノードに更新が等しく適用されない可能性があります。                                                    |                                                                        WSUS サーバー、Windows Update、Microsoft Update など、同じ更新元を使用するようにすべてのクラスター ノードが構成されていることを確認します。<p>詳しくは、「[マイクロソフト更新の推奨事項](#BKMK_BP_WUA)」をご覧ください。                                                                         |
|       リモート シャットダウンを許可するファイアウォール規則をフェールオーバー クラスターの各ノードで有効にする必要があります       |                 1 つまたは複数のフェールオーバー クラスター ノードで、リモート シャットダウンを許可するファイアウォール規則が有効になっていないか、グループ ポリシー設定によりこの規則の有効化が阻止されています。 ノードの自動再起動を要求する更新を適用する更新実行が適切に完了しないことがあります。                  |                                                                    クラスターノードで Windows ファイアウォールまたは Microsoft 以外の \- ファイアウォールが使用されている場合は、リモートシャットダウンを許可するファイアウォール規則を構成します。<p>詳しくは、本トピックの「[自動再起動を許可するファイアウォール規則の有効化](#BKMK_FW)」をご覧ください。                                                                    |
|          各フェールオーバー クラスター ノードのプロキシ サーバー設定をローカル プロキシ サーバーに設定する必要があります          |                             1 つまたは複数のフェールオーバー クラスター ノードのプロキシ サーバー構成が正しくありません。<p>ローカル プロキシ サーバーが使用されている場合、クラスターが Microsoft Update または Windows Update にアクセスできるように、各ノードのプロキシ サーバー設定を適切に構成する必要があります。                              |                                            必要に応じて各クラスター ノードの WinHTTP プロキシ設定がローカル プロキシ サーバーに設定されていることを確認します。 環境内でプロキシ サーバーが使用されていない場合、この警告は無視できます。<p>詳しくは、本トピックの「[支店シナリオの更新適用](#BKMK_PROXY)」をご覧ください。                                            |
|        自己更新モードを有効にするには、CAU のクラスター化された役割をフェールオーバークラスターにインストールする必要があります \-        |                                                                                                   CAU のクラスター化された役割がこのフェールオーバー クラスターにインストールされていません。 このロールは、クラスターの自己更新に必要です \- 。                                                                                                   |      自己更新モードで CAU を使用するには \- 、次のいずれかの方法で、フェールオーバークラスターに cau のクラスター化された役割を追加します。<p>- [Add-cauclusterrole](/powershell/module/clusterawareupdating/Add-CauClusterRole) PowerShell コマンドレットを実行します。<br />-クラスター対応更新ウィンドウで、[**クラスターの自己 \- 更新オプションの構成**] アクションを選択します。      |
|         自己更新モードを有効にするには、フェールオーバークラスターで CAU のクラスター化された役割を有効にする必要があります \-         | CAU のクラスター化された役割が無効になっています。 たとえば、CAU のクラスター化された役割がインストールされていないか、 [Disable \- add-cauclusterrole](/powershell/module/clusterawareupdating/Disable-CauClusterRole) PowerShell コマンドレットを使用して無効になっています。 このロールは、クラスターの自己更新に必要です \- 。 | 自己更新モードで CAU を使用するには \- 、次のいずれかの方法で、このフェールオーバークラスターで cau のクラスター化された役割を有効にします。<p>- [Add-cauclusterrole](/powershell/module/clusterawareupdating/Enable-CauClusterRole) PowerShell コマンドレットを実行します。<br />-クラスター対応更新ウィンドウで、[**クラスターの自己 \- 更新オプションの構成**] アクションを選択します。 |
|      自己更新モード用に構成された CAU プラグインは、 \- \- すべてのフェールオーバークラスターノードに登録する必要があります      |                                                              このフェールオーバークラスターの1つまたは複数のノードでの CAU のクラスター化された役割は、 \- 自己更新オプションで構成された cau プラグインモジュールにアクセスできません \- 。 自己 \- 更新の実行が失敗する可能性があります。                                                              |           - \- Cau プラグインを提供する製品のインストール手順に従って、構成済みの cau プラグインがすべてのクラスターノードにインストールされていることを確認し \- ます。<br />- [Register \- register-cauplugin](/powershell/module/clusterawareupdating/Register-CauPlugin) PowerShell コマンドレットを実行して、 \- 必要なクラスターノードにプラグインを登録します。           |
|                すべてのフェールオーバークラスターノードには、同じ登録済み CAU プラグインのセットが含まれている必要があります \-                 |                                                                             \- \- 更新実行で使用するように構成されているプラグインが、すべてのクラスターノードで使用できないプラグインに変更された場合、自己更新実行は失敗する可能性があります。                                                                              |           - \- Cau プラグインを提供する製品のインストール手順に従って、構成済みの cau プラグインがすべてのクラスターノードにインストールされていることを確認し \- ます。<br />- [Register \- register-cauplugin](/powershell/module/clusterawareupdating/Register-CauPlugin) PowerShell コマンドレットを実行して、 \- 必要なクラスターノードにプラグインを登録します。           |
|                               構成された更新実行オプションを有効にする必要があります                                |                                                                          \-このフェールオーバークラスター用に構成されている自己更新スケジュールと更新実行オプションが不完全であるか、無効です。 自己 \- 更新の実行が失敗する可能性があります。                                                                           |                                                            有効な自己 \- 更新スケジュールと更新実行オプションのセットを構成します。 たとえば、 [Set \- add-cauclusterrole](/powershell/module/clusterawareupdating/Set-CauClusterRole) PowerShell コマンドレットを使用して、CAU のクラスター化された役割を構成できます。                                                            |
|                  少なくとも 2 つのフェールオーバー クラスター ノードが CAU のクラスター化された役割の実行可能な所有者になる必要があります                  |                                                                                        \-CAU のクラスター化された役割に移動先として使用可能な所有者ノードがないため、自己更新モードで起動した更新実行は失敗します。                                                                                         |                                                                                                                フェールオーバー クラスタリング ツールを使用し、すべてのクラスター ノードが CAU のクラスター化された役割の実行可能な所有者として構成されていることを確認します。 これは既定の構成です。                                                                                                                |
|                  すべてのフェールオーバー クラスター ノードは Windows PowerShell スクリプトにアクセスできる必要があります                  |                                                                        CAU のクラスター化された役割のすべての実行可能な所有者ノードが、構成済みの Windows PowerShell 事前 \- 更新スクリプトと更新後スクリプトにアクセスできるわけではありません \- 。 自己 \- 更新実行は失敗します。                                                                        |                                                                                                                    CAU のクラスター化された役割のすべての実行可能な所有者ノードに、構成済みの PowerShell 事前 \- 更新スクリプトと更新後スクリプトにアクセスするためのアクセス許可があることを確認し \- ます。                                                                                                                     |
|                   すべてのフェールオーバー クラスター ノードで同じ Windows PowerShell スクリプトを使用する必要があります                   |                                                     CAU のクラスター化された役割のすべての実行可能な所有者ノードが、指定された Windows PowerShell 事前 \- 更新スクリプトと更新後スクリプトの同じコピーを使用しているわけではありません \- 。 自己 \- 更新の実行が失敗したり、予期しない動作が表示されたりすることがあります。                                                     |                                                                                                                                   CAU のクラスター化された役割のすべての実行可能な所有者ノードが、同じ PowerShell プリ \- アップデートスクリプトと更新後スクリプトを使用していることを確認し \- ます。                                                                                                                                   |
|         更新実行で、WarnAfter 設定には StopAfter 設定より小さい値を指定する必要があります         |                                                                           指定されている CAU 更新実行タイムアウト値は警告タイムアウトを無効にします。 警告イベント ログが生成される前に更新実行が取り消される可能性があります。                                                                            |                                                                                                                                      更新実行オプションで、[**WarnAfter**] オプションの値に [**StopAfter**] オプションの値よりも小さい値を指定します。                                                                                                                                       |

## <a name="additional-references"></a>その他の参照情報

-   [クラスター対応更新の概要](cluster-aware-updating.md)