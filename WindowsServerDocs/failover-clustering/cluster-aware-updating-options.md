---
ms.assetid: 2f4b6641-0ec2-4b1c-85fb-a1f1d16685c8
title: クラスター対応更新の詳細オプションと更新実行プロファイル
description: クラスター対応更新 (CAU) の詳細オプションを構成し、実行プロファイルを更新する方法
ms.topic: article
ms.prod: windows-server
manager: lizross
ms.author: jgerend
author: JasonGerend
ms.date: 08/06/2018
ms.openlocfilehash: b6a5b51b0942685334c79d9523fffa5ba4eabc5f
ms.sourcegitcommit: ab64dc83fca28039416c26226815502d0193500c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/01/2020
ms.locfileid: "82720599"
---
# <a name="cluster-aware-updating-advanced-options-and-updating-run-profiles"></a>クラスター対応更新の詳細オプションと更新実行プロファイル

> 適用対象: Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012。

このトピックでは、[クラスター対応更新](cluster-aware-updating.md)(CAU) 更新実行用に構成できる更新実行オプションについて説明します。 これらの詳細オプションは、CAU UI または CAU Windows PowerShell コマンドレットを使用して更新プログラムを適用するか、自己更新オプションを構成するときに構成できます。

構成設定のほとんどは、XML ファイル (更新実行プロファイル) として保存し、以降の更新実行に再利用することができます。 CAU の更新実行オプションの既定値は、多くのクラスター環境でも使用できます。

各更新実行に指定できる追加のオプションおよび更新実行プロファイルについては、このトピックの以下のセクションを参照してください。

更新実行を要求するときに指定するオプション更新実行プロファイルで設定できる更新実行プロファイルのオプションを使用します。

次の表に、CAU の更新実行プロファイルで設定できるオプションを示します。 

> [!NOTE] 
> Preアップデートスクリプトまたは Postアップデートスクリプトオプションを設定するには、Windows PowerShell と .NET Framework 4.6 または4.5 がインストールされており、クラスター内の各ノードで PowerShell リモート処理が有効になっていることを確認します。 詳細については、「[クラスター対応更新の要件とベストプラクティス](cluster-aware-updating-requirements.md)」の「リモート管理のノードの構成」を参照してください。


|オプション|既定値|詳細|  
|------------|-------------------|-------------|  
|**StopAfter**|時間無制限|更新実行が完了しなかった場合に、更新実行を停止するまでの時間 (分単位)。 **注:** 更新前または更新後の PowerShell スクリプトを指定する場合は、スクリプトを実行して更新を実行するプロセス全体が、 **Stopafter**の制限時間内に完了する必要があります。|  
|**WarnAfter**|既定では、警告は表示されません|更新実行 (構成されている場合は更新前スクリプトと更新後スクリプトを含む) が完了しなかった場合に警告が表示されるまでの時間 (分単位)。|  
|**MaxRetriesPerNode**|3|ノードごとに更新プロセス (構成されている場合は更新前スクリプトと更新後スクリプトを含む) を再試行する最大回数。 最大値は 64 です。|  
|**MaxFailedNodes**|ほとんどのクラスターでは、クラスター ノードの数の約 3 分の 1 に相当する整数|ノードの障害またはクラスター サービスの実行停止を原因とした更新の失敗を許容できるノードの最大数。 この数を超えるノードで失敗すると、更新実行は停止します。<p>有効な値の範囲は、0 からクラスター ノードの数より 1 少ない数までです。|  
|**RequireAllNodesOnline**|なし|更新開始前にすべてのノードがオンラインで、到達可能である必要があることを指定します。|  
|**RebootTimeoutMinutes**|15|ノードの再起動が必要な場合に CAU がノードを再起動し、自動開始サービスをすべて開始するまでの時間 (分単位)。 この時間内に再起動プロセスが完了しない場合、そのノードでの更新実行は失敗としてマークされます。|  
|**PreUpdateScript**|なし|更新を開始する前、およびノードがメンテナンスモードになる前に、各ノードで実行する PowerShell スクリプトのパスとファイル名。 ファイル名拡張子は**ps1**にする必要があり、パスとファイル名の合計の長さは260文字を超えないようにする必要があります。 すべてのクラスター ノードからスクリプトに常にアクセスできるように、クラスター記憶域のディスク上か、可用性の高いネットワーク ファイル共有にスクリプトを配置することをお勧めします。 スクリプトをネットワーク ファイル共有に配置した場合には、承認を受けていないユーザーによってファイルが改ざんされることのないよう、Everyone グループに対してはそのファイル共有の読み取りだけを許可し、書き込みアクセスは制限するようにファイル共有の構成を変更する必要があります。<p> 更新前スクリプトを指定する場合は、時間制限などの設定 (たとえば、**StopAfter**) を、スクリプトが正常に実行できるように構成しておいてください。 これらの制限は、更新プログラムのインストール プロセスだけでなく、スクリプトの実行と更新プログラムのインストールのプロセス全体に適用されます。|  
|**PostUpdateScript**|なし|更新が完了した後に実行する PowerShell スクリプトのパスとファイル名 (ノードがメンテナンスモードを終了した後)。 ファイル名拡張子は**ps1**にする必要があり、パスとファイル名の合計の長さは260文字を超えないようにする必要があります。 すべてのクラスター ノードからスクリプトに常にアクセスできるように、クラスター記憶域のディスク上か、可用性の高いネットワーク ファイル共有にスクリプトを配置することをお勧めします。 スクリプトをネットワーク ファイル共有に配置した場合には、承認を受けていないユーザーによってファイルが改ざんされることのないよう、Everyone グループに対してはそのファイル共有の読み取りだけを許可し、書き込みアクセスは制限するようにファイル共有の構成を変更する必要があります。<p> 更新後スクリプトを指定する場合は、時間制限などの設定 (たとえば、**StopAfter**) を、スクリプトが正常に実行できるように構成しておいてください。 これらの制限は、更新プログラムのインストール プロセスだけでなく、スクリプトの実行と更新プログラムのインストールのプロセス全体に適用されます。|  
|**ConfigurationName**|この設定はスクリプトを実行した場合にのみ影響します。<p> 更新前スクリプトまたは更新後スクリプトを指定しても、 **ConfigurationName**を指定しなかった場合は、Powershell (Microsoft powershell) の既定のセッション構成が使用されます。|**プレアップデート**スクリプトと**postアップデート**スクリプトで指定されたスクリプトが実行されるセッションを定義する PowerShell セッション構成を指定します。また、実行可能なコマンドを制限できます。|  
|**CauPluginName**|**Microsoft.WindowsUpdatePlugin**|クラスター対応更新を構成して更新プログラムのプレビューや更新実行の実行に使用するプラグイン。 詳細については、「[クラスター対応更新プラグインのしくみ](cluster-aware-updating-plug-ins.md)」を参照してください。|  
|**CauPluginArguments**|なし|使用する更新プラグインの*名前=値*の組 (引数)。次に例を示します。<p>**Domain = Domain. ローカル**<p>これらの*名前=値*の組は、**CauPluginName** で指定するプラグインにとって必ず意味のある内容にします。<p>CAU UI を使用して引数を指定するには、*名前*を入力して Tab キーを押し、対応する*値*を入力します。 次の引数を指定するには、もう一度 Tab キーを押します。 *名前*と*値*は自動的に等号 (=) で区切られます。 複数の組は、セミコロンで自動的に区切られます。<p>既定の**microsoft.windowsupdateplugin**プラグインの場合、引数は必要ありません。 ただし、オプション引数を指定することはできます。たとえば、プラグインによって適用される更新プログラムのセットを絞り込むために、Windows Update エージェントの標準のクエリ文字列を指定する場合が考えられます。 *名前*の場合は、 **QueryString**を使用し、*値*には完全なクエリを引用符で囲みます。<p> 詳細については、「[クラスター対応更新プラグインのしくみ](cluster-aware-updating-plug-ins.md)」を参照してください。|  
  
##  <a name="options-that-you-specify-when-you-request-an-updating-run"></a><a name="BKMK_runtime"></a>更新実行の要求時に指定するオプション  
 次の表に、更新実行の要求時に指定できるオプション (更新実行プロファイルのオプション以外のオプション) を示します。 更新実行プロファイルで設定できるオプションについては、前の表を参照してください。  
  
|オプション|既定値|詳細|  
|------------|-------------------|-------------|  
|**ClusterName**|なし <br>**注:** このオプションは、CAU UI がフェールオーバークラスターノードで実行されていない場合、または CAU UI の実行場所とは別のフェールオーバークラスターを参照する場合にのみ設定する必要があります。|更新実行を実行するクラスターの NetBIOS 名。|  
|**証明**|現在のアカウントの資格情報|更新実行が実行されるターゲット クラスターの管理資格情報。 クラスターに対する管理者権限とアクセス許可を持つアカウントから CAU UI を開始する (または、CAU PowerShell コマンドレットを使用している場合は PowerShell セッションを開く) 場合は、必要な資格情報を既に持っている可能性があります。|  
|**NodeOrder**|既定では、CAU は、クラスター役割の所有数が最も少ないノードから始まり、次に、2 番目に所有数が少ないノードへと順番に処理を進めます。|更新される順序に並んだクラスター ノードの名前 (可能な場合)。|  
  
##  <a name="use-updating-run-profiles"></a><a name="BKMK_profile"></a>更新実行プロファイルを使用する  
 更新実行はそれぞれ、特定の更新実行プロファイルに関連付けることができます。 既定の更新実行プロファイルは、 *%windir%\cluster*フォルダーに格納されます。 リモート更新モードで CAU UI を使用している場合は、更新プログラムの適用時に更新実行プロファイルを指定するか、既定の更新実行プロファイルを使用することができます。 自己更新モードで CAU を使用している場合は、自己更新オプションを構成するときに、指定した更新実行プロファイルから設定をインポートできます。 いずれの場合も、必要に応じて更新実行オプションに表示されている値をオーバーライドすることができます。 必要があれば、更新実行オプションを更新実行プロファイルとして保存しておくこともできます。このとき、ファイル名は同じであっても、違うものであってもかまいません。 次回に更新を適用するか、自己更新オプションを構成するときには、前回選択した更新実行プロファイルが CAU によって自動的に選択されます。  
  
 CAU UI で [**更新実行プロファイルを作成または変更**する] を選択して、既存の更新実行プロファイルを変更することも、新しい実行プロファイルを作成することもできます。

更新実行プロファイルの使用に関する重要な注意事項を次に示します。

* 更新実行プロファイルには、管理者資格情報などのクラスター固有の情報は保存されません。 自己更新モードで CAU を使用している場合、更新実行プロファイルには、自己更新スケジュール情報も保存されません。 このため、指定されたクラスに属するすべてのフェールオーバー クラスターで更新実行プロファイルを共有できます。
* 更新実行プロファイルを使用して自己更新オプションを構成し、後で更新実行オプションに異なる値を指定してプロファイルを変更すると、自己更新構成は自動的に変更されません。 更新実行の新しい設定を適用するには、自己更新オプションを再度構成する必要があります。
* 実行プロファイルエディターでは、 *C:\Program files*などの空白を含むファイルパスはサポートされていません。 回避策として、事前および事後の更新スクリプトをスペースを含まないパスに格納するか、PowerShell を排他的に使用して実行プロファイルを管理し、 **Invoke**を実行するときにパスを引用符で囲みます。

### <a name="windows-powershell-equivalent-commands"></a>Windows PowerShell の同等のコマンド
  
 **Add-cauclusterrole**または**add-cauclusterrole**コマンド**レットを実行**すると、更新実行プロファイルから設定をインポートすることができるようになります。  
  
 以下の例では、*CONTOSO-FC1* という名前のクラスターにスキャンを実行した後、*C:\Windows\Cluster\DefaultParameters.xml* で指定された更新実行オプションを使用してフル更新実行を実行します。 指定のないコマンドレット パラメーターについては既定値が使用されます。  
  
```powershell  
$MyRunProfile = Import-Clixml C:\Windows\Cluster\DefaultParameters.xml  
Invoke-CauRun –ClusterName CONTOSO-FC1 @MyRunProfile   
```  
  
 更新実行プロファイルを使用すると、フェールオーバー クラスターを繰り返し更新する場合に、例外の管理、時間制約など、運用面のパラメーターについて一貫した設定を適用できます。 これらの設定は通常、"すべての Microsoft SQL Server クラスター"、"ビジネスクリティカルなクラスター" などのフェールオーバークラスターのクラスに固有であるため、使用されるフェールオーバークラスターのクラスに従って、各更新実行プロファイルに名前を付けることができます。 また、更新実行プロファイルは IT 組織内の特定のクラスに属するすべてのフェールオーバー クラスターからアクセスできるファイル共有に置いて管理することもお勧めします。  
  
  
  
## <a name="see-also"></a>関連項目

-   [クラスター対応更新](cluster-aware-updating.md)
  
-   [クラスター対応更新の Windows PowerShell コマンドレット](https://docs.microsoft.com/powershell/module/clusterawareupdating/?view=win10-ps)