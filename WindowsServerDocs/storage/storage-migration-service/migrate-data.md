---
title: 記憶域移行サービスを使用してファイルサーバーを移行する
description: 検索エンジンの結果に関するトピックの簡単な説明
author: jasongerend
ms.author: jgerend
manager: elizapo
ms.date: 02/13/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage
ms.openlocfilehash: 4b90f8c5713fbcefc1740b932e9a6f210901a974
ms.sourcegitcommit: 45415ba58907d650cfda45f4c57f6ddf1255dcbf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2019
ms.locfileid: "71206906"
---
# <a name="use-storage-migration-service-to-migrate-a-server"></a>Storage Migration Service を使用してサーバーを移行する

このトピックでは、[記憶域移行サービス](overview.md)と Windows 管理センターを使用して、サーバー (ファイルや構成を含む) を別のサーバーに移行する方法について説明します。 サービスをインストールし、必要なファイアウォールポートを開いたら、3つの手順を実行します。サーバーのインベントリを作成し、データを転送して、新しいサーバーにカットオーバーします。

## <a name="step-0-install-storage-migration-service-and-check-firewall-ports"></a>手順 0:Storage Migration Service をインストールして、ファイアウォールポートを確認する

作業を開始する前に、Storage Migration Service をインストールし、必要なファイアウォールポートが開いていることを確認してください。

1. [ストレージ移行サービスの要件](overview.md#requirements)を確認し、PC または管理サーバーに[Windows 管理センター](../../manage/windows-admin-center/understand/windows-admin-center.md)をインストールします (まだインストールしていない場合)。 ドメインに参加しているソースコンピューターを移行する場合は、移行元コンピューターと同じドメインまたはフォレストに参加しているサーバーに、記憶域移行サービスをインストールして実行する必要があります。
2. Windows 管理センターで、Windows Server 2019 を実行している orchestrator サーバーに接続します。 <br>これは、記憶域移行サービスをインストールし、移行の管理に使用するサーバーです。 1台のサーバーのみを移行する場合は、Windows Server 2019 を実行している限り、移行先サーバーを使用できます。 複数のサーバーを移行する場合は、別のオーケストレーションサーバーを使用することをお勧めします。
1. (Windows 管理センターの)**サーバーマネージャー**に移動して、**記憶域移行サービス**> し、 **[インストール]** を選択して、記憶域移行サービスとその必須コンポーネントをインストールします (図1を参照)。
    ![[インストール] ボタン](media/migrate/install.png) **を表示している [記憶域移行サービス] ページのスクリーンショット図 1:記憶域移行サービスをインストールしています**
1. Windows Server 2019 を実行しているすべての移行先サーバーに、記憶域移行サービスプロキシをインストールします。 これにより、移行先サーバーにインストールするときの転送速度が倍増します。 <br>これを行うには、Windows 管理センターで移行先サーバーに接続し、 **[サーバーマネージャー]** (Windows 管理センター) > **[役割と機能]** の順に選択し、 **[記憶域移行サービスプロキシ]** を選択して **[インストール]** を選択します。
1. すべての移行元サーバーと、windows Server 2012 R2 または Windows Server 2016 を実行しているすべての移行先サーバーで、Windows 管理センターで各サーバーに接続し、**サーバーマネージャー** (Windows 管理センター) を >**ファイアウォール** >  **に移動します。次の規則が**有効になっていることを確認します。
    - ファイルとプリンターの共有 (SMB 受信)
    - Netlogon サービス (NP 受信)
    - Windows Management Instrumentation (DCOM)
    - Windows Management Instrumentation (WMI-In)

   サードパーティのファイアウォールを使用している場合は、開く受信ポート範囲は TCP/445 (SMB)、TCP/135 (RPC/DCOM エンドポイントマッパー)、および TCP 1025-65535 (RPC/DCOM 一時ポート) です。 Storage Migration service のポートは、TCP/28940 (Orchestrator) と TCP/28941 (プロキシ) です。

1. Orchestrator サーバーを使用して移行を管理していて、転送するデータのイベントまたはログをダウンロードする場合は、そのサーバーで [ファイルとプリンターの共有 (SMB 受信)] ファイアウォール規則が有効になっていることを確認します。

## <a name="step-1-create-a-job-and-inventory-your-servers-to-figure-out-what-to-migrate"></a>手順 1:ジョブを作成してサーバーのインベントリを作成し、移行対象を把握する

この手順では、移行するサーバーを指定し、スキャンして、ファイルと構成に関する情報を収集します。

1. **[新しいジョブ]** を選択し、ジョブに名前を指定して、Windows サーバーと、Samba を使用する Linux サーバーを移行するかどうかを選択します。 [ **OK]** を選択します。
2. **[資格情報の入力]** ページで、移行元のサーバーで動作する管理者の資格情報を入力し、 **[次へ]** を選択します。 <br>Linux サーバーから移行する場合は、代わりに、SSH パスワードまたは秘密キーを含む、 **Samba 資格**情報と**Linux 資格情報**のページに資格情報を入力します。 

3. **[デバイスの追加]** を選択し、ソースサーバーの名前またはクラスター化されたファイルサーバーの名前を入力して、[ **OK]** を選択します。 <br>インベントリを作成する他のすべてのサーバーについて、この手順を繰り返します。

4. **[スキャンの開始]** を選択します。<br>ページが更新されると、スキャンが完了したことが示されます。
    ![](media/migrate/inventory.png) スキャン**の準備ができているサーバーを示すスクリーンショット図 2:サーバーのインベントリ**
5. 各サーバーを選択して、インベントリされた共有、構成、ネットワークアダプター、およびボリュームを確認します。 <br><br>記憶域移行サービスは、Windows の操作に干渉する可能性があるファイルまたはフォルダーを転送しません。そのため、このリリースでは、Windows システムフォルダーにあるすべての共有に対して警告が表示されます。 転送フェーズでは、これらの共有をスキップする必要があります。 詳細については、「[転送から除外するファイルとフォルダー](faq.md#what-files-and-folders-are-excluded-from-transfers)」を参照してください。
6. [**次**へ] を選択して、データの転送に移動します。

## <a name="step-2-transfer-data-from-your-old-servers-to-the-destination-servers"></a>手順 2:古いサーバーから移行先サーバーにデータを転送する

この手順では、移行先サーバーに配置する場所を指定した後、データを転送します。

1. [**データ** > の転送] ページで、移行先サーバーで機能する管理者の**資格情報を**入力し、 **[次へ]** を選択します。
2. **[変換先のデバイスとマッピングの追加]** ページに、最初の移行元サーバーが表示されます。 移行先のサーバーまたはクラスター化されたファイルサーバーの名前を入力し、 **[デバイスのスキャン]** を選択します。 ドメインに参加しているソースコンピューターから移行する場合は、移行先サーバーを同じドメインに参加させる必要があります。
3. ソースボリュームを移行先ボリュームにマップし、転送しない共有 (Windows システムフォルダーにあるすべての管理共有を含む) の **[含める]** チェックボックスをオフにして、 **[次へ]** を選択します。
   ![ソースサーバーとそのボリュームと共有を示すスクリーンショットと、転送先での転送先](media/migrate/transfer.png) **図 3:移行元サーバーとそのストレージの転送先**
4. 移行元サーバーの移行先サーバーとマッピングを追加し、 **[次へ]** を選択します。
5. **[転送設定の調整]** ページで、移行元サーバー上のローカルユーザーとグループを移行するかどうかを指定し、 **[次へ]** を選択します。 これにより、ローカルユーザーとグループに設定されたファイルまたは共有のアクセス許可が失われないように、移行先サーバー上のローカルユーザーとグループを再作成することができます。 ローカルユーザーとグループを移行する場合のオプションは次のとおりです。

    - 既定では、**同じ名前のアカウント名を変更**し、移行元サーバー上のすべてのローカルユーザーとグループを移行します。 移行元と移行先で同じ名前のローカルユーザーまたはグループが検出された場合は、それらが組み込みの場合 (管理者ユーザーや管理者グループなど)、その名前が変更されます。
    - **同じ名前のアカウントを再利用**すると、移行元と移行先のユーザーおよびグループと同じ名前になります。
    - **[ユーザーとグループを転送しない**] ローカルユーザーとグループの移行をスキップします。これは DFS レプリケーションのデータをシードするときに必要です (DFS レプリケーションローカルグループとユーザーをサポートしていません)。

   > [!NOTE]
   > 移行されたユーザーアカウントは、移行先で無効になっていて、127文字のパスワードが割り当てられています。このパスワードは複雑でランダムなものです。そのため、これらを有効にした後で、新しいパスワードを割り当てる必要があります。 これにより、ソースのパスワードを忘れた場合や脆弱なパスワードを持っている古いアカウントが、移行先でセキュリティ上の問題となることを防ぐことができます。 ローカル管理者のパスワードを管理する方法として、[ローカル管理者パスワードソリューション (LAPS)](https://www.microsoft.com/download/details.aspx?id=46899)を確認することもできます。

6. **[検証]** を選択し、 **[次へ]** を選択します。
7. **[転送の開始]** を選択して、データの転送を開始します。<br>最初に転送するときに、コピー先の既存のファイルをバックアップフォルダーに移動します。 その後の転送では、既定では、先にバックアップしないで宛先を更新します。 <br>また、記憶域移行サービスは、重複する共有を処理するのに十分なスマートです。同じジョブで同じフォルダーを2回コピーすることはありません。
8. 転送が完了したら、移行先サーバーを調べて、すべてが正常に転送されたことを確認します。 転送されなかったファイルのログをダウンロードする場合にのみ、 **[エラーログ]** を選択します。

   > [!NOTE]
   > 転送の監査証跡を保持する場合、またはジョブで複数の転送を実行する場合は、 **[ログの転送]** またはその他のログ保存オプションをクリックして CSV コピーを保存します。 後続のすべての転送では、前回の実行のデータベース情報が上書きされます。 

この時点で、次の3つのオプションがあります。

- 移行先サーバーが移行元サーバーの id を採用するように、**次の手順に進み**ます。
- 移行元サーバーの id を引き継がず**に移行を完了することを検討してください**。
- **もう一度転送**し、最後の転送以降に更新されたファイルのみをコピーします。

ファイルを Azure と同期することが目的である場合は、ファイルを転送した後、または移行先サーバーに移動した後に、Azure File Sync を使用して移行先サーバーを設定できます (「 [Azure File Sync の展開の計画](https://docs.microsoft.com/azure/storage/files/storage-sync-files-planning)」を参照してください)。

## <a name="step-3-cut-over-to-the-new-servers"></a>手順 3:新しいサーバーにカットオーバーする

このステップでは、移行元サーバーから移行先サーバーに移行し、IP アドレスとコンピューター名を移行先サーバーに移動します。 この手順が完了すると、アプリとユーザーは、から移行したサーバーの名前とアドレスを使用して、新しいサーバーにアクセスできるようになります。

1. 移行ジョブから移動したことがある場合は、Windows 管理センターで、[**サーバーマネージャー** > **Storage migration Service** ] に移動して、完了するジョブを選択します。
2. [**新しいサーバー** > の**資格情報を入力してください**] ページで、前に入力した資格情報を使用するには **[次へ]** を選択します。

   移行先がクラスター化されたファイルサーバーの場合は、ドメインからクラスターを削除するためのアクセス許可を持つ資格情報を指定し、新しい名前で追加し直す必要がある場合があります。

3. **[カットオーバーの構成]** ページで、ソースの各アダプターから設定を引き継ぐネットワークアダプターを指定します。 これにより、移行元サーバーに新しい DHCP または静的 IP アドレスが与えられ、移行元サーバーから移行先に IP アドレスが移動します。 すべてのネットワーク移行または特定のインターフェイスをスキップするオプションがあります。 
4. 切り替え後に移行元サーバーに使用する IP アドレスを指定して、そのアドレスを移行先に移動します。 DHCP または静的アドレスを使用できます。 静的アドレスを使用する場合、新しいサブネットは古いサブネットと同じである必要があります。同じでないと、カットオーバーは失敗します。
    ![移行元サーバーとその IP アドレスとコンピューター名を示すスクリーンショットと、切り替え](media/migrate/cutover.png) **図4の後で置き換えられるものを示しています。移行元サーバーと、そのネットワーク構成を移行先に移行する方法**
5. 移行先サーバーの名前を変更した後、移行元サーバーの名前を変更する方法を指定します。 ランダムに生成された名前を使用することも、自分で入力することもできます。 **[次へ]** を選択します。
6. **[カットオーバーの設定の調整]** ページで **[次へ]** を選択します。
7. **[ソースとターゲットのデバイスの検証]** ページで **[検証]** を選択し、 **[次へ]** を選択します。
8. カットオーバーを実行する準備ができたら、 **[カットオーバーの開始]** を選択します。 <br>ユーザーとアプリは、アドレスと名前を移動し、サーバーをそれぞれ数回再起動しても、移行の影響を受けないように、中断が発生する可能性があります。 カットオーバーの所要時間は、サーバーの再起動の速度と、Active Directory および DNS のレプリケーション時間によって異なります。

## <a name="see-also"></a>関連項目

- [記憶域移行サービスの概要](overview.md)
- [記憶域移行サービスに関してよく寄せられる質問 (FAQ)](faq.md)
- [Azure File Sync 展開の計画](https://docs.microsoft.com/azure/storage/files/storage-sync-files-planning)
