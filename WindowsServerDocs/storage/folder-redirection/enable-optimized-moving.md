---
title: リダイレクトされたフォルダーの最適化された移動を有効にする
description: リダイレクトされたフォルダーの新しいファイル共有への最適化された移動を実行する方法。
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 09/10/2018
ms.localizationpriority: medium
ms.openlocfilehash: edf714bc0d6b39dbe7c5e800e953d7820fe9abc5
ms.sourcegitcommit: bfe9c5f7141f4f2343a4edf432856f07db1410aa
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/25/2019
ms.locfileid: "75352607"
---
# <a name="enable-optimized-moves-of-redirected-folders"></a>リダイレクトされたフォルダーの最適化された移動を有効にする

>適用先:Windows 10、Windows 8、Windows 8.1、Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、Windows Server (半期チャネル)

このトピックでは、リダイレクトされたフォルダー (フォルダー リダイレクト) の新しいファイル共有への最適化された移動を実行する方法について説明します。 このポリシー設定を有効にした場合、管理者がリダイレクトされたフォルダーをホストしているファイル共有を移動し、グループ ポリシーでリダイレクトされたフォルダーのターゲット パスを更新すると、キャッシュされたコンテンツは、遅延もそのユーザーの潜在的なデータ損失もなしで、ローカルのオフライン ファイル キャッシュ内で名前が変更されます。

以前は、管理者はグループ ポリシーでリダイレクトされたフォルダーのターゲット パスを変更し、影響を受けたユーザーの次のサインイン時にクライアント コンピューターがファイルをコピーして、サインインの遅延を引き起こしていました。 また、管理者はグループ ポリシーでファイル共有を移動し、リダイレクトされたフォルダーのターゲット パスを更新することもできました。 ただし、移動を開始してから移動後の最初の同期までの間にクライアント コンピューターでローカルに加えられた変更は失われます。

## <a name="prerequisites"></a>前提条件

最適化された移動には、次の要件があります。

- フォルダー リダイレクトがセットアップされている必要があります。 詳細については、「[オフライン ファイルを使用してフォルダー リダイレクトを展開する](deploy-folder-redirection.md)」を参照してください。
- クライアント コンピューターは、Windows 10、Windows 8.1、Windows 8、Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012 または Windows Server (半期チャネル) を実行している必要があります。

## <a name="step-1-enable-optimized-move-in-group-policy"></a>手順 1:グループ ポリシーで最適化された移動を有効にする

フォルダー リダイレクト データの再配置を最適化するには、グループ ポリシーを使用して、適切なグループ ポリシー オブジェクト (GPO) の **[フォルダー リダイレクトのサーバー パスを変更するとき、オフライン ファイル キャッシュにあるコンテンツの移動の最適化を有効にする]** ポリシー設定を有効にします。 このポリシー設定を **[無効]** または **[未構成]** に設定すると、クライアントではサーバー パスが変更された場合に、すべてのフォルダー リダイレクト コンテンツが新しい場所にコピーされ、その後以前の場所からコンテンツが削除されます。

リダイレクトされたフォルダーの最適化された移動を有効にする方法を次に示します。

1. グループ ポリシーの管理で、フォルダー リダイレクト設定用に作成した GPO (たとえば、**Folder Redirection and Roaming User Profiles Settings**) を右クリックし、 **[編集]** を選択します。
2. **[ユーザーの構成]** で、 **[ポリシー]** 、 **[管理用テンプレート]** 、 **[システム]** 、 **[フォルダー リダイレクト]** の順に移動します。
3. **[フォルダー リダイレクトのサーバー パスを変更するとき、オフライン ファイル キャッシュにあるコンテンツの移動の最適化を有効にする]** を右クリックし、 **[編集]** を選択します。
4. **[有効]** を選択し、 **[OK]** を選択します。

## <a name="step-2-relocate-the-file-share-for-redirected-folders"></a>手順 2:リダイレクトされたフォルダーのファイル共有を再配置する

ユーザーのリダイレクトされたフォルダーを含むファイル共有を移動するときは、フォルダーが適切に再配置されるように注意する必要があります。

>[!IMPORTANT]
>ユーザーのファイルが使用されている場合、またはファイルの完全な状態が移動中に保持されていない場合、ファイルがネットワーク経由でコピーされたり、オフライン ファイルによって生成された同期の競合が発生したり、データが失われたりするため、パフォーマンスが低下する可能性があります。

1. リダイレクトされたフォルダーをホストしているサーバーが変更されることをユーザーに事前に通知してください。ユーザーには、次の操作を実行することを推奨します。

      - オフライン ファイル キャッシュの内容を同期し、競合を解決する。
      - 管理者特権でコマンド プロンプトを開き、「**GpUpdate /Target:User /Force**」と入力し、サインアウトしてから再度サインインして、最新のグループ ポリシー設定がクライアント コンピューターに適用されていることを確認する

        >[!NOTE]
        >既定では、クライアント コンピューターでは 90 分ごとにグループ ポリシーが更新されるため、クライアント コンピューターで更新されたポリシーを受信するのに十分な時間を確保すれば、ユーザーに **GpUpdate** を使用することを依頼する必要はありません。
2. ファイル共有内のファイルが使用されないように、ファイル共有をサーバーから削除します。 これをサーバー マネージャーで行うには、ファイル サービスおよび記憶域サービスの **[共有]** ページで、該当するファイル共有を右クリックし、 **[削除]** を選択します。

    ユーザーは、移動が完了するまでオフライン ファイルを使用してオフラインで作業し、グループ ポリシーから更新されたフォルダー リダイレクト設定を受け取ります。

3. バックアップ特権を持つアカウントを使用して、ファイルのタイムスタンプが保持される方法 (バックアップと復元ユーティリティなど) で、ファイル共有のコンテンツを新しい場所に移動します。 **Robocopy** コマンドを使用するには、管理者特権でコマンド プロンプトを開き、次のコマンドを入力します。ここで、```<Source>``` はファイル共有の現在の場所で、```<Destination>``` は新しい場所です。

    ```PowerShell
    Robocopy /B <Source> <Destination> /Copyall /MIR /EFSRAW
    ```

    >[!NOTE]
    >**Xcopy** コマンドでは、ファイルの状態がすべて保持されるわけではありません。
4. フォルダー リダイレクト ポリシー設定を編集して、再配置するリダイレクト フォルダーごとにターゲット フォルダーの場所を更新します。 詳細については、「[オフライン ファイルを使用してフォルダー リダイレクトを展開する](deploy-folder-redirection.md)」の手順 4 を参照してください。
5. リダイレクトされたフォルダーをホストしているサーバーが変更されたことと、**GpUpdate /Target:User /Force** コマンドを使用する必要があることをユーザーに通知した後、サインアウトしてから再度サインインして更新された構成を取得し、適切なファイル同期を再開します。

    ユーザーは、すべてのマシンに少なくとも 1 回サインオンして、各オフライン ファイル キャッシュでデータが正しく再配置されることを確認する必要があります。

## <a name="more-information"></a>説明を見る

* [オフライン ファイルを使用してフォルダー リダイレクトを展開する](deploy-folder-redirection.md)
* [移動ユーザー プロファイルを展開する](deploy-roaming-user-profiles.md)
* [フォルダー リダイレクト、オフライン ファイル、移動ユーザー プロファイルの概要](folder-redirection-rup-overview.md)